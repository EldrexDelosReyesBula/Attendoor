<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NearCheck - Smart Attendance Management System">
    <meta name="theme-color" content="#4F46E5">
    <title>NearCheck | Smart Attendance Management</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-messaging-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-analytics-compat.js"></script>
    
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <!-- Motion One (Animation library) -->
    <script src="https://unpkg.com/motion@10.12.0/dist/motion.min.js"></script>
    
    <!-- Custom CSS -->
    <style>
        :root {
            --primary: #4F46E5;
            --primary-dark: #4338CA;
            --primary-light: #C7D2FE;
            --secondary: #10B981;
            --danger: #EF4444;
            --warning: #F59E0B;
            --info: #3B82F6;
            --dark: #1F2937;
            --light: #F9FAFB;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: #f5f7fa;
            transition: var(--transition);
            overscroll-behavior-y: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Smooth transitions */
        .smooth-transition {
            transition: var(--transition);
        }

        /* Card hover effect with physics-based animation */
        .card-hover {
            transition: transform 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28), box-shadow 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: var(--shadow-lg);
        }

        /* Avatar styling */
        .avatar {
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            font-weight: bold;
            user-select: none;
        }

        /* Drawer animation */
        .drawer {
            transform: translateX(-100%);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            will-change: transform;
        }

        .drawer-open {
            transform: translateX(0);
        }

        /* Modal animations */
        .modal {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-open {
            opacity: 1;
            visibility: visible;
        }

        /* Check-in animation */
        .check-in-animation {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            70% { box-shadow: 0 0 0 12px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }

        /* Loading skeleton */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Physics-based button press */
        .btn-press:active {
            transform: scale(0.96);
        }

        /* Ripple effect */
        .ripple {
            position: relative;
            overflow: hidden;
        }
        
        .ripple-effect {
            position: absolute;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.7);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }
        
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* Floating action button */
        .fab {
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .fab:hover {
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.15);
            transform: translateY(-3px);
        }
        
        .fab:active {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(0);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        /* Dark mode styles */
        [data-theme="dark"] body {
            background-color: #111827;
            color: #f3f4f6;
        }

        [data-theme="dark"] .bg-white {
            background-color: #1f2937 !important;
        }

        [data-theme="dark"] .text-gray-800 {
            color: #f3f4f6 !important;
        }

        [data-theme="dark"] .border-gray-200 {
            border-color: #374151 !important;
        }

        [data-theme="dark"] .skeleton {
            background: linear-gradient(90deg, #2d3748 25%, #4a5568 50%, #2d3748 75%);
        }
        
        [data-theme="dark"] ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        
        [data-theme="dark"] ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
        }
        
        [data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Apple-style modal */
        .apple-modal {
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 380px;
            width: 90%;
            overflow: hidden;
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28), opacity 0.3s ease;
            opacity: 0;
        }
        
        .apple-modal-open {
            transform: scale(1);
            opacity: 1;
        }
        
        .apple-modal-content {
            padding: 24px;
            text-align: center;
        }
        
        .apple-modal-icon {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }
        
        .apple-modal-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .apple-modal-text {
            font-size: 15px;
            color: #666;
            margin-bottom: 24px;
            line-height: 1.4;
        }
        
        .apple-modal-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .apple-modal-btn {
            padding: 12px;
            border-radius: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .apple-modal-btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .apple-modal-btn-secondary {
            background-color: #f5f5f7;
            color: var(--primary);
        }
        
        [data-theme="dark"] .apple-modal-btn-secondary {
            background-color: #2e2e2e;
        }
        
        .apple-modal-btn-tertiary {
            color: var(--primary);
        }

        /* Responsive adjustments */
        @media (max-width: 640px) {
            .drawer {
                width: 85%;
            }
            
            .apple-modal {
                max-width: 320px;
            }
        }

        /* Confetti effect */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
            z-index: 9999;
            animation: confetti-fall 5s linear forwards;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Authentication Modal -->
    <div id="authModal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 w-full max-w-md animate__animated animate__fadeInUp" style="border-radius: 20px;">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center text-white font-bold mr-2">NC</div>
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Welcome to NearCheck</h2>
                </div>
                <button id="closeAuthModal" class="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100 smooth-transition btn-press">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="authTabs" class="flex border-b border-gray-200 dark:border-gray-600 mb-4">
                <button id="loginTab" class="px-4 py-2 font-medium text-primary border-b-2 border-primary smooth-transition btn-press">Login</button>
                <button id="registerTab" class="px-4 py-2 font-medium text-gray-500 dark:text-gray-400 smooth-transition btn-press">Register</button>
            </div>
            
            <!-- Login Form -->
            <div id="loginForm">
                <div class="mb-4">
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="loginPassword">Password</label>
                    <div class="relative">
                        <input type="password" id="loginPassword" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                        <button id="toggleLoginPassword" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="rememberMe" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded dark:bg-gray-700 smooth-transition">
                        <label for="rememberMe" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Remember me</label>
                    </div>
                    <a href="#" id="forgotPasswordBtn" class="text-sm text-primary hover:underline smooth-transition">Forgot password?</a>
                </div>
                <button id="loginBtn" class="w-full bg-primary hover:bg-primary-dark text-white py-2 px-4 rounded-lg transition duration-300 flex items-center justify-center ripple smooth-transition btn-press">
                    <span id="loginBtnText">Login</span>
                    <i id="loginSpinner" class="fas fa-spinner fa-spin ml-2 hidden"></i>
                </button>
                <div class="mt-4 text-center">
                    <p class="text-gray-600 dark:text-gray-400">Or login with</p>
                    <div class="flex justify-center mt-2">
                        <button id="googleLoginBtn" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-full p-2 mx-1 hover:bg-gray-100 dark:hover:bg-gray-600 transition smooth-transition btn-press">
                            <i class="fab fa-google text-red-500"></i>
                        </button>
                        <button id="appleLoginBtn" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-full p-2 mx-1 hover:bg-gray-100 dark:hover:bg-gray-600 transition smooth-transition btn-press">
                            <i class="fab fa-apple text-gray-800 dark:text-white"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Register Form -->
            <div id="registerForm" class="hidden">
                <div class="mb-4">
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="registerName">Full Name</label>
                    <input type="text" id="registerName" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="registerPassword">Password</label>
                    <div class="relative">
                        <input type="password" id="registerPassword" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                        <button id="toggleRegisterPassword" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="mt-1 text-xs text-gray-500 dark:text-gray-400">Minimum 8 characters with 1 number</div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="registerConfirmPassword">Confirm Password</label>
                    <div class="relative">
                        <input type="password" id="registerConfirmPassword" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                        <button id="toggleRegisterConfirmPassword" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="registerRole">I am a</label>
                    <select id="registerRole" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                        <option value="teacher">Teacher</option>
                        <option value="student">Student</option>
                    </select>
                </div>
                <div id="teacherFields" class="mb-4">
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="registerBirthdate">Birthdate (Must be 20+)</label>
                    <input type="date" id="registerBirthdate" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                </div>
                <div id="studentFields" class="mb-4 hidden">
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="registerInviteCode">Invite Code</label>
                    <input type="text" id="registerInviteCode" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                </div>
                <div class="flex items-center mb-4">
                    <input type="checkbox" id="acceptTerms" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded dark:bg-gray-700 smooth-transition">
                    <label for="acceptTerms" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">I agree to the <a href="#" class="text-primary hover:underline smooth-transition">Terms of Service</a> and <a href="#" class="text-primary hover:underline smooth-transition">Privacy Policy</a></label>
                </div>
                <button id="registerBtn" class="w-full bg-primary hover:bg-primary-dark text-white py-2 px-4 rounded-lg transition duration-300 flex items-center justify-center ripple smooth-transition btn-press">
                    <span id="registerBtnText">Create Account</span>
                    <i id="registerSpinner" class="fas fa-spinner fa-spin ml-2 hidden"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4">
        <div class="apple-modal bg-white dark:bg-gray-800">
            <div class="apple-modal-content">
                <div class="apple-modal-icon bg-blue-100 dark:bg-blue-900">
                    <i class="fas fa-key text-blue-500 dark:text-blue-300 text-2xl"></i>
                </div>
                <h3 class="apple-modal-title text-gray-800 dark:text-white">Reset Password</h3>
                <p class="apple-modal-text text-gray-600 dark:text-gray-300">Enter your email and we'll send you a link to reset your password.</p>
                
                <div class="mb-4">
                    <input type="email" id="resetEmail" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition" placeholder="Your email address">
                </div>
                
                <div class="apple-modal-actions">
                    <button id="sendResetLinkBtn" class="apple-modal-btn apple-modal-btn-primary smooth-transition btn-press">
                        <span id="resetBtnText">Send Reset Link</span>
                        <i id="resetSpinner" class="fas fa-spinner fa-spin ml-2 hidden"></i>
                    </button>
                    <button id="cancelResetBtn" class="apple-modal-btn apple-modal-btn-secondary smooth-transition btn-press">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Permission Modal -->
    <div id="permissionModal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4">
        <div class="apple-modal bg-white dark:bg-gray-800">
            <div class="apple-modal-content">
                <div class="apple-modal-icon bg-purple-100 dark:bg-purple-900">
                    <i class="fas fa-shield-alt text-purple-500 dark:text-purple-300 text-2xl"></i>
                </div>
                <h3 class="apple-modal-title text-gray-800 dark:text-white">Permissions Required</h3>
                <p class="apple-modal-text text-gray-600 dark:text-gray-300">NearCheck needs the following permissions to function properly:</p>
                
                <div class="space-y-4 mb-6">
                    <div class="flex items-start">
                        <div class="bg-green-100 dark:bg-green-900 p-2 rounded-lg mr-3">
                            <i class="fas fa-map-marker-alt text-green-500 dark:text-green-300"></i>
                        </div>
                        <div class="text-left">
                            <h3 class="font-medium text-gray-800 dark:text-white">Location Access</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-300">Verify you're near school premises during check-in</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <div class="bg-blue-100 dark:bg-blue-900 p-2 rounded-lg mr-3">
                            <i class="fas fa-bell text-blue-500 dark:text-blue-300"></i>
                        </div>
                        <div class="text-left">
                            <h3 class="font-medium text-gray-800 dark:text-white">Notifications</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-300">Receive important alerts and announcements</p>
                        </div>
                    </div>
                </div>
                
                <div class="apple-modal-actions">
                    <button id="allowAllBtn" class="apple-modal-btn apple-modal-btn-primary smooth-transition btn-press">Allow All</button>
                    <button id="customizeBtn" class="apple-modal-btn apple-modal-btn-secondary smooth-transition btn-press">Customize</button>
                    <button id="denyBtn" class="apple-modal-btn apple-modal-btn-tertiary smooth-transition btn-press">Deny</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Permission Modal -->
    <div id="customPermissionModal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4">
        <div class="apple-modal bg-white dark:bg-gray-800">
            <div class="apple-modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="apple-modal-title text-gray-800 dark:text-white">Customize Permissions</h3>
                    <button id="closeCustomPermissionModal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 smooth-transition btn-press">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4 mb-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="bg-green-100 dark:bg-green-900 p-2 rounded-lg mr-3">
                                <i class="fas fa-map-marker-alt text-green-500 dark:text-green-300"></i>
                            </div>
                            <div>
                                <h3 class="font-medium text-gray-800 dark:text-white">Location Access</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-300">Verify your location during check-in</p>
                            </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="locationPermissionToggle" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-light dark:peer-focus:ring-primary-dark rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                        </label>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="bg-blue-100 dark:bg-blue-900 p-2 rounded-lg mr-3">
                                <i class="fas fa-bell text-blue-500 dark:text-blue-300"></i>
                            </div>
                            <div>
                                <h3 class="font-medium text-gray-800 dark:text-white">Notifications</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-300">Receive important alerts</p>
                            </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="notificationPermissionToggle" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-light dark:peer-focus:ring-primary-dark rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                        </label>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="bg-yellow-100 dark:bg-yellow-900 p-2 rounded-lg mr-3">
                                <i class="fas fa-camera text-yellow-500 dark:text-yellow-300"></i>
                            </div>
                            <div>
                                <h3 class="font-medium text-gray-800 dark:text-white">Camera</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-300">For face verification (optional)</p>
                            </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="cameraPermissionToggle" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-light dark:peer-focus:ring-primary-dark rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                        </label>
                    </div>
                </div>
                
                <div class="apple-modal-actions">
                    <button id="savePermissionsBtn" class="apple-modal-btn apple-modal-btn-primary smooth-transition btn-press">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="appContainer" class="hidden">
        <!-- Sidebar/Drawer -->
        <div id="drawer" class="drawer fixed inset-y-0 left-0 z-40 w-64 bg-white dark:bg-gray-800 shadow-lg overflow-y-auto transition-transform duration-300">
            <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center text-white font-bold">NC</div>
                    <span class="ml-2 text-xl font-bold text-gray-800 dark:text-white">NearCheck</span>
                </div>
                <button id="closeDrawer" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 smooth-transition btn-press">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="p-4">
                <div class="flex items-center mb-6">
                    <div id="userAvatar" class="avatar w-10 h-10 rounded-full mr-3"></div>
                    <div>
                        <h3 id="userName" class="font-medium text-gray-800 dark:text-white">Loading...</h3>
                        <p id="userRole" class="text-sm text-gray-500 dark:text-gray-400">Teacher</p>
                    </div>
                </div>
                
                <nav>
                    <ul class="space-y-1">
                        <li>
                            <a href="#" class="flex items-center px-3 py-2 text-sm font-medium rounded-lg bg-primary bg-opacity-10 text-primary smooth-transition">
                                <i class="fas fa-home mr-3"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" id="sectionsLink" class="flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 smooth-transition">
                                <i class="fas fa-users mr-3"></i>
                                <span>My Sections</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" id="attendanceLink" class="flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 smooth-transition">
                                <i class="fas fa-calendar-check mr-3"></i>
                                <span>Attendance</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" id="reportsLink" class="flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 smooth-transition">
                                <i class="fas fa-chart-bar mr-3"></i>
                                <span>Reports</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" id="announcementsLink" class="flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 smooth-transition">
                                <i class="fas fa-bullhorn mr-3"></i>
                                <span>Announcements</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" id="settingsLink" class="flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 smooth-transition">
                                <i class="fas fa-cog mr-3"></i>
                                <span>Settings</span>
                            </a>
                        </li>
                    </ul>
                </nav>
                
                <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <button id="themeToggle" class="flex items-center w-full px-3 py-2 text-sm font-medium rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 smooth-transition btn-press">
                        <i class="fas fa-moon mr-3"></i>
                        <span>Dark Mode</span>
                    </button>
                    <button id="logoutBtn" class="flex items-center w-full px-3 py-2 text-sm font-medium rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 mt-1 smooth-transition btn-press">
                        <i class="fas fa-sign-out-alt mr-3"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="ml-0 transition-all duration-300" id="mainContent">
            <!-- Header -->
            <header class="bg-white dark:bg-gray-800 shadow-sm sticky top-0 z-30">
                <div class="flex items-center justify-between px-4 py-3">
                    <div class="flex items-center">
                        <button id="menuBtn" class="mr-4 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 smooth-transition btn-press">
                            <i class="fas fa-bars"></i>
                        </button>
                        <h1 id="pageTitle" class="text-xl font-bold text-gray-800 dark:text-white">Dashboard</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button id="notificationsBtn" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 relative smooth-transition btn-press">
                            <i class="fas fa-bell"></i>
                            <span id="notificationBadge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center hidden">0</span>
                        </button>
                        <div id="userAvatarSmall" class="avatar w-8 h-8 rounded-full cursor-pointer smooth-transition btn-press"></div>
                    </div>
                </div>
            </header>

            <!-- Main Content Area -->
            <main class="p-4" id="contentArea">
                <!-- Dashboard Page (Default) -->
                <div id="dashboardPage">
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 smooth-transition card-hover">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Active Sessions</p>
                                    <h3 class="text-2xl font-bold text-gray-800 dark:text-white mt-1" id="activeSessionsCount">0</h3>
                                </div>
                                <div class="bg-blue-100 dark:bg-blue-900 p-3 rounded-lg">
                                    <i class="fas fa-clock text-blue-500 dark:text-blue-300"></i>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2"><span id="activeSessionsText">0</span> sections currently accepting check-ins</p>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 smooth-transition card-hover">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Today's Attendance</p>
                                    <h3 class="text-2xl font-bold text-gray-800 dark:text-white mt-1" id="attendanceRate">0%</h3>
                                </div>
                                <div class="bg-green-100 dark:bg-green-900 p-3 rounded-lg">
                                    <i class="fas fa-check-circle text-green-500 dark:text-green-300"></i>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2" id="attendanceTrend">Loading data...</p>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 smooth-transition card-hover">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Pending Alerts</p>
                                    <h3 class="text-2xl font-bold text-gray-800 dark:text-white mt-1" id="pendingAlertsCount">0</h3>
                                </div>
                                <div class="bg-yellow-100 dark:bg-yellow-900 p-3 rounded-lg">
                                    <i class="fas fa-exclamation-triangle text-yellow-500 dark:text-yellow-300"></i>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2" id="alertsText">Require your attention</p>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 smooth-transition card-hover">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Total Students</p>
                                    <h3 class="text-2xl font-bold text-gray-800 dark:text-white mt-1" id="totalStudentsCount">0</h3>
                                </div>
                                <div class="bg-purple-100 dark:bg-purple-900 p-3 rounded-lg">
                                    <i class="fas fa-users text-purple-500 dark:text-purple-300"></i>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2" id="studentsText">Across all your sections</p>
                        </div>
                    </div>

                    <!-- Recent Check-ins -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-lg font-bold text-gray-800 dark:text-white">Recent Check-ins</h2>
                            <button id="viewAllCheckinsBtn" class="text-sm text-primary hover:underline smooth-transition">View All</button>
                        </div>
                        
                        <div class="space-y-3" id="recentCheckinsList">
                            <!-- Check-ins will be loaded here dynamically -->
                            <div class="skeleton h-16 rounded-lg"></div>
                            <div class="skeleton h-16 rounded-lg"></div>
                            <div class="skeleton h-16 rounded-lg"></div>
                        </div>
                    </div>

                    <!-- AI Warnings and Section Activity -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- AI Warnings -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-lg font-bold text-gray-800 dark:text-white">AI Warnings</h2>
                                <button id="viewAllWarningsBtn" class="text-sm text-primary hover:underline smooth-transition">View All</button>
                            </div>
                            
                            <div class="space-y-3" id="aiWarningsList">
                                <!-- Warnings will be loaded here dynamically -->
                                <div class="skeleton h-24 rounded-lg"></div>
                                <div class="skeleton h-24 rounded-lg"></div>
                            </div>
                        </div>
                        
                        <!-- Section Activity -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-lg font-bold text-gray-800 dark:text-white">Section Activity</h2>
                                <button id="viewAllSectionsBtn" class="text-sm text-primary hover:underline smooth-transition">View All</button>
                            </div>
                            
                            <div class="space-y-4" id="sectionActivityList">
                                <!-- Sections will be loaded here dynamically -->
                                <div class="skeleton h-20 rounded-lg"></div>
                                <div class="skeleton h-20 rounded-lg"></div>
                                <div class="skeleton h-20 rounded-lg"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sections Page -->
                <div id="sectionsPage" class="hidden">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">My Sections</h2>
                        <button id="createSectionBtn" class="bg-primary hover:bg-primary-dark text-white py-2 px-4 rounded-lg transition duration-300 flex items-center smooth-transition btn-press">
                            <i class="fas fa-plus mr-2"></i>
                            <span>New Section</span>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="sectionsGrid">
                        <!-- Sections will be loaded here dynamically -->
                        <div class="skeleton h-40 rounded-xl"></div>
                        <div class="skeleton h-40 rounded-xl"></div>
                        <div class="skeleton h-40 rounded-xl"></div>
                    </div>
                </div>

                <!-- Attendance Page -->
                <div id="attendancePage" class="hidden">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Attendance</h2>
                        <div class="flex space-x-2">
                            <button id="startSessionBtn" class="bg-primary hover:bg-primary-dark text-white py-2 px-4 rounded-lg transition duration-300 flex items-center smooth-transition btn-press">
                                <i class="fas fa-play mr-2"></i>
                                <span>Start Session</span>
                            </button>
                            <button id="attendanceReportsBtn" class="bg-white dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white py-2 px-4 rounded-lg border border-gray-300 dark:border-gray-600 transition duration-300 flex items-center smooth-transition btn-press">
                                <i class="fas fa-file-export mr-2"></i>
                                <span>Export</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 mb-6">
                        <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
                            <div class="mb-4 md:mb-0">
                                <h3 class="text-lg font-medium text-gray-800 dark:text-white">Today's Sessions</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Active and upcoming attendance sessions</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="relative">
                                    <select id="attendanceFilter" class="appearance-none bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg pl-3 pr-8 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white smooth-transition">
                                        <option value="all">All Sections</option>
                                        <option value="active">Active Only</option>
                                        <option value="upcoming">Upcoming</option>
                                        <option value="completed">Completed</option>
                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300">
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                </div>
                                <button id="refreshAttendanceBtn" class="bg-white dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white p-2 rounded-lg border border-gray-300 dark:border-gray-600 transition duration-300 smooth-transition btn-press">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Section</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Time</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Attendance</th>
                                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="attendanceSessionsTable">
                                    <!-- Sessions will be loaded here dynamically -->
                                    <tr>
                                        <td colspan="5" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">Loading sessions...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4">
                        <h3 class="text-lg font-medium text-gray-800 dark:text-white mb-4">Recent Attendance Records</h3>
                        <div id="attendanceRecordsChart" class="h-64">
                            <!-- Chart will be rendered here -->
                        </div>
                    </div>
                </div>

                <!-- Reports Page -->
                <div id="reportsPage" class="hidden">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Reports</h2>
                        <div class="flex space-x-2">
                            <button id="generateReportBtn" class="bg-primary hover:bg-primary-dark text-white py-2 px-4 rounded-lg transition duration-300 flex items-center smooth-transition btn-press">
                                <i class="fas fa-file-pdf mr-2"></i>
                                <span>Generate Report</span>
                            </button>
                            <button id="exportDataBtn" class="bg-white dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white py-2 px-4 rounded-lg border border-gray-300 dark:border-gray-600 transition duration-300 flex items-center smooth-transition btn-press">
                                <i class="fas fa-file-csv mr-2"></i>
                                <span>Export Data</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4">
                            <h3 class="text-lg font-medium text-gray-800 dark:text-white mb-4">Filter Reports</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Section</label>
                                    <select id="reportSectionFilter" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                                        <option value="all">All Sections</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Date Range</label>
                                    <select id="reportDateRange" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                                        <option value="7days">Last 7 Days</option>
                                        <option value="30days">Last 30 Days</option>
                                        <option value="90days">Last 90 Days</option>
                                        <option value="custom">Custom Range</option>
                                    </select>
                                </div>
                                <div id="customDateRangeContainer" class="hidden">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">From</label>
                                            <input type="date" id="reportStartDate" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">To</label>
                                            <input type="date" id="reportEndDate" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Report Type</label>
                                    <select id="reportType" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                                        <option value="summary">Summary Report</option>
                                        <option value="detailed">Detailed Report</option>
                                        <option value="attendance">Attendance Trends</option>
                                        <option value="tardiness">Tardiness Report</option>
                                    </select>
                                </div>
                                <button id="applyReportFiltersBtn" class="w-full bg-primary hover:bg-primary-dark text-white py-2 px-4 rounded-lg transition duration-300 smooth-transition btn-press">
                                    Apply Filters
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 lg:col-span-2">
                            <h3 class="text-lg font-medium text-gray-800 dark:text-white mb-4">Attendance Overview</h3>
                            <div id="attendanceOverviewChart" class="h-64 mb-4">
                                <!-- Chart will be rendered here -->
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Section</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Present</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Late</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Absent</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Rate</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="attendanceOverviewTable">
                                        <!-- Data will be loaded here dynamically -->
                                        <tr>
                                            <td colspan="5" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">Loading data...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Announcements Page -->
                <div id="announcementsPage" class="hidden">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Announcements</h2>
                        <button id="createAnnouncementBtn" class="bg-primary hover:bg-primary-dark text-white py-2 px-4 rounded-lg transition duration-300 flex items-center smooth-transition btn-press">
                            <i class="fas fa-plus mr-2"></i>
                            <span>New Announcement</span>
                        </button>
                    </div>
                    
                    <div class="space-y-4" id="announcementsList">
                        <!-- Announcements will be loaded here dynamically -->
                        <div class="skeleton h-32 rounded-xl"></div>
                        <div class="skeleton h-32 rounded-xl"></div>
                        <div class="skeleton h-32 rounded-xl"></div>
                    </div>
                </div>

                <!-- Settings Page -->
                <div id="settingsPage" class="hidden">
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6">Settings</h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2">
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 mb-6">
                                <h3 class="text-lg font-medium text-gray-800 dark:text-white mb-4">Profile Information</h3>
                                <div class="space-y-4">
                                    <div class="flex items-center">
                                        <div id="settingsAvatar" class="avatar w-16 h-16 rounded-full mr-4"></div>
                                        <div>
                                            <button id="changeAvatarBtn" class="text-sm text-primary hover:underline smooth-transition">Change Photo</button>
                                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">JPG, GIF or PNG. Max size of 2MB</p>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">First Name</label>
                                            <input type="text" id="firstName" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition" value="Maria">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Last Name</label>
                                            <input type="text" id="lastName" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition" value="Dela Cruz">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email</label>
                                        <input type="email" id="userEmail" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition" value="maria.delacruz@example.com">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Role</label>
                                        <input type="text" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-700 dark:text-white cursor-not-allowed smooth-transition" value="Teacher" disabled>
                                    </div>
                                    <div class="flex justify-end">
                                        <button id="saveProfileBtn" class="bg-primary hover:bg-primary-dark text-white py-2 px-4 rounded-lg transition duration-300 smooth-transition btn-press">
                                            Save Changes
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4">
                                <h3 class="text-lg font-medium text-gray-800 dark:text-white mb-4">Security</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Current Password</label>
                                        <input type="password" id="currentPassword" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition" placeholder="Enter current password">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">New Password</label>
                                        <input type="password" id="newPassword" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition" placeholder="Enter new password">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Confirm New Password</label>
                                        <input type="password" id="confirmNewPassword" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition" placeholder="Confirm new password">
                                    </div>
                                    <div class="flex justify-end">
                                        <button id="changePasswordBtn" class="bg-primary hover:bg-primary-dark text-white py-2 px-4 rounded-lg transition duration-300 smooth-transition btn-press">
                                            Change Password
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 mb-6">
                                <h3 class="text-lg font-medium text-gray-800 dark:text-white mb-4">Preferences</h3>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-800 dark:text-white">Dark Mode</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Switch between light and dark theme</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="darkModeToggle" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-light dark:peer-focus:ring-primary-dark rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-800 dark:text-white">Notifications</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Enable or disable notifications</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="notificationsToggle" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-light dark:peer-focus:ring-primary-dark rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-800 dark:text-white">Biometric Login</h4>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Use fingerprint or face recognition</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="biometricToggle" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-light dark:peer-focus:ring-primary-dark rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4">
                                <h3 class="text-lg font-medium text-gray-800 dark:text-white mb-4">Danger Zone</h3>
                                <div class="space-y-3">
                                    <button id="deleteAccountBtn" class="w-full text-left p-3 rounded-lg border border-red-500 text-red-500 hover:bg-red-50 dark:hover:bg-red-900 dark:hover:bg-opacity-20 transition duration-300 smooth-transition">
                                        <div class="flex items-center">
                                            <i class="fas fa-trash-alt mr-2"></i>
                                            <span>Delete Account</span>
                                        </div>
                                    </button>
                                    <button id="exportDataSettingsBtn" class="w-full text-left p-3 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-800 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-700 transition duration-300 smooth-transition">
                                        <div class="flex items-center">
                                            <i class="fas fa-download mr-2"></i>
                                            <span>Export All Data</span>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Check-in Modal (Student View) -->
    <div id="checkInModal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4">
        <div class="apple-modal bg-white dark:bg-gray-800">
            <div class="apple-modal-content">
                <div class="apple-modal-icon bg-green-100 dark:bg-green-900 check-in-animation">
                    <i class="fas fa-check-circle text-green-500 dark:text-green-300 text-2xl"></i>
                </div>
                <h3 class="apple-modal-title text-gray-800 dark:text-white">Check-in Successful!</h3>
                <p class="apple-modal-text text-gray-600 dark:text-gray-300">You have successfully checked in for <span class="font-medium" id="checkInSectionName">Grade 11 - STEM</span> at <span class="font-medium" id="checkInTime">8:15 AM</span>.</p>
                
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm text-gray-500 dark:text-gray-400">Location:</span>
                        <span class="text-sm font-medium text-gray-800 dark:text-white" id="checkInLocation">School Main Building</span>
                    </div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm text-gray-500 dark:text-gray-400">Distance:</span>
                        <span class="text-sm font-medium text-gray-800 dark:text-white" id="checkInDistance">50 meters</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-500 dark:text-gray-400">Status:</span>
                        <span class="text-sm font-medium text-green-500" id="checkInStatus">On Time</span>
                    </div>
                </div>
                
                <div class="apple-modal-actions">
                    <button id="closeCheckInModal" class="apple-modal-btn apple-modal-btn-primary smooth-transition btn-press">
                        Done
                    </button>
                    <button id="viewAttendanceDetailsBtn" class="apple-modal-btn apple-modal-btn-secondary smooth-transition btn-press">
                        View Details
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Panel -->
    <div id="notificationsPanel" class="fixed inset-y-0 right-0 z-40 w-80 bg-white dark:bg-gray-800 shadow-lg transform translate-x-full transition-transform duration-300 ease-in-out overflow-y-auto">
        <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
            <h3 class="text-lg font-bold text-gray-800 dark:text-white">Notifications</h3>
            <button id="closeNotificationsPanel" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 smooth-transition btn-press">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="p-2" id="notificationsList">
            <!-- Notifications will be loaded here dynamically -->
            <div class="p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 smooth-transition">
                <div class="flex items-start">
                    <div class="bg-blue-100 dark:bg-blue-900 p-2 rounded-lg mr-3">
                        <i class="fas fa-bell text-blue-500 dark:text-blue-300"></i>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-800 dark:text-white">New Announcement</h4>
                        <p class="text-sm text-gray-600 dark:text-gray-300">Principal has posted a new announcement</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">2 hours ago</p>
                    </div>
                </div>
            </div>
            
            <div class="p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 smooth-transition">
                <div class="flex items-start">
                    <div class="bg-green-100 dark:bg-green-900 p-2 rounded-lg mr-3">
                        <i class="fas fa-check-circle text-green-500 dark:text-green-300"></i>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-800 dark:text-white">Attendance Recorded</h4>
                        <p class="text-sm text-gray-600 dark:text-gray-300">Your attendance for Math class has been recorded</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Today, 8:15 AM</p>
                    </div>
                </div>
            </div>
            
            <div class="p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 smooth-transition">
                <div class="flex items-start">
                    <div class="bg-yellow-100 dark:bg-yellow-900 p-2 rounded-lg mr-3">
                        <i class="fas fa-exclamation-triangle text-yellow-500 dark:text-yellow-300"></i>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-800 dark:text-white">Upcoming Session</h4>
                        <p class="text-sm text-gray-600 dark:text-gray-300">Science class starts in 15 minutes</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Today, 9:45 AM</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="p-4 border-t border-gray-200 dark:border-gray-700">
            <button id="markAllAsReadBtn" class="w-full text-primary text-sm font-medium hover:underline smooth-transition">
                Mark all as read
            </button>
        </div>
    </div>

    <!-- Create Section Modal -->
    <div id="createSectionModal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 w-full max-w-md animate__animated animate__fadeInUp">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800 dark:text-white">Create New Section</h2>
                <button id="closeCreateSectionModal" class="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100 smooth-transition btn-press">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="sectionName">Section Name</label>
                    <input type="text" id="sectionName" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition" placeholder="e.g., Grade 11 - STEM">
                </div>
                
                <div>
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="sectionSubject">Subject</label>
                    <input type="text" id="sectionSubject" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition" placeholder="e.g., Mathematics">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 mb-2" for="sectionStartTime">Start Time</label>
                        <input type="time" id="sectionStartTime" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                    </div>
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 mb-2" for="sectionEndTime">End Time</label>
                        <input type="time" id="sectionEndTime" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                    </div>
                </div>
                
                <div>
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="sectionDays">Days</label>
                    <div class="flex flex-wrap gap-2">
                        <button class="day-selector px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-lg smooth-transition btn-press" data-day="monday">Mon</button>
                        <button class="day-selector px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-lg smooth-transition btn-press" data-day="tuesday">Tue</button>
                        <button class="day-selector px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-lg smooth-transition btn-press" data-day="wednesday">Wed</button>
                        <button class="day-selector px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-lg smooth-transition btn-press" data-day="thursday">Thu</button>
                        <button class="day-selector px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-lg smooth-transition btn-press" data-day="friday">Fri</button>
                        <button class="day-selector px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-lg smooth-transition btn-press" data-day="saturday">Sat</button>
                        <button class="day-selector px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-lg smooth-transition btn-press" data-day="sunday">Sun</button>
                    </div>
                    <input type="hidden" id="sectionDays" value="">
                </div>
                
                <div>
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="sectionLocation">Location</label>
                    <input type="text" id="sectionLocation" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition" placeholder="Building and Room Number">
                </div>
                
                <div>
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="sectionInviteCode">Invite Code (Optional)</label>
                    <div class="flex items-center">
                        <input type="text" id="sectionInviteCode" class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition" placeholder="Leave blank to auto-generate">
                        <button id="generateInviteCodeBtn" class="ml-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-800 dark:text-white py-2 px-3 rounded-lg border border-gray-300 dark:border-gray-600 smooth-transition btn-press">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 flex justify-end space-x-3">
                <button id="cancelCreateSectionBtn" class="bg-white dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white py-2 px-4 rounded-lg border border-gray-300 dark:border-gray-600 transition duration-300 smooth-transition btn-press">
                    Cancel
                </button>
                <button id="saveSectionBtn" class="bg-primary hover:bg-primary-dark text-white py-2 px-4 rounded-lg transition duration-300 flex items-center justify-center ripple smooth-transition btn-press">
                    <span id="saveSectionBtnText">Create Section</span>
                    <i id="saveSectionSpinner" class="fas fa-spinner fa-spin ml-2 hidden"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Start Session Modal -->
    <div id="startSessionModal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 w-full max-w-md animate__animated animate__fadeInUp">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800 dark:text-white">Start Attendance Session</h2>
                <button id="closeStartSessionModal" class="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100 smooth-transition btn-press">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="sessionSection">Section</label>
                    <select id="sessionSection" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                        <option value="">Select a section</option>
                        <option value="grade11-stem">Grade 11 - STEM</option>
                        <option value="grade10-a">Grade 10 - Section A</option>
                        <option value="grade9-b">Grade 9 - Section B</option>
                    </select>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 mb-2" for="sessionDate">Date</label>
                        <input type="date" id="sessionDate" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                    </div>
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 mb-2" for="sessionTime">Time</label>
                        <input type="time" id="sessionTime" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                    </div>
                </div>
                
                <div>
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="sessionDuration">Duration (minutes)</label>
                    <input type="number" id="sessionDuration" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition" value="30" min="5" max="120">
                </div>
                
                <div>
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="sessionLocation">Location</label>
                    <input type="text" id="sessionLocation" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition" placeholder="Building and Room Number">
                </div>
                
                <div class="flex items-center">
                    <input type="checkbox" id="enableGeofence" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded dark:bg-gray-700 smooth-transition" checked>
                    <label for="enableGeofence" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Require location check</label>
                </div>
                
                <div class="flex items-center">
                    <input type="checkbox" id="enableQrCode" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded dark:bg-gray-700 smooth-transition">
                    <label for="enableQrCode" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Generate QR code for check-in</label>
                </div>
            </div>
            
            <div class="mt-6 flex justify-end space-x-3">
                <button id="cancelStartSessionBtn" class="bg-white dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white py-2 px-4 rounded-lg border border-gray-300 dark:border-gray-600 transition duration-300 smooth-transition btn-press">
                    Cancel
                </button>
                <button id="confirmStartSessionBtn" class="bg-primary hover:bg-primary-dark text-white py-2 px-4 rounded-lg transition duration-300 flex items-center justify-center ripple smooth-transition btn-press">
                    <span id="startSessionBtnText">Start Session</span>
                    <i id="startSessionSpinner" class="fas fa-spinner fa-spin ml-2 hidden"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Active Session Modal -->
    <div id="activeSessionModal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 w-full max-w-md animate__animated animate__fadeInUp">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800 dark:text-white">Active Session</h2>
                <button id="closeActiveSessionModal" class="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100 smooth-transition btn-press">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="font-medium text-gray-800 dark:text-white" id="activeSessionSection">Grade 11 - STEM</h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400" id="activeSessionTime">Today, 8:00 AM - 9:30 AM</p>
                    </div>
                    <span class="px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-xs font-medium rounded-full">Active</span>
                </div>
                
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                    <div class="grid grid-cols-3 gap-4 text-center">
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Present</p>
                            <h3 class="text-xl font-bold text-green-500" id="activeSessionPresent">24</h3>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Late</p>
                            <h3 class="text-xl font-bold text-yellow-500" id="activeSessionLate">3</h3>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Absent</p>
                            <h3 class="text-xl font-bold text-red-500" id="activeSessionAbsent">5</h3>
                        </div>
                    </div>
                </div>
                
                <div>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">QR Code for Check-in</p>
                    <div class="bg-white p-2 rounded-lg border border-gray-200 dark:border-gray-600 flex justify-center">
                        <canvas id="sessionQrCode" width="200" height="200"></canvas>
                    </div>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-2 text-center">Students can scan this code to check in</p>
                </div>
                
                <div class="flex items-center justify-between">
                    <p class="text-sm text-gray-500 dark:text-gray-400">Session ends in:</p>
                    <p class="text-sm font-medium text-gray-800 dark:text-white" id="sessionTimeRemaining">25 minutes</p>
                </div>
            </div>
            
            <div class="mt-6 flex justify-end space-x-3">
                <button id="endSessionBtn" class="bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg transition duration-300 flex items-center justify-center ripple smooth-transition btn-press">
                    <i class="fas fa-stop mr-2"></i>
                    <span>End Session</span>
                </button>
                <button id="viewSessionDetailsBtn" class="bg-primary hover:bg-primary-dark text-white py-2 px-4 rounded-lg transition duration-300 flex items-center justify-center ripple smooth-transition btn-press">
                    <i class="fas fa-eye mr-2"></i>
                    <span>View Details</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Create Announcement Modal -->
    <div id="createAnnouncementModal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 w-full max-w-md animate__animated animate__fadeInUp">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800 dark:text-white">New Announcement</h2>
                <button id="closeCreateAnnouncementModal" class="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100 smooth-transition btn-press">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="announcementTitle">Title</label>
                    <input type="text" id="announcementTitle" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition" placeholder="Announcement title">
                </div>
                
                <div>
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="announcementContent">Content</label>
                    <textarea id="announcementContent" rows="4" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition" placeholder="Write your announcement here..."></textarea>
                </div>
                
                <div>
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="announcementRecipients">Recipients</label>
                    <select id="announcementRecipients" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white smooth-transition">
                        <option value="all">All Students</option>
                        <option value="specific">Specific Sections</option>
                    </select>
                </div>
                
                <div id="specificSectionsContainer" class="hidden">
                    <label class="block text-gray-700 dark:text-gray-300 mb-2">Select Sections</label>
                    <div class="space-y-2">
                        <div class="flex items-center">
                            <input type="checkbox" id="section-grade11-stem" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded dark:bg-gray-700 smooth-transition">
                            <label for="section-grade11-stem" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Grade 11 - STEM</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="section-grade10-a" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded dark:bg-gray-700 smooth-transition">
                            <label for="section-grade10-a" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Grade 10 - Section A</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="section-grade9-b" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded dark:bg-gray-700 smooth-transition">
                            <label for="section-grade9-b" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Grade 9 - Section B</label>
                        </div>
                    </div>
                </div>
                
                <div class="flex items-center">
                    <input type="checkbox" id="announcementImportant" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded dark:bg-gray-700 smooth-transition">
                    <label for="announcementImportant" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Mark as important</label>
                </div>
            </div>
            
            <div class="mt-6 flex justify-end space-x-3">
                <button id="cancelCreateAnnouncementBtn" class="bg-white dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white py-2 px-4 rounded-lg border border-gray-300 dark:border-gray-600 transition duration-300 smooth-transition btn-press">
                    Cancel
                </button>
                <button id="postAnnouncementBtn" class="bg-primary hover:bg-primary-dark text-white py-2 px-4 rounded-lg transition duration-300 flex items-center justify-center ripple smooth-transition btn-press">
                    <span id="postAnnouncementBtnText">Post Announcement</span>
                    <i id="postAnnouncementSpinner" class="fas fa-spinner fa-spin ml-2 hidden"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmationModal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4">
        <div class="apple-modal bg-white dark:bg-gray-800">
            <div class="apple-modal-content">
                <div class="apple-modal-icon bg-red-100 dark:bg-red-900">
                    <i class="fas fa-exclamation-triangle text-red-500 dark:text-red-300 text-2xl"></i>
                </div>
                <h3 class="apple-modal-title text-gray-800 dark:text-white">Confirm Deletion</h3>
                <p class="apple-modal-text text-gray-600 dark:text-gray-300" id="deleteConfirmationText">Are you sure you want to delete this item? This action cannot be undone.</p>
                
                <div class="apple-modal-actions">
                    <button id="confirmDeleteBtn" class="apple-modal-btn bg-red-500 hover:bg-red-600 text-white smooth-transition btn-press">
                        Delete
                    </button>
                    <button id="cancelDeleteBtn" class="apple-modal-btn apple-modal-btn-secondary smooth-transition btn-press">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 z-50 flex items-center justify-center bg-white dark:bg-gray-900">
        <div class="text-center">
            <div class="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto"></div>
            <h1 class="text-2xl font-bold mt-4 text-gray-800 dark:text-white">NearCheck</h1>
            <p class="text-gray-500 dark:text-gray-400 mt-2">Loading your dashboard...</p>
        </div>
    </div>

    <!-- QR Code Scanner -->
    <div id="qrScannerModal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90 p-4">
        <div class="w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-white">QR Code Scanner</h2>
                <button id="closeQrScannerModal" class="text-white hover:text-gray-300 smooth-transition btn-press">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="relative">
                <video id="qrScanner" class="w-full h-auto rounded-lg" playsinline></video>
                <div class="absolute inset-0 border-4 border-primary rounded-lg pointer-events-none" style="margin: 20%;"></div>
            </div>
            
            <p class="text-white text-center mt-4">Align the QR code within the frame to scan</p>
        </div>
    </div>

    <!-- Confetti Container -->
    <div id="confettiContainer" class="fixed inset-0 pointer-events-none z-50 overflow-hidden"></div>

    <!-- Service Worker Registration for PWA -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }).catch(err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>

    <!-- Firebase Configuration -->
    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCVP8zaUj2iDrooLbRQNypHqB8QNTLhGDE",
            authDomain: "attendance-fe1c8.firebaseapp.com",
            projectId: "attendance-fe1c8",
            storageBucket: "attendance-fe1c8.appspot.com",
            messagingSenderId: "903463376704",
            appId: "1:903463376704:web:d004c563d56aa286df8ca5",
            measurementId: "G-YY5GQZPSRK"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const realtimeDb = firebase.database();
        const messaging = firebase.messaging();
        const analytics = firebase.analytics();
    </script>

    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Main Application Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // UI Elements
            const authModal = document.getElementById('authModal');
            const forgotPasswordModal = document.getElementById('forgotPasswordModal');
            const permissionModal = document.getElementById('permissionModal');
            const customPermissionModal = document.getElementById('customPermissionModal');
            const appContainer = document.getElementById('appContainer');
            const loadingScreen = document.getElementById('loadingScreen');
            const drawer = document.getElementById('drawer');
            const menuBtn = document.getElementById('menuBtn');
            const closeDrawer = document.getElementById('closeDrawer');
            const themeToggle = document.getElementById('themeToggle');
            const logoutBtn = document.getElementById('logoutBtn');
            const checkInModal = document.getElementById('checkInModal');
            const notificationsPanel = document.getElementById('notificationsPanel');
            const notificationsBtn = document.getElementById('notificationsBtn');
            const closeNotificationsPanel = document.getElementById('closeNotificationsPanel');
            const markAllAsReadBtn = document.getElementById('markAllAsReadBtn');
            const qrScannerModal = document.getElementById('qrScannerModal');
            const qrScanner = document.getElementById('qrScanner');
            const closeQrScannerModal = document.getElementById('closeQrScannerModal');
            const confettiContainer = document.getElementById('confettiContainer');
            
            // Auth Modal Elements
            const loginTab = document.getElementById('loginTab');
            const registerTab = document.getElementById('registerTab');
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const registerRole = document.getElementById('registerRole');
            const teacherFields = document.getElementById('teacherFields');
            const studentFields = document.getElementById('studentFields');
            const loginBtn = document.getElementById('loginBtn');
            const registerBtn = document.getElementById('registerBtn');
            const googleLoginBtn = document.getElementById('googleLoginBtn');
            const appleLoginBtn = document.getElementById('appleLoginBtn');
            const closeAuthModal = document.getElementById('closeAuthModal');
            const forgotPasswordBtn = document.getElementById('forgotPasswordBtn');
            const toggleLoginPassword = document.getElementById('toggleLoginPassword');
            const loginPassword = document.getElementById('loginPassword');
            const toggleRegisterPassword = document.getElementById('toggleRegisterPassword');
            const registerPassword = document.getElementById('registerPassword');
            const toggleRegisterConfirmPassword = document.getElementById('toggleRegisterConfirmPassword');
            const registerConfirmPassword = document.getElementById('registerConfirmPassword');
            
            // Forgot Password Modal Elements
            const resetEmail = document.getElementById('resetEmail');
            const sendResetLinkBtn = document.getElementById('sendResetLinkBtn');
            const cancelResetBtn = document.getElementById('cancelResetBtn');
            const resetBtnText = document.getElementById('resetBtnText');
            const resetSpinner = document.getElementById('resetSpinner');
            
            // Permission Modal Elements
            const allowAllBtn = document.getElementById('allowAllBtn');
            const customizeBtn = document.getElementById('customizeBtn');
            const denyBtn = document.getElementById('denyBtn');
            const closeCustomPermissionModal = document.getElementById('closeCustomPermissionModal');
            const locationPermissionToggle = document.getElementById('locationPermissionToggle');
            const notificationPermissionToggle = document.getElementById('notificationPermissionToggle');
            const cameraPermissionToggle = document.getElementById('cameraPermissionToggle');
            const savePermissionsBtn = document.getElementById('savePermissionsBtn');
            
            // Check-in Modal Elements
            const closeCheckInModal = document.getElementById('closeCheckInModal');
            const viewAttendanceDetailsBtn = document.getElementById('viewAttendanceDetailsBtn');
            const checkInSectionName = document.getElementById('checkInSectionName');
            const checkInTime = document.getElementById('checkInTime');
            const checkInLocation = document.getElementById('checkInLocation');
            const checkInDistance = document.getElementById('checkInDistance');
            const checkInStatus = document.getElementById('checkInStatus');
            
            // Navigation Elements
            const sectionsLink = document.getElementById('sectionsLink');
            const attendanceLink = document.getElementById('attendanceLink');
            const reportsLink = document.getElementById('reportsLink');
            const announcementsLink = document.getElementById('announcementsLink');
            const settingsLink = document.getElementById('settingsLink');
            const pageTitle = document.getElementById('pageTitle');
            const contentArea = document.getElementById('contentArea');
            const dashboardPage = document.getElementById('dashboardPage');
            const sectionsPage = document.getElementById('sectionsPage');
            const attendancePage = document.getElementById('attendancePage');
            const reportsPage = document.getElementById('reportsPage');
            const announcementsPage = document.getElementById('announcementsPage');
            const settingsPage = document.getElementById('settingsPage');
            
            // Create Section Modal Elements
            const createSectionModal = document.getElementById('createSectionModal');
            const createSectionBtn = document.getElementById('createSectionBtn');
            const closeCreateSectionModal = document.getElementById('closeCreateSectionModal');
            const sectionName = document.getElementById('sectionName');
            const sectionSubject = document.getElementById('sectionSubject');
            const sectionStartTime = document.getElementById('sectionStartTime');
            const sectionEndTime = document.getElementById('sectionEndTime');
            const sectionDays = document.getElementById('sectionDays');
            const sectionLocation = document.getElementById('sectionLocation');
            const sectionInviteCode = document.getElementById('sectionInviteCode');
            const generateInviteCodeBtn = document.getElementById('generateInviteCodeBtn');
            const cancelCreateSectionBtn = document.getElementById('cancelCreateSectionBtn');
            const saveSectionBtn = document.getElementById('saveSectionBtn');
            const saveSectionBtnText = document.getElementById('saveSectionBtnText');
            const saveSectionSpinner = document.getElementById('saveSectionSpinner');
            
            // Start Session Modal Elements
            const startSessionModal = document.getElementById('startSessionModal');
            const startSessionBtn = document.getElementById('startSessionBtn');
            const closeStartSessionModal = document.getElementById('closeStartSessionModal');
            const sessionSection = document.getElementById('sessionSection');
            const sessionDate = document.getElementById('sessionDate');
            const sessionTime = document.getElementById('sessionTime');
            const sessionDuration = document.getElementById('sessionDuration');
            const sessionLocation = document.getElementById('sessionLocation');
            const enableGeofence = document.getElementById('enableGeofence');
            const enableQrCode = document.getElementById('enableQrCode');
            const cancelStartSessionBtn = document.getElementById('cancelStartSessionBtn');
            const confirmStartSessionBtn = document.getElementById('confirmStartSessionBtn');
            const startSessionBtnText = document.getElementById('startSessionBtnText');
            const startSessionSpinner = document.getElementById('startSessionSpinner');
            
            // Active Session Modal Elements
            const activeSessionModal = document.getElementById('activeSessionModal');
            const closeActiveSessionModal = document.getElementById('closeActiveSessionModal');
            const activeSessionSection = document.getElementById('activeSessionSection');
            const activeSessionTime = document.getElementById('activeSessionTime');
            const activeSessionPresent = document.getElementById('activeSessionPresent');
            const activeSessionLate = document.getElementById('activeSessionLate');
            const activeSessionAbsent = document.getElementById('activeSessionAbsent');
            const sessionQrCode = document.getElementById('sessionQrCode');
            const sessionTimeRemaining = document.getElementById('sessionTimeRemaining');
            const endSessionBtn = document.getElementById('endSessionBtn');
            const viewSessionDetailsBtn = document.getElementById('viewSessionDetailsBtn');
            
            // Create Announcement Modal Elements
            const createAnnouncementModal = document.getElementById('createAnnouncementModal');
            const createAnnouncementBtn = document.getElementById('createAnnouncementBtn');
            const closeCreateAnnouncementModal = document.getElementById('closeCreateAnnouncementModal');
            const announcementTitle = document.getElementById('announcementTitle');
            const announcementContent = document.getElementById('announcementContent');
            const announcementRecipients = document.getElementById('announcementRecipients');
            const specificSectionsContainer = document.getElementById('specificSectionsContainer');
            const announcementImportant = document.getElementById('announcementImportant');
            const cancelCreateAnnouncementBtn = document.getElementById('cancelCreateAnnouncementBtn');
            const postAnnouncementBtn = document.getElementById('postAnnouncementBtn');
            const postAnnouncementBtnText = document.getElementById('postAnnouncementBtnText');
            const postAnnouncementSpinner = document.getElementById('postAnnouncementSpinner');
            
            // Delete Confirmation Modal Elements
            const deleteConfirmationModal = document.getElementById('deleteConfirmationModal');
            const deleteConfirmationText = document.getElementById('deleteConfirmationText');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
            const deleteAccountBtn = document.getElementById('deleteAccountBtn');
            
            // Dashboard Elements
            const activeSessionsCount = document.getElementById('activeSessionsCount');
            const activeSessionsText = document.getElementById('activeSessionsText');
            const attendanceRate = document.getElementById('attendanceRate');
            const attendanceTrend = document.getElementById('attendanceTrend');
            const pendingAlertsCount = document.getElementById('pendingAlertsCount');
            const alertsText = document.getElementById('alertsText');
            const totalStudentsCount = document.getElementById('totalStudentsCount');
            const studentsText = document.getElementById('studentsText');
            const recentCheckinsList = document.getElementById('recentCheckinsList');
            const aiWarningsList = document.getElementById('aiWarningsList');
            const sectionActivityList = document.getElementById('sectionActivityList');
            const viewAllCheckinsBtn = document.getElementById('viewAllCheckinsBtn');
            const viewAllWarningsBtn = document.getElementById('viewAllWarningsBtn');
            const viewAllSectionsBtn = document.getElementById('viewAllSectionsBtn');
            
            // Attendance Elements
            const attendanceFilter = document.getElementById('attendanceFilter');
            const refreshAttendanceBtn = document.getElementById('refreshAttendanceBtn');
            const attendanceSessionsTable = document.getElementById('attendanceSessionsTable');
            const attendanceRecordsChart = document.getElementById('attendanceRecordsChart');
            const attendanceReportsBtn = document.getElementById('attendanceReportsBtn');
            
            // Reports Elements
            const reportSectionFilter = document.getElementById('reportSectionFilter');
            const reportDateRange = document.getElementById('reportDateRange');
            const customDateRangeContainer = document.getElementById('customDateRangeContainer');
            const reportStartDate = document.getElementById('reportStartDate');
            const reportEndDate = document.getElementById('reportEndDate');
            const reportType = document.getElementById('reportType');
            const applyReportFiltersBtn = document.getElementById('applyReportFiltersBtn');
            const attendanceOverviewChart = document.getElementById('attendanceOverviewChart');
            const attendanceOverviewTable = document.getElementById('attendanceOverviewTable');
            const generateReportBtn = document.getElementById('generateReportBtn');
            const exportDataBtn = document.getElementById('exportDataBtn');
            
            // Settings Elements
            const settingsAvatar = document.getElementById('settingsAvatar');
            const changeAvatarBtn = document.getElementById('changeAvatarBtn');
            const firstName = document.getElementById('firstName');
            const lastName = document.getElementById('lastName');
            const userEmail = document.getElementById('userEmail');
            const saveProfileBtn = document.getElementById('saveProfileBtn');
            const currentPassword = document.getElementById('currentPassword');
            const newPassword = document.getElementById('newPassword');
            const confirmNewPassword = document.getElementById('confirmNewPassword');
            const changePasswordBtn = document.getElementById('changePasswordBtn');
            const darkModeToggle = document.getElementById('darkModeToggle');
            const notificationsToggle = document.getElementById('notificationsToggle');
            const biometricToggle = document.getElementById('biometricToggle');
            const exportDataSettingsBtn = document.getElementById('exportDataSettingsBtn');
            
            // App State
            let currentUser = null;
            let userData = {};
            let activeSessions = [];
            let notifications = [];
            let unreadNotifications = 0;
            let currentPage = 'dashboard';
            let qrScannerActive = false;
            let qrCodeScanner = null;
            
            // Initialize the app
            function initApp() {
                // Check authentication state
                auth.onAuthStateChanged(user => {
                    if (user) {
                        // User is signed in
                        currentUser = user;
                        loadUserData(user.uid).then(() => {
                            simulateLoading(() => {
                                loadingScreen.classList.add('hidden');
                                appContainer.classList.remove('hidden');
                                setupUserProfile(user);
                                
                                // Load initial data
                                loadDashboardData();
                                loadNotifications();
                                
                                // Show permission modal if not already shown
                                const permissionsShown = localStorage.getItem('permissionsShown');
                                if (!permissionsShown) {
                                    setTimeout(() => {
                                        showPermissionModal();
                                    }, 1000);
                                }
                                
                                // Initialize analytics
                                logEvent('login', { method: user.providerData[0].providerId });
                            });
                        });
                    } else {
                        // No user is signed in
                        loadingScreen.classList.add('hidden');
                        showAuthModal();
                    }
                });
                
                // Setup event listeners
                setupEventListeners();
                
                // Check for saved theme preference
                checkThemePreference();
                
                // Initialize animations
                initAnimations();
            }
            
            // Load user data from Firestore
            async function loadUserData(userId) {
                try {
                    const doc = await db.collection('users').doc(userId).get();
                    if (doc.exists) {
                        userData = doc.data();
                    } else {
                        // Create new user document if it doesn't exist
                        userData = {
                            name: currentUser.displayName || demoUser.name,
                            email: currentUser.email || demoUser.email,
                            role: 'teacher', // Default role
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                        };
                        await db.collection('users').doc(userId).set(userData);
                    }
                } catch (error) {
                    console.error('Error loading user data:', error);
                    showToast('Error loading user data. Please try again.', 'error');
                }
            }
            
            // Setup event listeners
            function setupEventListeners() {
                // Auth modal tabs
                loginTab.addEventListener('click', () => {
                    loginTab.classList.add('border-primary', 'text-primary');
                    registerTab.classList.remove('border-primary', 'text-primary');
                    registerTab.classList.add('text-gray-500', 'dark:text-gray-400');
                    loginForm.classList.remove('hidden');
                    registerForm.classList.add('hidden');
                });
                
                registerTab.addEventListener('click', () => {
                    registerTab.classList.add('border-primary', 'text-primary');
                    loginTab.classList.remove('border-primary', 'text-primary');
                    loginTab.classList.add('text-gray-500', 'dark:text-gray-400');
                    registerForm.classList.remove('hidden');
                    loginForm.classList.add('hidden');
                });
                
                // Role selection
                registerRole.addEventListener('change', (e) => {
                    if (e.target.value === 'teacher') {
                        teacherFields.classList.remove('hidden');
                        studentFields.classList.add('hidden');
                    } else {
                        teacherFields.classList.add('hidden');
                        studentFields.classList.remove('hidden');
                    }
                });
                
                // Toggle password visibility
                toggleLoginPassword.addEventListener('click', () => {
                    const type = loginPassword.getAttribute('type') === 'password' ? 'text' : 'password';
                    loginPassword.setAttribute('type', type);
                    toggleLoginPassword.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
                });
                
                toggleRegisterPassword.addEventListener('click', () => {
                    const type = registerPassword.getAttribute('type') === 'password' ? 'text' : 'password';
                    registerPassword.setAttribute('type', type);
                    toggleRegisterPassword.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
                });
                
                toggleRegisterConfirmPassword.addEventListener('click', () => {
                    const type = registerConfirmPassword.getAttribute('type') === 'password' ? 'text' : 'password';
                    registerConfirmPassword.setAttribute('type', type);
                    toggleRegisterConfirmPassword.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
                });
                
                // Login button
                loginBtn.addEventListener('click', handleLogin);
                
                // Register button
                registerBtn.addEventListener('click', handleRegistration);
                
                // Google login
                googleLoginBtn.addEventListener('click', signInWithGoogle);
                
                // Apple login (placeholder - would need proper implementation)
                appleLoginBtn.addEventListener('click', () => {
                    showToast('Apple login would be implemented here', 'info');
                });
                
                // Forgot password
                forgotPasswordBtn.addEventListener('click', () => {
                    authModal.classList.remove('modal-open');
                    showForgotPasswordModal();
                });
                
                sendResetLinkBtn.addEventListener('click', sendPasswordResetEmail);
                cancelResetBtn.addEventListener('click', () => {
                    forgotPasswordModal.classList.remove('modal-open');
                    showAuthModal();
                });
                
                // Close auth modal
                closeAuthModal.addEventListener('click', () => {
                    authModal.classList.remove('modal-open');
                });
                
                // Permission modal buttons
                allowAllBtn.addEventListener('click', () => {
                    localStorage.setItem('permissionsShown', 'true');
                    permissionModal.classList.remove('modal-open');
                    requestAllPermissions();
                });
                
                customizeBtn.addEventListener('click', () => {
                    permissionModal.classList.remove('modal-open');
                    showCustomPermissionModal();
                });
                
                denyBtn.addEventListener('click', () => {
                    localStorage.setItem('permissionsShown', 'true');
                    permissionModal.classList.remove('modal-open');
                });
                
                closeCustomPermissionModal.addEventListener('click', () => {
                    customPermissionModal.classList.remove('modal-open');
                });
                
                savePermissionsBtn.addEventListener('click', () => {
                    localStorage.setItem('permissionsShown', 'true');
                    customPermissionModal.classList.remove('modal-open');
                    
                    // Request selected permissions
                    if (locationPermissionToggle.checked) {
                        requestLocationPermission();
                    }
                    if (notificationPermissionToggle.checked) {
                        requestNotificationPermission();
                    }
                    if (cameraPermissionToggle.checked) {
                        requestCameraPermission();
                    }
                });
                
                // Drawer menu
                menuBtn.addEventListener('click', () => {
                    drawer.classList.add('drawer-open');
                    document.body.style.overflow = 'hidden';
                });
                
                closeDrawer.addEventListener('click', () => {
                    drawer.classList.remove('drawer-open');
                    document.body.style.overflow = '';
                });
                
                // Theme toggle
                themeToggle.addEventListener('click', toggleTheme);
                
                // Logout button
                logoutBtn.addEventListener('click', handleLogout);
                
                // Close check-in modal
                closeCheckInModal.addEventListener('click', () => {
                    checkInModal.classList.remove('modal-open');
                });
                
                viewAttendanceDetailsBtn.addEventListener('click', () => {
                    checkInModal.classList.remove('modal-open');
                    navigateTo('attendance');
                });
                
                // Notifications panel
                notificationsBtn.addEventListener('click', () => {
                    notificationsPanel.classList.remove('translate-x-full');
                    document.body.style.overflow = 'hidden';
                });
                
                closeNotificationsPanel.addEventListener('click', () => {
                    notificationsPanel.classList.add('translate-x-full');
                    document.body.style.overflow = '';
                });
                
                markAllAsReadBtn.addEventListener('click', markAllNotificationsAsRead);
                
                // QR Scanner
                closeQrScannerModal.addEventListener('click', () => {
                    stopQrScanner();
                    qrScannerModal.classList.remove('modal-open');
                });
                
                // Navigation links
                sectionsLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    navigateTo('sections');
                });
                
                attendanceLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    navigateTo('attendance');
                });
                
                reportsLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    navigateTo('reports');
                });
                
                announcementsLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    navigateTo('announcements');
                });
                
                settingsLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    navigateTo('settings');
                });
                
                // Create section
                createSectionBtn.addEventListener('click', () => {
                    showCreateSectionModal();
                });
                
                closeCreateSectionModal.addEventListener('click', () => {
                    createSectionModal.classList.remove('modal-open');
                });
                
                cancelCreateSectionBtn.addEventListener('click', () => {
                    createSectionModal.classList.remove('modal-open');
                });
                
                generateInviteCodeBtn.addEventListener('click', generateInviteCode);
                
                // Day selectors
                document.querySelectorAll('.day-selector').forEach(button => {
                    button.addEventListener('click', function() {
                        this.classList.toggle('bg-primary');
                        this.classList.toggle('text-white');
                        this.classList.toggle('border-primary');
                        updateSelectedDays();
                    });
                });
                
                saveSectionBtn.addEventListener('click', saveSection);
                
                // Start session
                startSessionBtn.addEventListener('click', () => {
                    showStartSessionModal();
                });
                
                closeStartSessionModal.addEventListener('click', () => {
                    startSessionModal.classList.remove('modal-open');
                });
                
                cancelStartSessionBtn.addEventListener('click', () => {
                    startSessionModal.classList.remove('modal-open');
                });
                
                confirmStartSessionBtn.addEventListener('click', startAttendanceSession);
                
                // Active session
                closeActiveSessionModal.addEventListener('click', () => {
                    activeSessionModal.classList.remove('modal-open');
                });
                
                endSessionBtn.addEventListener('click', endAttendanceSession);
                
                viewSessionDetailsBtn.addEventListener('click', () => {
                    activeSessionModal.classList.remove('modal-open');
                    navigateTo('attendance');
                });
                
                // Create announcement
                createAnnouncementBtn.addEventListener('click', () => {
                    showCreateAnnouncementModal();
                });
                
                closeCreateAnnouncementModal.addEventListener('click', () => {
                    createAnnouncementModal.classList.remove('modal-open');
                });
                
                cancelCreateAnnouncementBtn.addEventListener('click', () => {
                    createAnnouncementModal.classList.remove('modal-open');
                });
                
                announcementRecipients.addEventListener('change', (e) => {
                    if (e.target.value === 'specific') {
                        specificSectionsContainer.classList.remove('hidden');
                    } else {
                        specificSectionsContainer.classList.add('hidden');
                    }
                });
                
                postAnnouncementBtn.addEventListener('click', postAnnouncement);
                
                // Delete confirmation
                cancelDeleteBtn.addEventListener('click', () => {
                    deleteConfirmationModal.classList.remove('modal-open');
                });
                
                deleteAccountBtn.addEventListener('click', () => {
                    showDeleteConfirmation(
                        'Are you sure you want to delete your account? All your data will be permanently removed.',
                        deleteUserAccount
                    );
                });
                
                // Report filters
                reportDateRange.addEventListener('change', (e) => {
                    if (e.target.value === 'custom') {
                        customDateRangeContainer.classList.remove('hidden');
                    } else {
                        customDateRangeContainer.classList.add('hidden');
                    }
                });
                
                applyReportFiltersBtn.addEventListener('click', applyReportFilters);
                
                // Add ripple effect to buttons
                document.querySelectorAll('.ripple').forEach(button => {
                    button.addEventListener('click', createRipple);
                });
                
                // Add press effect to buttons
                document.querySelectorAll('.btn-press').forEach(button => {
                    button.addEventListener('mousedown', () => {
                        button.style.transform = 'scale(0.96)';
                    });
                    button.addEventListener('mouseup', () => {
                        button.style.transform = '';
                    });
                    button.addEventListener('mouseleave', () => {
                        button.style.transform = '';
                    });
                });
                
                // Handle back button/gesture for drawer and panels
                window.addEventListener('popstate', () => {
                    if (drawer.classList.contains('drawer-open')) {
                        drawer.classList.remove('drawer-open');
                        document.body.style.overflow = '';
                    }
                    if (!notificationsPanel.classList.contains('translate-x-full')) {
                        notificationsPanel.classList.add('translate-x-full');
                        document.body.style.overflow = '';
                    }
                });
            }
            
            // Initialize animations
            function initAnimations() {
                // Animate all modals when shown
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            const modalContent = modal.querySelector('.apple-modal') || modal.querySelector('div > div');
                            modalContent.classList.add('animate__animated', 'animate__fadeOutDown');
                            setTimeout(() => {
                                modal.classList.remove('modal-open');
                                modalContent.classList.remove('animate__animated', 'animate__fadeOutDown');
                            }, 300);
                        }
                    });
                });
                
                // Add subtle animation to cards when they come into view
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('animate__animated', 'animate__fadeInUp');
                            observer.unobserve(entry.target);
                        }
                    });
                }, { threshold: 0.1 });
                
                document.querySelectorAll('.card-hover').forEach(card => {
                    observer.observe(card);
                });
            }
            
            // Check and apply saved theme preference
            function checkThemePreference() {
                const savedTheme = localStorage.getItem('theme') || 'light';
                document.documentElement.setAttribute('data-theme', savedTheme);
                
                // Set correct icon for theme toggle
                if (savedTheme === 'dark') {
                    themeToggle.querySelector('i').classList.replace('fa-moon', 'fa-sun');
                    themeToggle.querySelector('span').textContent = 'Light Mode';
                    darkModeToggle.checked = true;
                } else {
                    themeToggle.querySelector('i').classList.replace('fa-sun', 'fa-moon');
                    themeToggle.querySelector('span').textContent = 'Dark Mode';
                    darkModeToggle.checked = false;
                }
            }
            
            // Toggle between light and dark theme
            function toggleTheme() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                
                // Update icon and text
                const icon = themeToggle.querySelector('i');
                const text = themeToggle.querySelector('span');
                
                if (newTheme === 'dark') {
                    icon.classList.replace('fa-moon', 'fa-sun');
                    text.textContent = 'Light Mode';
                    darkModeToggle.checked = true;
                } else {
                    icon.classList.replace('fa-sun', 'fa-moon');
                    text.textContent = 'Dark Mode';
                    darkModeToggle.checked = false;
                }
                
                logEvent('theme_change', { theme: newTheme });
            }
            
            // Handle user login
            async function handleLogin() {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                const rememberMe = document.getElementById('rememberMe').checked;
                
                if (!email || !password) {
                    showToast('Please enter both email and password', 'error');
                    return;
                }
                
                // Show loading spinner
                const spinner = document.getElementById('loginSpinner');
                const btnText = document.getElementById('loginBtnText');
                btnText.textContent = 'Authenticating...';
                spinner.classList.remove('hidden');
                
                try {
                    // Set persistence based on "Remember me" selection
                    await auth.setPersistence(
                        rememberMe ? firebase.auth.Auth.Persistence.LOCAL : firebase.auth.Auth.Persistence.SESSION
                    );
                    
                    // Sign in with email and password
                    await auth.signInWithEmailAndPassword(email, password);
                    
                    // Log event
                    logEvent('login', { method: 'email' });
                    
                    // Close auth modal and show loading screen
                    authModal.classList.remove('modal-open');
                    loadingScreen.classList.remove('hidden');
                } catch (error) {
                    console.error('Login error:', error);
                    
                    // Reset button
                    btnText.textContent = 'Login';
                    spinner.classList.add('hidden');
                    
                    // Show error message
                    let errorMessage = 'Login failed. Please try again.';
                    switch (error.code) {
                        case 'auth/user-not-found':
                            errorMessage = 'No user found with this email.';
                            break;
                        case 'auth/wrong-password':
                            errorMessage = 'Incorrect password. Please try again.';
                            break;
                        case 'auth/user-disabled':
                            errorMessage = 'This account has been disabled.';
                            break;
                        case 'auth/invalid-email':
                            errorMessage = 'Please enter a valid email address.';
                            break;
                    }
                    
                    showToast(errorMessage, 'error');
                }
            }
            
            // Handle user registration
            async function handleRegistration() {
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const confirmPassword = document.getElementById('registerConfirmPassword').value;
                const role = document.getElementById('registerRole').value;
                const acceptTerms = document.getElementById('acceptTerms').checked;
                
                // Validate inputs
                if (!name || !email || !password || !confirmPassword) {
                    showToast('Please fill in all fields', 'error');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showToast('Passwords do not match', 'error');
                    return;
                }
                
                if (password.length < 8) {
                    showToast('Password must be at least 8 characters', 'error');
                    return;
                }
                
                if (!acceptTerms) {
                    showToast('You must accept the terms and conditions', 'error');
                    return;
                }
                
                if (role === 'teacher') {
                    const birthdate = document.getElementById('registerBirthdate').value;
                    if (!birthdate) {
                        showToast('Please enter your birthdate', 'error');
                        return;
                    }
                    
                    // Check if teacher is at least 20 years old
                    const birthDate = new Date(birthdate);
                    const today = new Date();
                    const age = today.getFullYear() - birthDate.getFullYear();
                    const monthDiff = today.getMonth() - birthDate.getMonth();
                    
                    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                        age--;
                    }
                    
                    if (age < 20) {
                        showToast('You must be at least 20 years old to register as a teacher', 'error');
                        return;
                    }
                } else {
                    const inviteCode = document.getElementById('registerInviteCode').value;
                    if (!inviteCode) {
                        showToast('Please enter an invite code', 'error');
                        return;
                    }
                    
                    // In a real app, we would validate the invite code here
                }
                
                // Show loading spinner
                const spinner = document.getElementById('registerSpinner');
                const btnText = document.getElementById('registerBtnText');
                btnText.textContent = 'Creating Account...';
                spinner.classList.remove('hidden');
                
                try {
                    // Create user with email and password
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    
                    // Update user profile with display name
                    await userCredential.user.updateProfile({
                        displayName: name
                    });
                    
                    // Save additional user data to Firestore
                    const userData = {
                        name: name,
                        email: email,
                        role: role,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    await db.collection('users').doc(userCredential.user.uid).set(userData);
                    
                    // Log event
                    logEvent('sign_up', { method: 'email', role: role });
                    
                    // Close auth modal and show loading screen
                    authModal.classList.remove('modal-open');
                    loadingScreen.classList.remove('hidden');
                } catch (error) {
                    console.error('Registration error:', error);
                    
                    // Reset button
                    btnText.textContent = 'Create Account';
                    spinner.classList.add('hidden');
                    
                    // Show error message
                    let errorMessage = 'Registration failed. Please try again.';
                    switch (error.code) {
                        case 'auth/email-already-in-use':
                            errorMessage = 'This email is already registered.';
                            break;
                        case 'auth/invalid-email':
                            errorMessage = 'Please enter a valid email address.';
                            break;
                        case 'auth/weak-password':
                            errorMessage = 'Password should be at least 6 characters.';
                            break;
                    }
                    
                    showToast(errorMessage, 'error');
                }
            }
            
            // Sign in with Google
            async function signInWithGoogle() {
                try {
                    const provider = new firebase.auth.GoogleAuthProvider();
                    provider.addScope('profile');
                    provider.addScope('email');
                    
                    // Show loading
                    loadingScreen.classList.remove('hidden');
                    
                    const result = await auth.signInWithPopup(provider);
                    
                    // Check if user is new
                    const isNewUser = result.additionalUserInfo.isNewUser;
                    
                    if (isNewUser) {
                        // Save user data to Firestore
                        const userData = {
                            name: result.user.displayName,
                            email: result.user.email,
                            role: 'teacher', // Default role for Google sign-ups
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                        };
                        
                        await db.collection('users').doc(result.user.uid).set(userData);
                        
                        // Log event
                        logEvent('sign_up', { method: 'google' });
                    } else {
                        // Log event
                        logEvent('login', { method: 'google' });
                    }
                    
                    // Close auth modal
                    authModal.classList.remove('modal-open');
                } catch (error) {
                    console.error('Google sign in error:', error);
                    loadingScreen.classList.add('hidden');
                    
                    let errorMessage = 'Google sign in failed. Please try again.';
                    if (error.code === 'auth/popup-closed-by-user') {
                        errorMessage = 'Sign in popup was closed. Please try again.';
                    }
                    
                    showToast(errorMessage, 'error');
                }
            }
            
            // Send password reset email
            async function sendPasswordResetEmail() {
                const email = resetEmail.value;
                
                if (!email) {
                    showToast('Please enter your email address', 'error');
                    return;
                }
                
                // Show loading
                resetBtnText.textContent = 'Sending...';
                resetSpinner.classList.remove('hidden');
                
                try {
                    await auth.sendPasswordResetEmail(email);
                    
                    // Show success message
                    showToast('Password reset link sent to your email', 'success');
                    
                    // Close modal and show login
                    forgotPasswordModal.classList.remove('modal-open');
                    showAuthModal();
                    
                    // Log event
                    logEvent('password_reset_request');
                } catch (error) {
                    console.error('Password reset error:', error);
                    
                    let errorMessage = 'Failed to send reset link. Please try again.';
                    if (error.code === 'auth/user-not-found') {
                        errorMessage = 'No user found with this email.';
                    }
                    
                    showToast(errorMessage, 'error');
                } finally {
                    // Reset button
                    resetBtnText.textContent = 'Send Reset Link';
                    resetSpinner.classList.add('hidden');
                }
            }
            
            // Handle user logout
            async function handleLogout() {
                try {
                    await auth.signOut();
                    appContainer.classList.add('hidden');
                    showAuthModal();
                    
                    // Log event
                    logEvent('logout');
                } catch (error) {
                    console.error('Logout error:', error);
                    showToast('Logout failed. Please try again.', 'error');
                }
            }
            
            // Delete user account
            async function deleteUserAccount() {
                try {
                    // Show loading
                    deleteConfirmationModal.classList.remove('modal-open');
                    loadingScreen.classList.remove('hidden');
                    
                    // Delete user data from Firestore
                    await db.collection('users').doc(currentUser.uid).delete();
                    
                    // Delete user account
                    await currentUser.delete();
                    
                    // Log event
                    logEvent('account_deleted');
                    
                    // Show auth modal
                    appContainer.classList.add('hidden');
                    showAuthModal();
                    showToast('Your account has been deleted', 'success');
                } catch (error) {
                    console.error('Account deletion error:', error);
                    loadingScreen.classList.add('hidden');
                    
                    let errorMessage = 'Account deletion failed. Please try again.';
                    if (error.code === 'auth/requires-recent-login') {
                        errorMessage = 'Please reauthenticate to delete your account.';
                    }
                    
                    showToast(errorMessage, 'error');
                }
            }
            
            // Setup user profile
            function setupUserProfile(user) {
                const userAvatar = document.getElementById('userAvatar');
                const userAvatarSmall = document.getElementById('userAvatarSmall');
                const userName = document.getElementById('userName');
                const userRole = document.getElementById('userRole');
                const settingsAvatar = document.getElementById('settingsAvatar');
                
                // Use user data or demo data
                const displayName = user.displayName || userData.name || demoUser.name;
                const email = user.email || userData.email || demoUser.email;
                const role = userData.role || demoUser.role;
                
                // Set user info
                userName.textContent = displayName;
                userRole.textContent = role.charAt(0).toUpperCase() + role.slice(1);
                
                // Set form fields
                if (displayName) {
                    const nameParts = displayName.split(' ');
                    firstName.value = nameParts[0] || '';
                    lastName.value = nameParts.slice(1).join(' ') || '';
                }
                userEmail.value = email;
                
                // Create avatar from initials
                const initials = displayName.split(' ').map(n => n[0]).join('').toUpperCase();
                userAvatar.textContent = initials.substring(0, 2);
                userAvatarSmall.textContent = initials.substring(0, 2);
                settingsAvatar.textContent = initials.substring(0, 2);
                
                // Set avatar color based on user email hash
                const colors = [
                    'from-blue-500 to-purple-500', 
                    'from-pink-500 to-red-500', 
                    'from-green-500 to-teal-500', 
                    'from-orange-500 to-amber-500',
                    'from-indigo-500 to-blue-500', 
                    'from-purple-500 to-pink-500'
                ];
                const hash = email.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
                const colorIndex = hash % colors.length;
                
                userAvatar.className = `avatar w-10 h-10 rounded-full mr-3 bg-gradient-to-r ${colors[colorIndex]} flex items-center justify-center text-white font-bold`;
                userAvatarSmall.className = `avatar w-8 h-8 rounded-full cursor-pointer bg-gradient-to-r ${colors[colorIndex]} flex items-center justify-center text-white font-bold smooth-transition btn-press`;
                settingsAvatar.className = `avatar w-16 h-16 rounded-full mr-4 bg-gradient-to-r ${colors[colorIndex]} flex items-center justify-center text-white font-bold text-2xl`;
            }
            
            // Show auth modal
            function showAuthModal() {
                authModal.classList.add('modal-open');
                
                // Reset forms
                document.getElementById('loginEmail').value = '';
                document.getElementById('loginPassword').value = '';
                document.getElementById('rememberMe').checked = false;
                
                document.getElementById('registerName').value = '';
                document.getElementById('registerEmail').value = '';
                document.getElementById('registerPassword').value = '';
                document.getElementById('registerConfirmPassword').value = '';
                document.getElementById('registerRole').value = 'teacher';
                document.getElementById('registerBirthdate').value = '';
                document.getElementById('registerInviteCode').value = '';
                document.getElementById('acceptTerms').checked = false;
                
                // Show login tab by default
                loginTab.click();
            }
            
            // Show forgot password modal
            function showForgotPasswordModal() {
                resetEmail.value = '';
                forgotPasswordModal.classList.add('modal-open');
                
                // Animate modal appearance
                const modal = forgotPasswordModal.querySelector('.apple-modal');
                modal.classList.add('apple-modal-open');
            }
            
            // Show permission modal
            function showPermissionModal() {
                permissionModal.classList.add('modal-open');
                
                // Animate modal appearance
                const modal = permissionModal.querySelector('.apple-modal');
                modal.classList.add('apple-modal-open');
            }
            
            // Show custom permission modal
            function showCustomPermissionModal() {
                customPermissionModal.classList.add('modal-open');
                
                // Set toggle states based on previous choices
                const locationAllowed = localStorage.getItem('locationAllowed') === 'true';
                const notificationsAllowed = localStorage.getItem('notificationsAllowed') === 'true';
                const cameraAllowed = localStorage.getItem('cameraAllowed') === 'true';
                
                locationPermissionToggle.checked = locationAllowed;
                notificationPermissionToggle.checked = notificationsAllowed;
                cameraPermissionToggle.checked = cameraAllowed;
            }
            
            // Show check-in modal
            function showCheckInModal(sectionName, time, location, distance, status) {
                checkInSectionName.textContent = sectionName;
                checkInTime.textContent = time;
                checkInLocation.textContent = location;
                checkInDistance.textContent = distance;
                checkInStatus.textContent = status;
                
                // Set status color
                checkInStatus.className = 'text-sm font-medium ';
                if (status === 'On Time') {
                    checkInStatus.classList.add('text-green-500');
                } else if (status === 'Late') {
                    checkInStatus.classList.add('text-yellow-500');
                } else {
                    checkInStatus.classList.add('text-red-500');
                }
                
                checkInModal.classList.add('modal-open');
                
                // Show confetti for on-time check-ins
                if (status === 'On Time') {
                    createConfetti();
                }
            }
            
            // Show create section modal
            function showCreateSectionModal() {
                // Reset form
                sectionName.value = '';
                sectionSubject.value = '';
                sectionStartTime.value = '08:00';
                sectionEndTime.value = '09:00';
                sectionLocation.value = '';
                sectionInviteCode.value = '';
                
                // Reset day selectors
                document.querySelectorAll('.day-selector').forEach(button => {
                    button.classList.remove('bg-primary', 'text-white', 'border-primary');
                });
                
                createSectionModal.classList.add('modal-open');
            }
            
            // Show start session modal
            function showStartSessionModal() {
                // Set default values
                const now = new Date();
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                
                sessionDate.valueAsDate = now;
                sessionTime.value = `${hours}:${minutes}`;
                
                startSessionModal.classList.add('modal-open');
            }
            
            // Show active session modal
            function showActiveSessionModal(session) {
                activeSessionSection.textContent = session.sectionName;
                activeSessionTime.textContent = `${session.date}  ${session.startTime} - ${session.endTime}`;
                activeSessionPresent.textContent = session.presentCount || '0';
                activeSessionLate.textContent = session.lateCount || '0';
                activeSessionAbsent.textContent = session.absentCount || '0';
                
                // Generate QR code
                if (session.qrCode) {
                    QRCode.toCanvas(sessionQrCode, session.qrCode, { width: 200 }, (error) => {
                        if (error) console.error('QR code error:', error);
                    });
                }
                
                // Start timer for session end
                if (session.endTime) {
                    updateSessionTimer(session.endTime);
                    const timerInterval = setInterval(() => {
                        updateSessionTimer(session.endTime);
                    }, 60000); // Update every minute
                    
                    // Store interval ID to clear later
                    session.timerInterval = timerInterval;
                }
                
                activeSessionModal.classList.add('modal-open');
            }
            
            // Update session timer
            function updateSessionTimer(endTime) {
                const now = new Date();
                const [hours, minutes] = endTime.split(':').map(Number);
                const endDate = new Date(now);
                endDate.setHours(hours, minutes, 0, 0);
                
                if (now >= endDate) {
                    sessionTimeRemaining.textContent = 'Session ended';
                    return;
                }
                
                const diffMs = endDate - now;
                const diffMins = Math.round(diffMs / 60000);
                
                if (diffMins <= 0) {
                    sessionTimeRemaining.textContent = 'Session ended';
                } else {
                    sessionTimeRemaining.textContent = `${diffMins} minute${diffMins !== 1 ? 's' : ''} remaining`;
                }
            }
            
            // Show create announcement modal
            function showCreateAnnouncementModal() {
                // Reset form
                announcementTitle.value = '';
                announcementContent.value = '';
                announcementRecipients.value = 'all';
                specificSectionsContainer.classList.add('hidden');
                announcementImportant.checked = false;
                
                // Uncheck all section checkboxes
                document.querySelectorAll('#specificSectionsContainer input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                createAnnouncementModal.classList.add('modal-open');
            }
            
            // Show delete confirmation modal
            function showDeleteConfirmation(message, confirmCallback) {
                deleteConfirmationText.textContent = message;
                deleteConfirmationModal.classList.add('modal-open');
                
                // Set up confirm button
                confirmDeleteBtn.onclick = function() {
                    deleteConfirmationModal.classList.remove('modal-open');
                    confirmCallback();
                };
            }
            
            // Generate random invite code
            function generateInviteCode() {
                const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // Exclude easily confused chars
                let result = '';
                for (let i = 0; i < 6; i++) {
                    result += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                sectionInviteCode.value = result;
            }
            
            // Update selected days for section creation
            function updateSelectedDays() {
                const selectedDays = [];
                document.querySelectorAll('.day-selector.bg-primary').forEach(button => {
                    selectedDays.push(button.getAttribute('data-day'));
                });
                sectionDays.value = selectedDays.join(',');
            }
            
            // Save new section
            async function saveSection() {
                if (!sectionName.value) {
                    showToast('Please enter a section name', 'error');
                    return;
                }
                
                if (!sectionSubject.value) {
                    showToast('Please enter a subject', 'error');
                    return;
                }
                
                if (!sectionDays.value) {
                    showToast('Please select at least one day', 'error');
                    return;
                }
                
                // Show loading
                saveSectionBtnText.textContent = 'Saving...';
                saveSectionSpinner.classList.remove('hidden');
                
                try {
                    // In a real app, we would save to Firestore
                    const sectionData = {
                        name: sectionName.value,
                        subject: sectionSubject.value,
                        startTime: sectionStartTime.value,
                        endTime: sectionEndTime.value,
                        days: sectionDays.value.split(','),
                        location: sectionLocation.value,
                        inviteCode: sectionInviteCode.value || null,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        teacherId: currentUser.uid,
                        students: []
                    };
                    
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Log event
                    logEvent('create_section', { section_name: sectionName.value });
                    
                    // Close modal
                    createSectionModal.classList.remove('modal-open');
                    showToast('Section created successfully', 'success');
                    
                    // Refresh sections list
                    if (currentPage === 'sections') {
                        loadSectionsData();
                    }
                } catch (error) {
                    console.error('Error saving section:', error);
                    showToast('Failed to create section. Please try again.', 'error');
                } finally {
                    // Reset button
                    saveSectionBtnText.textContent = 'Create Section';
                    saveSectionSpinner.classList.add('hidden');
                }
            }
            
            // Start attendance session
            async function startAttendanceSession() {
                if (!sessionSection.value) {
                    showToast('Please select a section', 'error');
                    return;
                }
                
                // Show loading
                startSessionBtnText.textContent = 'Starting...';
                startSessionSpinner.classList.remove('hidden');
                
                try {
                    // In a real app, we would save to Firestore
                    const sessionData = {
                        sectionId: sessionSection.value,
                        sectionName: sessionSection.options[sessionSection.selectedIndex].text,
                        date: formatDate(sessionDate.valueAsDate),
                        startTime: sessionTime.value,
                        endTime: calculateEndTime(sessionTime.value, sessionDuration.value),
                        duration: parseInt(sessionDuration.value),
                        location: sessionLocation.value,
                        requireLocation: enableGeofence.checked,
                        qrCode: enableQrCode.checked ? generateSessionCode() : null,
                        status: 'active',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        teacherId: currentUser.uid,
                        presentStudents: [],
                        lateStudents: [],
                        absentStudents: []
                    };
                    
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Add to active sessions
                    activeSessions.push(sessionData);
                    
                    // Log event
                    logEvent('start_session', { 
                        section: sessionData.sectionName,
                        duration: sessionData.duration 
                    });
                    
                    // Close modal
                    startSessionModal.classList.remove('modal-open');
                    showToast('Attendance session started', 'success');
                    
                    // Show active session modal
                    showActiveSessionModal(sessionData);
                    
                    // Update dashboard
                    updateActiveSessionsCount();
                } catch (error) {
                    console.error('Error starting session:', error);
                    showToast('Failed to start session. Please try again.', 'error');
                } finally {
                    // Reset button
                    startSessionBtnText.textContent = 'Start Session';
                    startSessionSpinner.classList.add('hidden');
                }
            }
            
            // Calculate end time based on start time and duration
            function calculateEndTime(startTime, durationMinutes) {
                const [hours, minutes] = startTime.split(':').map(Number);
                const startDate = new Date();
                startDate.setHours(hours, minutes, 0, 0);
                
                const endDate = new Date(startDate.getTime() + durationMinutes * 60000);
                return `${endDate.getHours().toString().padStart(2, '0')}:${endDate.getMinutes().toString().padStart(2, '0')}`;
            }
            
            // Generate unique session code for QR code
            function generateSessionCode() {
                return `nearcheck-${currentUser.uid}-${Date.now()}`;
            }
            
            // End attendance session
            async function endAttendanceSession() {
                // Show confirmation
                showDeleteConfirmation('Are you sure you want to end this session?', async () => {
                    try {
                        // In a real app, we would update in Firestore
                        const session = activeSessions[0]; // For demo, just use the first active session
                        
                        if (session && session.timerInterval) {
                            clearInterval(session.timerInterval);
                        }
                        
                        // Simulate API call
                        await new Promise(resolve => setTimeout(resolve, 800));
                        
                        // Remove from active sessions
                        activeSessions = activeSessions.filter(s => s.sectionId !== session.sectionId);
                        
                        // Log event
                        logEvent('end_session', { 
                            section: session.sectionName,
                            duration: session.duration 
                        });
                        
                        // Close modal
                        activeSessionModal.classList.remove('modal-open');
                        showToast('Attendance session ended', 'success');
                        
                        // Update dashboard
                        updateActiveSessionsCount();
                        
                        // Refresh attendance page if open
                        if (currentPage === 'attendance') {
                            loadAttendanceData();
                        }
                    } catch (error) {
                        console.error('Error ending session:', error);
                        showToast('Failed to end session. Please try again.', 'error');
                    }
                });
            }
            
            // Post announcement
            async function postAnnouncement() {
                if (!announcementTitle.value) {
                    showToast('Please enter a title', 'error');
                    return;
                }
                
                if (!announcementContent.value) {
                    showToast('Please enter announcement content', 'error');
                    return;
                }
                
                // Show loading
                postAnnouncementBtnText.textContent = 'Posting...';
                postAnnouncementSpinner.classList.remove('hidden');
                
                try {
                    // In a real app, we would save to Firestore
                    const announcementData = {
                        title: announcementTitle.value,
                        content: announcementContent.value,
                        recipients: announcementRecipients.value === 'all' ? 'all' : 
                            Array.from(document.querySelectorAll('#specificSectionsContainer input[type="checkbox"]:checked'))
                                .map(checkbox => checkbox.id.replace('section-', '')),
                        important: announcementImportant.checked,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        authorId: currentUser.uid,
                        authorName: currentUser.displayName || userData.name
                    };
                    
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Log event
                    logEvent('post_announcement', { 
                        important: announcementData.important,
                        recipients: announcementData.recipients === 'all' ? 'all' : 'specific'
                    });
                    
                    // Close modal
                    createAnnouncementModal.classList.remove('modal-open');
                    showToast('Announcement posted successfully', 'success');
                    
                    // Refresh announcements page if open
                    if (currentPage === 'announcements') {
                        loadAnnouncementsData();
                    }
                    
                    // Add to notifications
                    addNotification({
                        type: 'announcement',
                        title: 'New Announcement',
                        message: `You have a new announcement: ${announcementTitle.value}`,
                        timestamp: new Date().toISOString(),
                        read: false
                    });
                } catch (error) {
                    console.error('Error posting announcement:', error);
                    showToast('Failed to post announcement. Please try again.', 'error');
                } finally {
                    // Reset button
                    postAnnouncementBtnText.textContent = 'Post Announcement';
                    postAnnouncementSpinner.classList.add('hidden');
                }
            }
            
            // Apply report filters
            async function applyReportFilters() {
                try {
                    // Show loading
                    applyReportFiltersBtn.disabled = true;
                    applyReportFiltersBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Applying...';
                    
                    // Get filter values
                    const section = reportSectionFilter.value;
                    const dateRange = reportDateRange.value;
                    const startDate = dateRange === 'custom' ? reportStartDate.value : null;
                    const endDate = dateRange === 'custom' ? reportEndDate.value : null;
                    const reportTypeValue = reportType.value;
                    
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    // Log event
                    logEvent('generate_report', { 
                        section: section,
                        date_range: dateRange,
                        type: reportTypeValue 
                    });
                    
                    // Update charts (in a real app, we would use actual data)
                    updateAttendanceOverviewChart();
                    updateAttendanceRecordsChart();
                    
                    showToast('Report filters applied', 'success');
                } catch (error) {
                    console.error('Error applying filters:', error);
                    showToast('Failed to apply filters. Please try again.', 'error');
                } finally {
                    // Reset button
                    applyReportFiltersBtn.disabled = false;
                    applyReportFiltersBtn.textContent = 'Apply Filters';
                }
            }
            
            // Navigate to different pages
            function navigateTo(page) {
                // Hide all pages
                dashboardPage.classList.add('hidden');
                sectionsPage.classList.add('hidden');
                attendancePage.classList.add('hidden');
                reportsPage.classList.add('hidden');
                announcementsPage.classList.add('hidden');
                settingsPage.classList.add('hidden');
                
                // Show selected page
                switch (page) {
                    case 'dashboard':
                        dashboardPage.classList.remove('hidden');
                        pageTitle.textContent = 'Dashboard';
                        loadDashboardData();
                        break;
                    case 'sections':
                        sectionsPage.classList.remove('hidden');
                        pageTitle.textContent = 'My Sections';
                        loadSectionsData();
                        break;
                    case 'attendance':
                        attendancePage.classList.remove('hidden');
                        pageTitle.textContent = 'Attendance';
                        loadAttendanceData();
                        break;
                    case 'reports':
                        reportsPage.classList.remove('hidden');
                        pageTitle.textContent = 'Reports';
                        loadReportsData();
                        break;
                    case 'announcements':
                        announcementsPage.classList.remove('hidden');
                        pageTitle.textContent = 'Announcements';
                        loadAnnouncementsData();
                        break;
                    case 'settings':
                        settingsPage.classList.remove('hidden');
                        pageTitle.textContent = 'Settings';
                        break;
                }
                
                currentPage = page;
                
                // Close drawer if open
                drawer.classList.remove('drawer-open');
                document.body.style.overflow = '';
                
                // Log page view
                logEvent('page_view', { page: page });
            }
            
            // Load dashboard data
            async function loadDashboardData() {
                try {
                    // Simulate API calls
                    await new Promise(resolve => setTimeout(resolve, 800));
                    
                    // Update stats
                    activeSessionsCount.textContent = activeSessions.length;
                    activeSessionsText.textContent = `${activeSections.length} section${activeSections.length !== 1 ? 's' : ''} currently accepting check-ins`;
                    
                    // Random attendance data for demo
                    const attendance = Math.floor(Math.random() * 20) + 80; // 80-100%
                    attendanceRate.textContent = `${attendance}%`;
                    
                    const trend = Math.random() > 0.5 ? 'increase' : 'decrease';
                    const trendAmount = Math.floor(Math.random() * 5) + 1;
                    
                    if (trend === 'increase') {
                        attendanceTrend.textContent = `+${trendAmount}% from yesterday`;
                    } else {
                        attendanceTrend.textContent = `-${trendAmount}% from yesterday`;
                    }
                    
                    pendingAlertsCount.textContent = Math.floor(Math.random() * 5);
                    alertsText.textContent = pendingAlertsCount.textContent === '1' ? 
                        'Requires your attention' : 'Require your attention';
                    
                    totalStudentsCount.textContent = Math.floor(Math.random() * 50) + 100; // 100-150
                    studentsText.textContent = 'Across all your sections';
                    
                    // Load recent check-ins
                    loadRecentCheckins();
                    
                    // Load AI warnings
                    loadAiWarnings();
                    
                    // Load section activity
                    loadSectionActivity();
                } catch (error) {
                    console.error('Error loading dashboard data:', error);
                    showToast('Error loading dashboard data', 'error');
                }
            }
            
            // Load recent check-ins
            function loadRecentCheckins() {
                // Demo data
                const checkins = [
                    {
                        name: 'John Doe',
                        section: 'Grade 10 - Section A',
                        status: 'present',
                        time: '8:15 AM'
                    },
                    {
                        name: 'Mark Santos',
                        section: 'Grade 11 - STEM',
                        status: 'late',
                        time: '8:45 AM'
                    },
                    {
                        name: 'Anna Johnson',
                        section: 'Grade 9 - Section B',
                        status: 'present',
                        time: '8:10 AM'
                    },
                    {
                        name: 'Carlos Reyes',
                        section: 'Grade 12 - ABM',
                        status: 'absent',
                        time: null
                    }
                ];
                
                recentCheckinsList.innerHTML = '';
                
                checkins.forEach(checkin => {
                    const initials = checkin.name.split(' ').map(n => n[0]).join('').toUpperCase();
                    const colors = ['from-blue-500 to-purple-500', 'from-pink-500 to-red-500', 
                                   'from-green-500 to-teal-500', 'from-orange-500 to-amber-500'];
                    const colorIndex = checkin.name.length % colors.length;
                    
                    const statusClasses = {
                        present: 'text-green-500',
                        late: 'text-yellow-500',
                        absent: 'text-red-500'
                    };
                    
                    const statusText = {
                        present: 'Checked In',
                        late: 'Late',
                        absent: 'Absent'
                    };
                    
                    const item = document.createElement('div');
                    item.className = 'flex items-center p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 smooth-transition';
                    item.innerHTML = `
                        <div class="avatar w-10 h-10 rounded-full mr-3 bg-gradient-to-r ${colors[colorIndex]} flex items-center justify-center text-white font-bold">${initials.substring(0, 2)}</div>
                        <div class="flex-1">
                            <h3 class="font-medium text-gray-800 dark:text-white">${checkin.name}</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400">${checkin.section}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-medium ${statusClasses[checkin.status]}">${statusText[checkin.status]}</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">${checkin.time || '-'}</p>
                        </div>
                    `;
                    
                    recentCheckinsList.appendChild(item);
                });
            }
            
            // Load AI warnings
            function loadAiWarnings() {
                // Demo data
                const warnings = [
                    {
                        type: 'duplicate',
                        title: 'Possible Duplicate',
                        message: '"Mark Santos" exists in both Grade 11 STEM and Grade 10 Section A',
                        severity: 'medium'
                    },
                    {
                        type: 'suspicious',
                        title: 'Suspicious Activity',
                        message: 'Multiple check-in attempts from different locations for "John Doe"',
                        severity: 'high'
                    }
                ];
                
                aiWarningsList.innerHTML = '';
                
                warnings.forEach(warning => {
                    const iconClasses = {
                        duplicate: 'bg-yellow-100 dark:bg-yellow-900 text-yellow-500 dark:text-yellow-300',
                        suspicious: 'bg-red-100 dark:bg-red-900 text-red-500 dark:text-red-300'
                    };
                    
                    const icon = {
                        duplicate: 'fa-exclamation-triangle',
                        suspicious: 'fa-user-slash'
                    };
                    
                    const item = document.createElement('div');
                    item.className = `p-3 rounded-lg ${warning.severity === 'high' ? 'bg-red-50 dark:bg-red-900 bg-opacity-30' : 'bg-yellow-50 dark:bg-yellow-900 bg-opacity-30'}`;
                    item.innerHTML = `
                        <div class="flex items-start">
                            <div class="${iconClasses[warning.type]} p-2 rounded-lg mr-3">
                                <i class="fas ${icon[warning.type]}"></i>
                            </div>
                            <div>
                                <h3 class="font-medium text-gray-800 dark:text-white">${warning.title}</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-300">${warning.message}</p>
                                <div class="flex space-x-2 mt-2">
                                    <button class="text-xs bg-white dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white py-1 px-2 rounded border border-gray-300 dark:border-gray-600 smooth-transition btn-press">Allow</button>
                                    <button class="text-xs bg-white dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white py-1 px-2 rounded border border-gray-300 dark:border-gray-600 smooth-transition btn-press">Merge</button>
                                    <button class="text-xs bg-white dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white py-1 px-2 rounded border border-gray-300 dark:border-gray-600 smooth-transition btn-press">Block</button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    aiWarningsList.appendChild(item);
                });
            }
            
            // Load section activity
            function loadSectionActivity() {
                // Demo data
                const sections = [
                    {
                        name: 'Grade 11 - STEM',
                        time: '8:00 AM - 9:30 AM',
                        status: 'active',
                        present: 24,
                        total: 30
                    },
                    {
                        name: 'Grade 10 - Section A',
                        time: '1:00 PM - 2:30 PM',
                        status: 'upcoming',
                        present: 0,
                        total: 28
                    },
                    {
                        name: 'Grade 9 - Section B',
                        time: '10:00 AM - 11:30 AM',
                        status: 'completed',
                        present: 22,
                        total: 25
                    }
                ];
                
                sectionActivityList.innerHTML = '';
                
                sections.forEach(section => {
                    const statusClasses = {
                        active: 'bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200',
                        upcoming: 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300',
                        completed: 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200'
                    };
                    
                    const statusText = {
                        active: 'In Session',
                        upcoming: 'Upcoming',
                        completed: 'Completed'
                    };
                    
                    const percentage = Math.round((section.present / section.total) * 100);
                    const progressColor = section.status === 'completed' ? 
                        (percentage > 90 ? 'bg-green-500' : percentage > 70 ? 'bg-yellow-500' : 'bg-red-500') :
                        'bg-blue-500';
                    
                    const item = document.createElement('div');
                    item.className = 'animate__animated animate__fadeIn';
                    item.innerHTML = `
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="font-medium text-gray-800 dark:text-white">${section.name}</h3>
                                <span class="text-xs px-2 py-1 ${statusClasses[section.status]} rounded-full">${statusText[section.status]}</span>
                            </div>
                            <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
                                <span>${section.time}</span>
                                <span>${section.present}/${section.total} present</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-2">
                                <div class="${progressColor} h-2 rounded-full" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    `;
                    
                    sectionActivityList.appendChild(item);
                });
            }
            
            // Load sections data
            async function loadSectionsData() {
                try {
                    // Show loading state
                    sectionsGrid.innerHTML = '';
                    for (let i = 0; i < 3; i++) {
                        const skeleton = document.createElement('div');
                        skeleton.className = 'skeleton h-40 rounded-xl';
                        sectionsGrid.appendChild(skeleton);
                    }
                    
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Demo data
                    const sections = [
                        {
                            id: 'grade11-stem',
                            name: 'Grade 11 - STEM',
                            subject: 'Mathematics',
                            time: 'Mon, Wed, Fri  8:00-9:30 AM',
                            students: 30,
                            location: 'Building A, Room 203'
                        },
                        {
                            id: 'grade10-a',
                            name: 'Grade 10 - Section A',
                            subject: 'Science',
                            time: 'Tue, Thu  1:00-2:30 PM',
                            students: 28,
                            location: 'Building B, Room 105'
                        },
                        {
                            id: 'grade9-b',
                            name: 'Grade 9 - Section B',
                            subject: 'English',
                            time: 'Mon-Fri  10:00-11:00 AM',
                            students: 25,
                            location: 'Building A, Room 101'
                        }
                    ];
                    
                    sectionsGrid.innerHTML = '';
                    
                    sections.forEach(section => {
                        const colors = ['from-blue-500 to-purple-500', 'from-green-500 to-teal-500', 'from-orange-500 to-amber-500'];
                        const colorIndex = section.name.length % colors.length;
                        
                        const item = document.createElement('div');
                        item.className = 'bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 smooth-transition card-hover animate__animated animate__fadeIn';
                        item.innerHTML = `
                            <div class="flex items-start justify-between mb-3">
                                <div>
                                    <h3 class="font-bold text-gray-800 dark:text-white">${section.name}</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">${section.subject}</p>
                                </div>
                                <div class="bg-gradient-to-r ${colors[colorIndex]} p-2 rounded-lg text-white">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                            <div class="space-y-2 text-sm text-gray-600 dark:text-gray-300">
                                <div class="flex items-center">
                                    <i class="fas fa-clock mr-2 w-4 text-center"></i>
                                    <span>${section.time}</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-user-graduate mr-2 w-4 text-center"></i>
                                    <span>${section.students} students</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-map-marker-alt mr-2 w-4 text-center"></i>
                                    <span>${section.location}</span>
                                </div>
                            </div>
                            <div class="mt-4 flex justify-between items-center">
                                <button class="text-sm text-primary hover:underline smooth-transition">View Students</button>
                                <button class="text-sm bg-primary hover:bg-primary-dark text-white py-1 px-3 rounded-lg smooth-transition btn-press">Start Session</button>
                            </div>
                        `;
                        
                        sectionsGrid.appendChild(item);
                    });
                } catch (error) {
                    console.error('Error loading sections:', error);
                    showToast('Error loading sections', 'error');
                }
            }
            
            // Load attendance data
            async function loadAttendanceData() {
                try {
                    // Show loading state
                    attendanceSessionsTable.innerHTML = `
                        <tr>
                            <td colspan="5" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">Loading sessions...</td>
                        </tr>
                    `;
                    
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 800));
                    
                    // Demo data
                    const sessions = [
                        {
                            id: 'session1',
                            section: 'Grade 11 - STEM',
                            time: 'Today, 8:00-9:30 AM',
                            status: 'active',
                            present: 24,
                            late: 3,
                            absent: 3,
                            total: 30
                        },
                        {
                            id: 'session2',
                            section: 'Grade 10 - Section A',
                            time: 'Today, 1:00-2:30 PM',
                            status: 'upcoming',
                            present: 0,
                            late: 0,
                            absent: 0,
                            total: 28
                        },
                        {
                            id: 'session3',
                            section: 'Grade 9 - Section B',
                            time: 'Yesterday, 10:00-11:00 AM',
                            status: 'completed',
                            present: 22,
                            late: 2,
                            absent: 1,
                            total: 25
                        },
                        {
                            id: 'session4',
                            section: 'Grade 12 - ABM',
                            time: 'Yesterday, 2:00-3:30 PM',
                            status: 'completed',
                            present: 18,
                            late: 5,
                            absent: 2,
                            total: 25
                        }
                    ];
                    
                    attendanceSessionsTable.innerHTML = '';
                    
                    sessions.forEach(session => {
                        const statusClasses = {
                            active: 'text-green-500',
                            upcoming: 'text-blue-500',
                            completed: 'text-gray-500 dark:text-gray-400'
                        };
                        
                        const statusText = {
                            active: 'Active',
                            upcoming: 'Upcoming',
                            completed: 'Completed'
                        };
                        
                        const percentage = session.status === 'completed' ? 
                            Math.round(((session.present + session.late) / session.total) * 100) : 0;
                        
                        const row = document.createElement('tr');
                        row.className = 'animate__animated animate__fadeIn';
                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="font-medium text-gray-800 dark:text-white">${session.section}</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">${session.time}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                                ${session.time.split('  ')[1]}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 py-1 text-xs font-medium ${statusClasses[session.status]}">${statusText[session.status]}</span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <div class="w-16 bg-gray-200 dark:bg-gray-700 rounded-full h-2 mr-2">
                                        <div class="bg-${session.status === 'completed' ? (percentage > 90 ? 'green' : percentage > 70 ? 'yellow' : 'red') : 'blue'}-500 h-2 rounded-full" style="width: ${percentage}%"></div>
                                    </div>
                                    <span class="text-sm text-gray-500 dark:text-gray-400">${percentage}%</span>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <button class="text-primary hover:text-primary-dark smooth-transition btn-press">View</button>
                            </td>
                        `;
                        
                        attendanceSessionsTable.appendChild(row);
                    });
                    
                    // Update chart
                    updateAttendanceRecordsChart();
                } catch (error) {
                    console.error('Error loading attendance data:', error);
                    showToast('Error loading attendance data', 'error');
                }
            }
            
            // Update attendance records chart
            function updateAttendanceRecordsChart() {
                // Demo data
                const ctx = attendanceRecordsChart.getContext('2d');
                
                // Destroy previous chart if it exists
                if (attendanceRecordsChart.chart) {
                    attendanceRecordsChart.chart.destroy();
                }
                
                attendanceRecordsChart.chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [
                            {
                                label: 'Present',
                                data: [24, 22, 25, 23, 26, 10, 0],
                                borderColor: '#10B981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                tension: 0.3,
                                fill: true
                            },
                            {
                                label: 'Late',
                                data: [3, 5, 2, 4, 1, 0, 0],
                                borderColor: '#F59E0B',
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                tension: 0.3,
                                fill: true
                            },
                            {
                                label: 'Absent',
                                data: [3, 3, 3, 3, 3, 0, 0],
                                borderColor: '#EF4444',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                tension: 0.3,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--dark') === '#1F2937' ? 
                                        '#F3F4F6' : '#1F2937'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 30,
                                ticks: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--dark') === '#1F2937' ? 
                                        '#9CA3AF' : '#6B7280'
                                },
                                grid: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--dark') === '#1F2937' ? 
                                        'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                                }
                            },
                            x: {
                                ticks: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--dark') === '#1F2937' ? 
                                        '#9CA3AF' : '#6B7280'
                                },
                                grid: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--dark') === '#1F2937' ? 
                                        'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                                }
                            }
                        }
                    }
                });
            }
            
            // Load reports data
            async function loadReportsData() {
                try {
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 800));
                    
                    // Update chart
                    updateAttendanceOverviewChart();
                    
                    // Update table with demo data
                    attendanceOverviewTable.innerHTML = '';
                    
                    const sections = [
                        { name: 'Grade 11 - STEM', present: 120, late: 15, absent: 15, total: 150 },
                        { name: 'Grade 10 - Section A', present: 110, late: 20, absent: 20, total: 150 },
                        { name: 'Grade 9 - Section B', present: 130, late: 10, absent: 10, total: 150 },
                        { name: 'Grade 12 - ABM', present: 125, late: 15, absent: 10, total: 150 }
                    ];
                    
                    sections.forEach(section => {
                        const presentPercentage = Math.round((section.present / section.total) * 100);
                        const latePercentage = Math.round((section.late / section.total) * 100);
                        const absentPercentage = Math.round((section.absent / section.total) * 100);
                        const overallPercentage = Math.round(((section.present + section.late) / section.total) * 100);
                        
                        const row = document.createElement('tr');
                        row.className = 'animate__animated animate__fadeIn';
                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800 dark:text-white">
                                ${section.name}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                                ${section.present} (${presentPercentage}%)
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                                ${section.late} (${latePercentage}%)
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                                ${section.absent} (${absentPercentage}%)
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 py-1 text-xs font-medium ${overallPercentage > 90 ? 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200' : overallPercentage > 80 ? 'bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200' : 'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200'} rounded-full">
                                    ${overallPercentage}%
                                </span>
                            </td>
                        `;
                        
                        attendanceOverviewTable.appendChild(row);
                    });
                } catch (error) {
                    console.error('Error loading reports:', error);
                    showToast('Error loading reports', 'error');
                }
            }
            
            // Update attendance overview chart
            function updateAttendanceOverviewChart() {
                const ctx = attendanceOverviewChart.getContext('2d');
                
                // Destroy previous chart if it exists
                if (attendanceOverviewChart.chart) {
                    attendanceOverviewChart.chart.destroy();
                }
                
                attendanceOverviewChart.chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Grade 11', 'Grade 10', 'Grade 9', 'Grade 12'],
                        datasets: [
                            {
                                label: 'Present',
                                data: [80, 73, 87, 83],
                                backgroundColor: '#10B981',
                                borderRadius: 4
                            },
                            {
                                label: 'Late',
                                data: [10, 13, 7, 10],
                                backgroundColor: '#F59E0B',
                                borderRadius: 4
                            },
                            {
                                label: 'Absent',
                                data: [10, 14, 6, 7],
                                backgroundColor: '#EF4444',
                                borderRadius: 4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--dark') === '#1F2937' ? 
                                        '#F3F4F6' : '#1F2937'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                stacked: true,
                                max: 100,
                                ticks: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--dark') === '#1F2937' ? 
                                        '#9CA3AF' : '#6B7280',
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                },
                                grid: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--dark') === '#1F2937' ? 
                                        'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                                }
                            },
                            x: {
                                stacked: true,
                                ticks: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--dark') === '#1F2937' ? 
                                        '#9CA3AF' : '#6B7280'
                                },
                                grid: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--dark') === '#1F2937' ? 
                                        'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                                }
                            }
                        }
                    }
                });
            }
            
            // Load announcements data
            async function loadAnnouncementsData() {
                try {
                    // Show loading state
                    announcementsList.innerHTML = '';
                    for (let i = 0; i < 3; i++) {
                        const skeleton = document.createElement('div');
                        skeleton.className = 'skeleton h-32 rounded-xl';
                        announcementsList.appendChild(skeleton);
                    }
                    
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Demo data
                    const announcements = [
                        {
                            id: 'ann1',
                            title: 'School Holiday',
                            content: 'There will be no classes on Monday, November 15 due to a national holiday. Classes will resume on Tuesday.',
                            date: 'November 10, 2023',
                            important: true,
                            author: 'Principal Smith'
                        },
                        {
                            id: 'ann2',
                            title: 'Science Fair',
                            content: 'The annual science fair will be held on December 5. All students are encouraged to participate. Registration deadline is November 30.',
                            date: 'November 8, 2023',
                            important: false,
                            author: 'Science Department'
                        },
                        {
                            id: 'ann3',
                            title: 'Parent-Teacher Meetings',
                            content: 'Parent-teacher meetings are scheduled for November 20-22. Please book your slot through the school portal.',
                            date: 'November 5, 2023',
                            important: true,
                            author: 'Administration'
                        }
                    ];
                    
                    announcementsList.innerHTML = '';
                    
                    announcements.forEach(announcement => {
                        const item = document.createElement('div');
                        item.className = 'bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 smooth-transition card-hover animate__animated animate__fadeIn';
                        item.innerHTML = `
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-bold text-gray-800 dark:text-white ${announcement.important ? 'text-red-500 dark:text-red-400' : ''}">${announcement.title}</h3>
                                ${announcement.important ? '<span class="bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 text-xs px-2 py-1 rounded-full">Important</span>' : ''}
                            </div>
                            <p class="text-gray-600 dark:text-gray-300 mb-3">${announcement.content}</p>
                            <div class="flex justify-between items-center text-sm text-gray-500 dark:text-gray-400">
                                <span>${announcement.date}</span>
                                <span>By ${announcement.author}</span>
                            </div>
                        `;
                        
                        announcementsList.appendChild(item);
                    });
                } catch (error) {
                    console.error('Error loading announcements:', error);
                    showToast('Error loading announcements', 'error');
                }
            }
            
            // Load notifications
            async function loadNotifications() {
                try {
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 800));
                    
                    // Demo data
                    notifications = [
                        {
                            id: 'notif1',
                            type: 'announcement',
                            title: 'New Announcement',
                            message: 'Principal has posted a new announcement',
                            timestamp: new Date(Date.now() - 7200000).toISOString(), // 2 hours ago
                            read: false
                        },
                        {
                            id: 'notif2',
                            type: 'attendance',
                            title: 'Attendance Recorded',
                            message: 'Your attendance for Math class has been recorded',
                            timestamp: new Date(Date.now() - 1800000).toISOString(), // 30 minutes ago
                            read: false
                        },
                        {
                            id: 'notif3',
                            type: 'reminder',
                            title: 'Upcoming Session',
                            message: 'Science class starts in 15 minutes',
                            timestamp: new Date().toISOString(),
                            read: false
                        }
                    ];
                    
                    updateNotificationsBadge();
                    renderNotificationsList();
                } catch (error) {
                    console.error('Error loading notifications:', error);
                }
            }
            
            // Render notifications list
            function renderNotificationsList() {
                notificationsList.innerHTML = '';
                
                notifications.forEach(notification => {
                    const iconClasses = {
                        announcement: 'bg-blue-100 dark:bg-blue-900 text-blue-500 dark:text-blue-300',
                        attendance: 'bg-green-100 dark:bg-green-900 text-green-500 dark:text-green-300',
                        reminder: 'bg-yellow-100 dark:bg-yellow-900 text-yellow-500 dark:text-yellow-300'
                    };
                    
                    const icons = {
                        announcement: 'fa-bell',
                        attendance: 'fa-check-circle',
                        reminder: 'fa-exclamation-triangle'
                    };
                    
                    const timeAgo = formatTimeAgo(notification.timestamp);
                    
                    const item = document.createElement('div');
                    item.className = `p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 smooth-transition ${notification.read ? '' : 'bg-blue-50 dark:bg-blue-900 bg-opacity-30'}`;
                    item.innerHTML = `
                        <div class="flex items-start">
                            <div class="${iconClasses[notification.type]} p-2 rounded-lg mr-3">
                                <i class="fas ${icons[notification.type]}"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800 dark:text-white">${notification.title}</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-300">${notification.message}</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">${timeAgo}</p>
                            </div>
                        </div>
                    `;
                    
                    // Mark as read when clicked
                    item.addEventListener('click', () => {
                        if (!notification.read) {
                            notification.read = true;
                            updateNotificationsBadge();
                            renderNotificationsList();
                        }
                    });
                    
                    notificationsList.appendChild(item);
                });
            }
            
            // Mark all notifications as read
            function markAllNotificationsAsRead() {
                notifications.forEach(notification => {
                    notification.read = true;
                });
                
                unreadNotifications = 0;
                updateNotificationsBadge();
                renderNotificationsList();
                
                showToast('All notifications marked as read', 'success');
            }
            
            // Add new notification
            function addNotification(notification) {
                notifications.unshift(notification);
                if (!notification.read) {
                    unreadNotifications++;
                }
                
                updateNotificationsBadge();
                renderNotificationsList();
                
                // Show desktop notification if permitted
                if (Notification.permission === 'granted') {
                    new Notification(notification.title, {
                        body: notification.message,
                        icon: '/icons/icon-192x192.png'
                    });
                }
            }
            
            // Update notifications badge
            function updateNotificationsBadge() {
                unreadNotifications = notifications.filter(n => !n.read).length;
                const badge = document.getElementById('notificationBadge');
                
                if (unreadNotifications > 0) {
                    badge.textContent = unreadNotifications > 9 ? '9+' : unreadNotifications;
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }
            }
            
            // Update active sessions count
            function updateActiveSessionsCount() {
                activeSessionsCount.textContent = activeSessions.length;
                activeSessionsText.textContent = `${activeSessions.length} section${activeSessions.length !== 1 ? 's' : ''} currently accepting check-ins`;
            }
            
            // Request all permissions
            function requestAllPermissions() {
                requestLocationPermission();
                requestNotificationPermission();
                requestCameraPermission();
            }
            
            // Request location permission
            function requestLocationPermission() {
                if ('geolocation' in navigator) {
                    navigator.geolocation.getCurrentPosition(
                        position => {
                            console.log('Location access granted');
                            localStorage.setItem('locationAllowed', 'true');
                            showToast('Location access granted', 'success');
                        },
                        error => {
                            console.error('Location access denied:', error);
                            localStorage.setItem('locationAllowed', 'false');
                        },
                        { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
                    );
                } else {
                    showToast('Geolocation is not supported by your browser', 'error');
                }
            }
            
            // Request notification permission
            function requestNotificationPermission() {
                if ('Notification' in window) {
                    Notification.requestPermission().then(permission => {
                        console.log('Notification permission:', permission);
                        localStorage.setItem('notificationsAllowed', permission === 'granted');
                        
                        if (permission === 'granted') {
                            showToast('Notifications enabled', 'success');
                            
                            // Subscribe to push notifications
                            subscribeToPushNotifications();
                        }
                    });
                } else {
                    showToast('Notifications are not supported by your browser', 'error');
                }
            }
            
            // Subscribe to push notifications
            function subscribeToPushNotifications() {
                messaging.getToken({ vapidKey: 'YOUR_VAPID_KEY' }).then((currentToken) => {
                    if (currentToken) {
                        console.log('Push notification token:', currentToken);
                        // Send the token to your server for future notifications
                    } else {
                        console.log('No registration token available. Request permission to generate one.');
                    }
                }).catch((err) => {
                    console.log('An error occurred while retrieving token. ', err);
                });
            }
            
            // Request camera permission
            function requestCameraPermission() {
                if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                    navigator.mediaDevices.getUserMedia({ video: true })
                        .then(stream => {
                            console.log('Camera access granted');
                            localStorage.setItem('cameraAllowed', 'true');
                            showToast('Camera access granted', 'success');
                            
                            // Stop all tracks to release camera
                            stream.getTracks().forEach(track => track.stop());
                        })
                        .catch(error => {
                            console.error('Camera access denied:', error);
                            localStorage.setItem('cameraAllowed', 'false');
                        });
                } else {
                    showToast('Camera access is not supported by your browser', 'error');
                }
            }
            
            // Start QR code scanner
            function startQrScanner() {
                qrScannerModal.classList.add('modal-open');
                qrScannerActive = true;
                
                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
                    .then(stream => {
                        qrScanner.srcObject = stream;
                        qrScanner.play();
                        
                        // Start scanning for QR codes
                        scanQrCode();
                    })
                    .catch(error => {
                        console.error('Error accessing camera:', error);
                        showToast('Could not access camera. Please check permissions.', 'error');
                        stopQrScanner();
                    });
            }
            
            // Scan for QR codes
            function scanQrCode() {
                if (!qrScannerActive) return;
                
                const canvas = document.createElement('canvas');
                canvas.width = qrScanner.videoWidth;
                canvas.height = qrScanner.videoHeight;
                const ctx = canvas.getContext('2d');
                
                ctx.drawImage(qrScanner, 0, 0, canvas.width, canvas.height);
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const code = jsQR(imageData.data, imageData.width, imageData.height);
                
                if (code) {
                    // QR code detected
                    stopQrScanner();
                    qrScannerModal.classList.remove('modal-open');
                    
                    // Process the QR code data
                    handleQrCodeScan(code.data);
                } else {
                    // Continue scanning
                    requestAnimationFrame(scanQrCode);
                }
            }
            
            // Stop QR code scanner
            function stopQrScanner() {
                qrScannerActive = false;
                
                if (qrScanner.srcObject) {
                    qrScanner.srcObject.getTracks().forEach(track => track.stop());
                    qrScanner.srcObject = null;
                }
            }
            
            // Handle scanned QR code
            function handleQrCodeScan(data) {
                // Check if this is a valid NearCheck QR code
                if (data.startsWith('nearcheck-')) {
                    // For demo, just show a check-in success
                    showCheckInModal(
                        'Grade 11 - STEM',
                        new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                        'Science Building, Room 203',
                        '15 meters',
                        'On Time'
                    );
                    
                    // Log event
                    logEvent('qr_check_in', { status: 'success' });
                } else {
                    showToast('Invalid QR code. Please scan a valid NearCheck code.', 'error');
                    logEvent('qr_check_in', { status: 'invalid_code' });
                }
            }
            
            // Create ripple effect on button click
            function createRipple(event) {
                const button = event.currentTarget;
                const circle = document.createElement('span');
                const diameter = Math.max(button.clientWidth, button.clientHeight);
                const radius = diameter / 2;
                
                circle.style.width = circle.style.height = `${diameter}px`;
                circle.style.left = `${event.clientX - button.getBoundingClientRect().left - radius}px`;
                circle.style.top = `${event.clientY - button.getBoundingClientRect().top - radius}px`;
                circle.classList.add('ripple-effect');
                
                const ripple = button.getElementsByClassName('ripple-effect')[0];
                if (ripple) {
                    ripple.remove();
                }
                
                button.appendChild(circle);
            }
            
            // Create confetti effect
            function createConfetti() {
                confettiContainer.innerHTML = '';
                
                const colors = ['#4F46E5', '#10B981', '#F59E0B', '#EF4444', '#3B82F6'];
                
                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    
                    // Random properties
                    const size = Math.random() * 10 + 5;
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    const left = Math.random() * 100;
                    const animationDuration = Math.random() * 3 + 2;
                    const animationDelay = Math.random() * 2;
                    
                    confetti.style.width = `${size}px`;
                    confetti.style.height = `${size}px`;
                    confetti.style.backgroundColor = color;
                    confetti.style.left = `${left}%`;
                    confetti.style.animationDuration = `${animationDuration}s`;
                    confetti.style.animationDelay = `${animationDelay}s`;
                    
                    confettiContainer.appendChild(confetti);
                    
                    // Remove confetti after animation
                    setTimeout(() => {
                        confetti.remove();
                    }, animationDuration * 1000);
                }
            }
            
            // Show toast notification
            function showToast(message, type) {
                const toast = document.createElement('div');
                toast.className = `fixed bottom-4 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-lg shadow-lg text-white animate__animated animate__fadeInUp ${type === 'error' ? 'bg-red-500' : type === 'success' ? 'bg-green-500' : 'bg-blue-500'}`;
                toast.textContent = message;
                
                document.body.appendChild(toast);
                
                // Remove toast after 3 seconds
                setTimeout(() => {
                    toast.classList.remove('animate__fadeInUp');
                    toast.classList.add('animate__fadeOutDown');
                    setTimeout(() => {
                        toast.remove();
                    }, 300);
                }, 3000);
            }
            
            // Log analytics event
            function logEvent(eventName, eventParams = {}) {
                if (typeof analytics !== 'undefined') {
                    analytics.logEvent(eventName, eventParams);
                }
                console.log(`Event: ${eventName}`, eventParams);
            }
            
            // Format date as "Month Day, Year"
            function formatDate(date) {
                return date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            }
            
            // Format time as "X hours/minutes ago"
            function formatTimeAgo(timestamp) {
                const now = new Date();
                const past = new Date(timestamp);
                const diffMs = now - past;
                const diffMins = Math.round(diffMs / 60000);
                const diffHours = Math.round(diffMs / 3600000);
                const diffDays = Math.round(diffMs / 86400000);
                
                if (diffMins < 1) {
                    return 'Just now';
                } else if (diffMins < 60) {
                    return `${diffMins} minute${diffMins !== 1 ? 's' : ''} ago`;
                } else if (diffHours < 24) {
                    return `${diffHours} hour${diffHours !== 1 ? 's' : ''} ago`;
                } else if (diffDays < 7) {
                    return `${diffDays} day${diffDays !== 1 ? 's' : ''} ago`;
                } else {
                    return formatDate(past);
                }
            }
            
            // Simulate loading with timeout
            function simulateLoading(callback, delay = 2000) {
                setTimeout(callback, delay);
            }
            
            // Start the app
            initApp();
        });
    </script>
</body>
</html>