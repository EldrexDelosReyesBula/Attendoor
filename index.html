<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NearCheck | Smart Attendance Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-messaging-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-functions-compat.js"></script>
    <style>
        /* CSS Reset and Base Styles */
        :root {
            --primary: #5e72e4;
            --primary-dark: #4a5acf;
            --primary-light: rgba(94, 114, 228, 0.1);
            --secondary: #f7fafc;
            --dark: #1a202c;
            --light: #ffffff;
            --gray: #e2e8f0;
            --gray-dark: #a0aec0;
            --success: #48bb78;
            --success-dark: #38a169;
            --warning: #ed8936;
            --warning-dark: #dd6b20;
            --danger: #f56565;
            --danger-dark: #e53e3e;
            --info: #4299e1;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --text-primary: var(--dark);
            --text-secondary: #4a5568;
            --bg-primary: var(--light);
            --bg-secondary: var(--secondary);
            --border-color: rgba(0, 0, 0, 0.1);
            --toastify-color-light: #fff;
            --toastify-color-dark: #1a202c;
            --toastify-color-info: var(--info);
            --toastify-color-success: var(--success);
            --toastify-color-warning: var(--warning);
            --toastify-color-error: var(--danger);
            --toastify-font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        .dark {
            --primary: #667eea;
            --primary-dark: #5a67d8;
            --primary-light: rgba(102, 126, 234, 0.1);
            --secondary: #2d3748;
            --dark: #f7fafc;
            --light: #1a202c;
            --gray: #4a5568;
            --gray-dark: #718096;
            --text-primary: var(--dark);
            --text-secondary: #cbd5e0;
            --bg-primary: var(--light);
            --bg-secondary: var(--secondary);
            --border-color: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: var(--transition);
            overscroll-behavior-y: contain;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .items-center {
            align-items: center;
        }

        .justify-center {
            justify-content: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .justify-end {
            justify-content: flex-end;
        }

        .w-full {
            width: 100%;
        }

        .h-full {
            height: 100%;
        }

        .gap-1 {
            gap: 0.25rem;
        }

        .gap-2 {
            gap: 0.5rem;
        }

        .gap-3 {
            gap: 0.75rem;
        }

        .gap-4 {
            gap: 1rem;
        }

        .p-2 {
            padding: 0.5rem;
        }

        .p-3 {
            padding: 0.75rem;
        }

        .p-4 {
            padding: 1rem;
        }

        .px-2 {
            padding-left: 0.5rem;
            padding-right: 0.5rem;
        }

        .px-4 {
            padding-left: 1rem;
            padding-right: 1rem;
        }

        .py-2 {
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
        }

        .py-3 {
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
        }

        .mt-1 {
            margin-top: 0.25rem;
        }

        .mt-2 {
            margin-top: 0.5rem;
        }

        .mt-3 {
            margin-top: 0.75rem;
        }

        .mt-4 {
            margin-top: 1rem;
        }

        .mb-2 {
            margin-bottom: 0.5rem;
        }

        .mb-3 {
            margin-bottom: 0.75rem;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .text-center {
            text-align: center;
        }

        .text-xs {
            font-size: 0.75rem;
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .text-base {
            font-size: 1rem;
        }

        .text-lg {
            font-size: 1.125rem;
        }

        .text-xl {
            font-size: 1.25rem;
        }

        .text-2xl {
            font-size: 1.5rem;
        }

        .font-medium {
            font-weight: 500;
        }

        .font-semibold {
            font-weight: 600;
        }

        .font-bold {
            font-weight: 700;
        }

        .rounded {
            border-radius: var(--radius);
        }

        .rounded-lg {
            border-radius: calc(var(--radius) * 1.5);
        }

        .rounded-full {
            border-radius: 9999px;
        }

        .shadow {
            box-shadow: var(--shadow);
        }

        .shadow-md {
            box-shadow: var(--shadow-md);
        }

        .shadow-lg {
            box-shadow: var(--shadow-lg);
        }

        .bg-primary {
            background-color: var(--primary);
        }

        .bg-primary-light {
            background-color: var(--primary-light);
        }

        .bg-secondary {
            background-color: var(--secondary);
        }

        .bg-danger {
            background-color: var(--danger);
        }

        .bg-success {
            background-color: var(--success);
        }

        .bg-warning {
            background-color: var(--warning);
        }

        .text-primary {
            color: var(--text-primary);
        }

        .text-secondary {
            color: var(--text-secondary);
        }

        .text-light {
            color: var(--light);
        }

        .border {
            border: 1px solid var(--border-color);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes scaleIn {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes ripple {
            0% {
                transform: scale(0.8);
                opacity: 1;
            }
            100% {
                transform: scale(2.5);
                opacity: 0;
            }
        }

        .animate-fade {
            animation: fadeIn 0.3s ease-out forwards;
        }

        .animate-fade-out {
            animation: fadeOut 0.3s ease-out forwards;
        }

        .animate-slide-up {
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .animate-slide-down {
            animation: slideDown 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .animate-scale {
            animation: scaleIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .animate-bounce {
            animation: bounce 1s infinite;
        }

        /* Main App Container */
        #app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            max-width: 100vw;
            overflow-x: hidden;
            position: relative;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-primary);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid rgba(94, 114, 228, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }

        .loading-text {
            font-size: 1.125rem;
            color: var(--text-secondary);
        }

        /* Auth Screen */
        .auth-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
            background-color: var(--bg-primary);
        }

        .auth-card {
            width: 100%;
            max-width: 400px;
            background-color: var(--bg-primary);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            transition: var(--transition);
            border: 1px solid var(--border-color);
        }

        .auth-header {
            padding: 1.5rem;
            text-align: center;
            background-color: var(--primary);
            color: white;
        }

        .auth-logo {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .auth-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .auth-body {
            padding: 1.5rem;
        }

        .auth-footer {
            padding: 1rem 1.5rem;
            text-align: center;
            border-top: 1px solid var(--border-color);
        }

        .auth-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
        }

        .auth-tab {
            flex: 1;
            padding: 0.75rem;
            text-align: center;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            transition: var(--transition);
        }

        .auth-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .auth-social-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .auth-social-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .auth-social-btn:hover {
            background-color: var(--bg-secondary);
        }

        .auth-divider {
            display: flex;
            align-items: center;
            margin: 1.5rem 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background-color: var(--border-color);
            margin: 0 0.5rem;
        }

        /* Header */
        .header {
            position: sticky;
            top: 0;
            z-index: 50;
            background-color: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: var(--transition);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        .header-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            text-transform: uppercase;
            cursor: pointer;
            user-select: none;
            transition: var(--transition);
            flex-shrink: 0;
        }

        .avatar:hover {
            transform: scale(1.05);
        }

        .avatar.small {
            width: 28px;
            height: 28px;
            font-size: 0.75rem;
        }

        .avatar.large {
            width: 48px;
            height: 48px;
            font-size: 1.25rem;
        }

        .icon-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-primary);
            background-color: transparent;
            border: none;
            position: relative;
        }

        .icon-button:hover {
            background-color: var(--bg-secondary);
        }

        .icon-button .badge {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background-color: var(--danger);
            color: white;
            font-size: 0.625rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--bg-primary);
        }

        /* Drawer */
        .drawer {
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            height: 100vh;
            background-color: var(--bg-primary);
            z-index: 100;
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 4px 0 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        .drawer.open {
            transform: translateX(0);
        }

        .drawer-header {
            padding: 1.5rem 1rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .drawer-user-info {
            flex: 1;
            min-width: 0;
        }

        .drawer-user-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .drawer-user-email {
            font-size: 0.75rem;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .drawer-user-role {
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: inline-block;
            padding: 0.125rem 0.375rem;
            border-radius: 9999px;
            background-color: var(--primary-light);
            color: var(--primary);
            font-weight: 500;
        }

        .drawer-body {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem 0;
        }

        .drawer-item {
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-primary);
            text-decoration: none;
            position: relative;
        }

        .drawer-item:hover {
            background-color: var(--bg-secondary);
        }

        .drawer-item.active {
            background-color: var(--primary);
            color: white;
        }

        .drawer-item.active .drawer-item-icon {
            color: white;
        }

        .drawer-item.active::after {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background-color: var(--primary-dark);
            border-radius: 2px 0 0 2px;
        }

        .drawer-item-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        .drawer-item-text {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .drawer-footer {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .drawer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 99;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .drawer-overlay.open {
            opacity: 1;
            pointer-events: all;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 1rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* Page Title */
        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .page-title .badge {
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* Card Styles */
        .card {
            background-color: var(--bg-primary);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: var(--transition);
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        .card-header {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-title {
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-body {
            padding: 1rem;
        }

        .card-footer {
            padding: 0.75rem 1rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
        }

        /* Button Styles */
        .btn {
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition-fast);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            border: none;
            user-select: none;
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(45deg);
            pointer-events: none;
            transition: var(--transition);
            opacity: 0;
        }

        .btn:hover::after {
            transform: translateX(100%) rotate(45deg);
            opacity: 1;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .btn-outline:hover {
            background-color: var(--bg-secondary);
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: var(--danger-dark);
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: var(--success-dark);
        }

        .btn-warning {
            background-color: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background-color: var(--warning-dark);
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            border-radius: 50%;
        }

        .btn-link {
            background: none;
            border: none;
            color: var(--primary);
            padding: 0;
            font-weight: 500;
            text-decoration: underline;
        }

        .btn-link:hover {
            text-decoration: none;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.875rem;
            color: var(--text-primary);
        }

        .form-control {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: var(--transition);
            font-size: 0.875rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(94, 114, 228, 0.2);
        }

        .form-text {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }

        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            user-select: none;
        }

        .form-checkbox input {
            width: 16px;
            height: 16px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            appearance: none;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .form-checkbox input:checked {
            background-color: var(--primary);
            border-color: var(--primary);
        }

        .form-checkbox input:checked::after {
            content: '\2713';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 0.75rem;
        }

        /* Alert Styles */
        .alert {
            padding: 0.75rem 1rem;
            border-radius: var(--radius);
            margin-bottom: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            animation: slideUp 0.3s ease-out forwards;
        }

        .alert-icon {
            flex-shrink: 0;
            font-size: 1.25rem;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .alert-danger {
            background-color: rgba(245, 101, 101, 0.1);
            border: 1px solid rgba(245, 101, 101, 0.2);
            color: var(--danger);
        }

        .alert-success {
            background-color: rgba(72, 187, 120, 0.1);
            border: 1px solid rgba(72, 187, 120, 0.2);
            color: var(--success);
        }

        .alert-warning {
            background-color: rgba(237, 137, 54, 0.1);
            border: 1px solid rgba(237, 137, 54, 0.2);
            color: var(--warning);
        }

        .alert-info {
            background-color: rgba(66, 153, 225, 0.1);
            border: 1px solid rgba(66, 153, 225, 0.2);
            color: var(--info);
        }

        /* Badge Styles */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            line-height: 1;
            gap: 0.25rem;
        }

        .badge-primary {
            background-color: rgba(94, 114, 228, 0.1);
            color: var(--primary);
        }

        .badge-success {
            background-color: rgba(72, 187, 120, 0.1);
            color: var(--success);
        }

        .badge-danger {
            background-color: rgba(245, 101, 101, 0.1);
            color: var(--danger);
        }

        .badge-warning {
            background-color: rgba(237, 137, 54, 0.1);
            color: var(--warning);
        }

        .badge-info {
            background-color: rgba(66, 153, 225, 0.1);
            color: var(--info);
        }

        .badge-light {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
        }

        /* List Styles */
        .list {
            list-style: none;
        }

        .list-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            transition: var(--transition);
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .list-item:hover {
            background-color: var(--bg-secondary);
        }

        .list-item-content {
            flex: 1;
            min-width: 0;
        }

        .list-item-title {
            font-weight: 500;
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .list-item-subtitle {
            font-size: 0.75rem;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .list-item-action {
            margin-left: 0.75rem;
            flex-shrink: 0;
        }

        /* Grid Styles */
        .grid {
            display: grid;
            gap: 1rem;
        }

        .grid-cols-1 {
            grid-template-columns: repeat(1, 1fr);
        }

        .grid-cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .grid-cols-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        /* Stats Styles */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat {
            background-color: var(--bg-primary);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: var(--transition);
        }

        .stat:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            flex-shrink: 0;
        }

        .stat-icon-primary {
            background-color: var(--primary);
        }

        .stat-icon-success {
            background-color: var(--success);
        }

        .stat-icon-warning {
            background-color: var(--warning);
        }

        .stat-icon-danger {
            background-color: var(--danger);
        }

        .stat-content {
            flex: 1;
        }

        .stat-title {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Progress Styles */
        .progress {
            height: 6px;
            border-radius: 3px;
            background-color: var(--bg-secondary);
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-bar {
            height: 100%;
            border-radius: 3px;
            background-color: var(--primary);
            transition: width 0.6s ease;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            padding: 1rem;
        }

        .modal.open {
            opacity: 1;
            pointer-events: all;
        }

        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1;
        }

        .modal-content {
            position: relative;
            z-index: 2;
            background-color: var(--bg-primary);
            border-radius: var(--radius);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal.open .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-weight: 600;
            font-size: 1.25rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }

        .modal-close:hover {
            color: var(--text-primary);
            background-color: var(--bg-secondary);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }

        /* Tabs Styles */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1rem;
            overflow-x: auto;
        }

        .tab {
            padding: 0.75rem 1rem;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            transition: var(--transition);
            white-space: nowrap;
        }

        .tab:hover {
            color: var(--text-primary);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--bg-primary);
            border-top: 1px solid var(--border-color);
            z-index: 40;
            display: flex;
            justify-content: space-around;
            padding: 0.5rem 0;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.75rem;
            transition: var(--transition);
            flex: 1;
        }

        .bottom-nav-item.active {
            color: var(--primary);
        }

        .bottom-nav-icon {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        /* Skeleton Loading */
        .skeleton {
            background-color: var(--bg-secondary);
            border-radius: var(--radius);
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .skeleton-text {
            height: 1rem;
            width: 100%;
            margin-bottom: 0.5rem;
        }

        .skeleton-text:last-child {
            margin-bottom: 0;
            width: 80%;
        }

        .skeleton-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            text-align: center;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--gray-dark);
        }

        .empty-state-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        /* Switch Styles */
        .switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--gray);
            transition: var(--transition);
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray-dark);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* Dark Mode Toggle */
        .dark-mode-toggle {
            position: fixed;
            bottom: 70px;
            right: 20px;
            z-index: 50;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .dark-mode-toggle:hover {
            transform: scale(1.1);
        }

        /* Responsive Adjustments */
        @media (min-width: 768px) {
            .header {
                padding: 0.75rem 1.5rem;
            }
            
            .main-content {
                padding: 1.5rem;
            }
            
            .bottom-nav {
                display: none;
            }
        }

        @media (max-width: 640px) {
            .stats {
                grid-template-columns: 1fr;
            }
            
            .grid-cols-2, .grid-cols-3, .grid-cols-4 {
                grid-template-columns: 1fr;
            }
        }

        /* Specific Page Styles */
        /* Dashboard */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        /* Attendance Session */
        .attendance-session-card {
            margin-bottom: 1.5rem;
        }

        .attendance-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }

        .attendance-status.active {
            color: var(--success);
        }

        .attendance-status.inactive {
            color: var(--danger);
        }

        .attendance-status-icon {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .attendance-status-icon.active {
            background-color: var(--success);
            animation: pulse 2s infinite;
        }

        .attendance-status-icon.inactive {
            background-color: var(--danger);
        }

        .attendance-controls {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .attendance-students {
            margin-top: 1.5rem;
        }

        /* Student Check-in View */
        .check-in-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: calc(100vh - 120px);
            padding: 1rem;
            text-align: center;
        }

        .check-in-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 600;
            margin: 2rem 0;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 10px 25px rgba(94, 114, 228, 0.3);
            position: relative;
            overflow: hidden;
            border: none;
        }

        .check-in-button:active {
            transform: scale(0.95);
        }

        .check-in-button.pulse {
            animation: pulse 1.5s infinite;
        }

        .check-in-button.ripple {
            position: relative;
            overflow: hidden;
        }

        .check-in-button.ripple::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 70%);
            transform: scale(0);
            opacity: 0;
        }

        .check-in-button.ripple:active::after {
            animation: ripple 0.6s ease-out;
        }

        .check-in-details {
            margin-top: 1rem;
            width: 100%;
            max-width: 400px;
        }

        .check-in-detail {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .check-in-detail:last-child {
            border-bottom: none;
        }

        /* Section Management */
        .section-card {
            margin-bottom: 1rem;
            transition: var(--transition);
        }

        .section-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .section-header {
            cursor: pointer;
        }

        .section-students {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .section-students.open {
            max-height: 1000px;
        }

        /* Settings */
        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-item-label {
            font-weight: 500;
        }

        .settings-item-description {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        /* AI Warning */
        .ai-warning {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: var(--radius);
            background-color: rgba(237, 137, 54, 0.1);
            border: 1px solid rgba(237, 137, 54, 0.2);
            margin-bottom: 1rem;
        }

        .ai-warning-icon {
            color: var(--warning);
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .ai-warning-content {
            flex: 1;
        }

        .ai-warning-title {
            font-weight: 600;
            color: var(--warning);
            margin-bottom: 0.25rem;
        }

        .ai-warning-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        /* Time and Location Settings */
        .settings-range {
            margin-top: 1rem;
        }

        .range-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .range-input {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            background: var(--bg-secondary);
            border-radius: 3px;
            outline: none;
        }

        .range-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            transition: var(--transition);
        }

        .range-input::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        /* Calendar */
        .calendar {
            width: 100%;
            border-collapse: collapse;
        }

        .calendar th {
            padding: 0.5rem;
            text-align: center;
            font-weight: 500;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .calendar td {
            padding: 0.5rem;
            text-align: center;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .calendar td:hover {
            background-color: var(--bg-secondary);
        }

        .calendar-day {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin: 0 auto;
        }

        .calendar-day.today {
            background-color: var(--primary);
            color: white;
        }

        .calendar-day.present {
            background-color: var(--success);
            color: white;
        }

        .calendar-day.absent {
            background-color: var(--danger);
            color: white;
        }

        .calendar-day.partial {
            background-color: var(--warning);
            color: white;
        }

        /* Responsive Tables */
        .responsive-table {
            width: 100%;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            font-weight: 600;
            color: var(--text-secondary);
            background-color: var(--bg-secondary);
        }

        tr:hover {
            background-color: var(--bg-secondary);
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 120px;
            background-color: var(--dark);
            color: var(--light);
            text-align: center;
            border-radius: var(--radius);
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem;
        }

        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--dark) transparent transparent transparent;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Custom Radio */
        .radio-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .radio-input {
            appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            outline: none;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .radio-input:checked {
            border-color: var(--primary);
        }

        .radio-input:checked::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 10px;
            height: 10px;
            background-color: var(--primary);
            border-radius: 50%;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--dark);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .toast.show {
            opacity: 1;
        }

        .toast-icon {
            font-size: 1.25rem;
        }

        .toast-success {
            background-color: var(--success);
        }

        .toast-error {
            background-color: var(--danger);
        }

        .toast-warning {
            background-color: var(--warning);
        }

        /* Loading Spinner */
        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        /* Confetti Effect */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
            z-index: 9999;
            animation: confetti-fall 3s ease-in-out forwards;
        }

        /* Custom Checkbox */
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            user-select: none;
        }

        .checkbox-input {
            appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            outline: none;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .checkbox-input:checked {
            background-color: var(--primary);
            border-color: var(--primary);
        }

        .checkbox-input:checked::after {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 0.75rem;
        }

        /* Date Picker */
        .date-picker {
            position: relative;
        }

        .date-picker-input {
            padding-right: 2.5rem;
        }

        .date-picker-icon {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            pointer-events: none;
        }

        /* Time Picker */
        .time-picker {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .time-picker-input {
            width: 60px;
            text-align: center;
        }

        .time-picker-separator {
            font-weight: 600;
        }

        /* Student Card */
        .student-card {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-radius: var(--radius);
            background-color: var(--bg-primary);
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .student-card:hover {
            background-color: var(--bg-secondary);
        }

        .student-info {
            flex: 1;
            min-width: 0;
        }

        .student-name {
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .student-email {
            font-size: 0.75rem;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Notification Dropdown */
        .notification-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            width: 320px;
            max-height: 400px;
            overflow-y: auto;
            background-color: var(--bg-primary);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: 60;
            transform: translateY(10px);
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .notification-dropdown.open {
            transform: translateY(0);
            opacity: 1;
            pointer-events: all;
        }

        .notification-header {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .notification-title {
            font-weight: 600;
        }

        .notification-clear {
            font-size: 0.75rem;
            color: var(--primary);
            cursor: pointer;
        }

        .notification-list {
            list-style: none;
        }

        .notification-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .notification-item:hover {
            background-color: var(--bg-secondary);
        }

        .notification-item.unread {
            background-color: var(--primary-light);
        }

        .notification-content {
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .notification-time {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Responsive Adjustments */
        @media (max-width: 480px) {
            .header-title span {
                display: none;
            }
            
            .stat {
                flex-direction: column;
                text-align: center;
                gap: 0.5rem;
            }
            
            .attendance-controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .notification-dropdown {
                width: 280px;
                right: -20px;
            }
        }

        /* Physics animations */
        .physics-card {
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .physics-card:hover {
            transform: translateY(-3px) rotate(1deg);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .physics-button {
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .physics-button:active {
            transform: scale(0.95);
        }

        /* Ripple effect */
        .ripple {
            position: relative;
            overflow: hidden;
        }

        .ripple-effect {
            position: absolute;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.4);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }

        /* Floating action button */
        .fab {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: var(--transition);
            z-index: 50;
        }

        .fab:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .fab:active {
            transform: translateY(-1px);
        }

        /* Section invite link */
        .invite-link {
            display: flex;
            align-items: center;
            background-color: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 0.5rem;
            margin-top: 0.5rem;
        }

        .invite-link-input {
            flex: 1;
            border: none;
            background: none;
            color: var(--text-primary);
            font-family: monospace;
            font-size: 0.875rem;
            padding: 0.25rem 0.5rem;
        }

        .invite-link-input:focus {
            outline: none;
        }

        .invite-link-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
        }

        .invite-link-btn:hover {
            background-color: var(--primary-light);
        }

        /* Student status indicators */
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .status-present {
            background-color: var(--success);
        }

        .status-late {
            background-color: var(--warning);
        }

        .status-absent {
            background-color: var(--danger);
        }

        /* Attendance chart */
        .attendance-chart {
            height: 200px;
            display: flex;
            align-items: flex-end;
            gap: 0.25rem;
            margin: 1rem 0;
        }

        .chart-bar {
            flex: 1;
            background-color: var(--primary);
            border-radius: 4px 4px 0 0;
            transition: height 0.5s ease;
            position: relative;
        }

        .chart-bar:hover {
            opacity: 0.8;
        }

        .chart-bar-label {
            position: absolute;
            bottom: -20px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Teacher permissions */
        .permission-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .permission-item:last-child {
            border-bottom: none;
        }

        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 1rem;
        }

        /* Student view */
        .student-view-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .student-section-info {
            flex: 1;
        }

        .student-section-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .student-section-teacher {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Real-time attendance */
        .attendance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
        }

        .attendance-student {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.75rem;
            border-radius: var(--radius);
            background-color: var(--bg-secondary);
            transition: var(--transition);
        }

        .attendance-student.present {
            background-color: rgba(72, 187, 120, 0.1);
        }

        .attendance-student.late {
            background-color: rgba(237, 137, 54, 0.1);
        }

        .attendance-student.absent {
            background-color: rgba(245, 101, 101, 0.1);
        }

        .attendance-student-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .attendance-student-name {
            font-size: 0.875rem;
            font-weight: 500;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        .attendance-student-status {
            font-size: 0.75rem;
            margin-top: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* Responsive adjustments for student view */
        @media (max-width: 640px) {
            .attendance-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }

        /* Custom scrollbar for drawer */
        .drawer-body::-webkit-scrollbar {
            width: 6px;
        }

        .drawer-body::-webkit-scrollbar-thumb {
            background-color: var(--gray-dark);
            border-radius: 3px;
        }

        /* Smooth transitions for all interactive elements */
        a, button, input, select, textarea, .card, .list-item, .tab, .drawer-item {
            transition: var(--transition);
        }

        /* Focus styles for accessibility */
        button:focus, input:focus, select:focus, textarea:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(94, 114, 228, 0.3);
        }

        /* Print styles */
        @media print {
            .header, .bottom-nav, .dark-mode-toggle, .fab {
                display: none !important;
            }
            
            .main-content {
                padding: 0;
            }
            
            .card {
                box-shadow: none;
                border: none;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Loading Screen -->
        <div class="loading-screen" id="loading-screen">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading NearCheck...</div>
        </div>

        <!-- Auth Screen -->
        <div class="auth-container hidden" id="auth-container">
            <div class="auth-card">
                <div class="auth-header">
                    <div class="auth-logo">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="auth-title">NearCheck</div>
                </div>
                <div class="auth-body">
                    <div class="auth-tabs">
                        <div class="auth-tab active" id="login-tab">Login</div>
                        <div class="auth-tab" id="signup-tab">Sign Up</div>
                    </div>

                    <div id="login-form">
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="login-email" placeholder="your@email.com">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="login-password" placeholder="••••••••">
                        </div>
                        <div class="form-group">
                            <label class="form-checkbox">
                                <input type="checkbox" id="remember-me">
                                <span>Remember me</span>
                            </label>
                        </div>
                        <button class="btn btn-primary w-full" id="login-btn">
                            <span id="login-btn-text">Login</span>
                            <span class="spinner hidden" id="login-spinner"></span>
                        </button>
                        <div class="text-center mt-3">
                            <button class="btn btn-link" id="forgot-password-btn">Forgot password?</button>
                        </div>
                    </div>

                    <div id="signup-form" class="hidden">
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="signup-name" placeholder="John Doe">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="signup-email" placeholder="your@email.com">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="signup-password" placeholder="••••••••">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="signup-confirm-password" placeholder="••••••••">
                        </div>
                        <div class="form-group">
                            <label class="form-checkbox">
                                <input type="checkbox" id="terms-agree">
                                <span>I agree to the <a href="#" class="text-primary">Terms of Service</a></span>
                            </label>
                        </div>
                        <button class="btn btn-primary w-full" id="signup-btn">
                            <span id="signup-btn-text">Create Account</span>
                            <span class="spinner hidden" id="signup-spinner"></span>
                        </button>
                    </div>

                    <div class="auth-divider">or continue with</div>

                    <div class="auth-social-buttons">
                        <button class="auth-social-btn" id="google-auth-btn">
                            <i class="fab fa-google"></i>
                            <span>Google</span>
                        </button>
                        <button class="auth-social-btn" id="microsoft-auth-btn">
                            <i class="fab fa-microsoft"></i>
                            <span>Microsoft</span>
                        </button>
                    </div>
                </div>
                <div class="auth-footer">
                    <div class="text-sm text-secondary">
                        By continuing, you agree to our <a href="#" class="text-primary">Terms</a> and <a href="#" class="text-primary">Privacy Policy</a>.
                    </div>
                </div>
            </div>
        </div>

        <!-- Main App -->
        <div class="app-container hidden" id="app-container">
            <!-- Header -->
            <header class="header">
                <div class="header-title">
                    <i class="fas fa-user-check"></i>
                    <span>NearCheck</span>
                </div>
                <div class="header-actions">
                    <button class="icon-button" id="notifications-btn">
                        <i class="fas fa-bell"></i>
                        <span class="badge hidden" id="notification-badge">0</span>
                    </button>
                    <button class="icon-button" id="theme-toggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="avatar" id="user-avatar">JD</div>
                </div>

                <!-- Notification Dropdown -->
                <div class="notification-dropdown" id="notification-dropdown">
                    <div class="notification-header">
                        <div class="notification-title">Notifications</div>
                        <div class="notification-clear" id="clear-notifications">Clear All</div>
                    </div>
                    <ul class="notification-list" id="notification-list">
                        <li class="notification-item unread">
                            <div class="notification-content">New attendance session started for Math 101</div>
                            <div class="notification-time">2 minutes ago</div>
                        </li>
                        <li class="notification-item">
                            <div class="notification-content">Carlos Reyes checked in to Science 202</div>
                            <div class="notification-time">1 hour ago</div>
                        </li>
                    </ul>
                </div>
            </header>

            <!-- Drawer -->
            <div class="drawer" id="drawer">
                <div class="drawer-header">
                    <div class="avatar large" id="drawer-avatar">JD</div>
                    <div class="drawer-user-info">
                        <div class="drawer-user-name" id="drawer-user-name">John Doe</div>
                        <div class="drawer-user-email" id="drawer-user-email">john.doe@example.com</div>
                        <div class="drawer-user-role" id="drawer-user-role">Teacher</div>
                    </div>
                </div>
                <div class="drawer-body">
                    <a href="#" class="drawer-item active" data-page="dashboard">
                        <div class="drawer-item-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <div class="drawer-item-text">Dashboard</div>
                    </a>
                    <a href="#" class="drawer-item" data-page="sections">
                        <div class="drawer-item-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="drawer-item-text">My Sections</div>
                    </a>
                    <a href="#" class="drawer-item" data-page="attendance">
                        <div class="drawer-item-icon">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <div class="drawer-item-text">Attendance</div>
                    </a>
                    <a href="#" class="drawer-item" data-page="reports">
                        <div class="drawer-item-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div class="drawer-item-text">Reports</div>
                    </a>
                    <a href="#" class="drawer-item" data-page="settings">
                        <div class="drawer-item-icon">
                            <i class="fas fa-cog"></i>
                        </div>
                        <div class="drawer-item-text">Settings</div>
                    </a>
                </div>
                <div class="drawer-footer">
                    <button class="btn btn-outline w-full" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
            <div class="drawer-overlay" id="drawer-overlay"></div>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page">
                    <h2 class="page-title">
                        <i class="fas fa-home"></i>
                        Dashboard
                        <span class="badge badge-light" id="welcome-time">Good Morning</span>
                    </h2>

                    <div class="dashboard-stats">
                        <div class="stat physics-card">
                            <div class="stat-icon stat-icon-primary">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-title">Active Sections</div>
                                <div class="stat-value" id="active-sections">3</div>
                            </div>
                        </div>
                        <div class="stat physics-card">
                            <div class="stat-icon stat-icon-success">
                                <i class="fas fa-user-check"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-title">Today's Attendance</div>
                                <div class="stat-value" id="today-attendance">87%</div>
                            </div>
                        </div>
                        <div class="stat physics-card">
                            <div class="stat-icon stat-icon-warning">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-title">AI Warnings</div>
                                <div class="stat-value" id="ai-warnings">2</div>
                            </div>
                        </div>
                    </div>

                    <div class="card physics-card">
                        <div class="card-header">
                            <div class="card-title">
                                <i class="fas fa-bell"></i>
                                Recent Activity
                            </div>
                            <button class="btn btn-sm btn-outline">View All</button>
                        </div>
                        <div class="card-body">
                            <div class="list">
                                <div class="list-item">
                                    <div class="list-item-avatar">MS</div>
                                    <div class="list-item-content">
                                        <div class="list-item-title">Mark Santos checked in to Math 101</div>
                                        <div class="list-item-subtitle">Today, 8:15 AM • 50m from location</div>
                                    </div>
                                    <div class="list-item-action">
                                        <span class="badge badge-success">On Time</span>
                                    </div>
                                </div>
                                <div class="list-item">
                                    <div class="list-item-avatar">AJ</div>
                                    <div class="list-item-content">
                                        <div class="list-item-title">Anna Javier checked in to Science 202</div>
                                        <div class="list-item-subtitle">Today, 9:30 AM • 80m from location</div>
                                    </div>
                                    <div class="list-item-action">
                                        <span class="badge badge-warning">Late</span>
                                    </div>
                                </div>
                                <div class="list-item">
                                    <div class="list-item-avatar">CR</div>
                                    <div class="list-item-content">
                                        <div class="list-item-title">Carlos Reyes was marked absent in History 301</div>
                                        <div class="list-item-subtitle">Today, 10:45 AM</div>
                                    </div>
                                    <div class="list-item-action">
                                        <span class="badge badge-danger">Absent</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card physics-card mt-4">
                        <div class="card-header">
                            <div class="card-title">
                                <i class="fas fa-exclamation-triangle"></i>
                                AI Warnings
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="ai-warning">
                                <div class="ai-warning-icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="ai-warning-content">
                                    <div class="ai-warning-title">Possible Duplicate Student</div>
                                    <div class="ai-warning-text">"Mark Santos" already exists in your Science 202 section. Is this the same student?</div>
                                    <div class="ai-warning-actions">
                                        <button class="btn btn-sm btn-outline">Allow</button>
                                        <button class="btn btn-sm btn-outline">Block</button>
                                        <button class="btn btn-sm btn-outline">Add Suffix</button>
                                    </div>
                                </div>
                            </div>
                            <div class="ai-warning">
                                <div class="ai-warning-icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="ai-warning-content">
                                    <div class="ai-warning-title">Unusual Check-in Pattern</div>
                                    <div class="ai-warning-text">Anna Javier has checked in from different locations within 5 minutes.</div>
                                    <div class="ai-warning-actions">
                                        <button class="btn btn-sm btn-outline">Investigate</button>
                                        <button class="btn btn-sm btn-outline">Ignore</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sections Page -->
                <div id="sections-page" class="page hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="page-title">
                            <i class="fas fa-users"></i>
                            My Sections
                        </h2>
                        <button class="btn btn-primary physics-button" id="add-section-btn">
                            <i class="fas fa-plus"></i> Add Section
                        </button>
                    </div>

                    <div class="card physics-card section-card">
                        <div class="section-header card-header">
                            <div class="flex items-center gap-3">
                                <div class="avatar">M1</div>
                                <div>
                                    <div class="font-bold">Math 101</div>
                                    <div class="text-sm text-secondary">25 students • Mon/Wed/Fri 8:00-9:30 AM</div>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <button class="btn btn-sm btn-outline physics-button" id="invite-btn-1">
                                    <i class="fas fa-link"></i> Invite
                                </button>
                                <button class="btn btn-sm btn-outline physics-button section-toggle">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                        </div>
                        <div class="section-students">
                            <div class="card-body">
                                <div class="flex justify-between items-center mb-3">
                                    <div class="font-bold">Students (25)</div>
                                    <button class="btn btn-sm btn-outline physics-button">
                                        <i class="fas fa-sort-alpha-down"></i> Sort
                                    </button>
                                </div>
                                <div class="list">
                                    <div class="list-item">
                                        <div class="list-item-avatar">MS</div>
                                        <div class="list-item-content">
                                            <div class="list-item-title">Mark Santos</div>
                                            <div class="list-item-subtitle">92% attendance</div>
                                        </div>
                                        <div class="list-item-action">
                                            <button class="btn btn-sm btn-danger physics-button">
                                                <i class="fas fa-user-minus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="list-item">
                                        <div class="list-item-avatar">AJ</div>
                                        <div class="list-item-content">
                                            <div class="list-item-title">Anna Javier</div>
                                            <div class="list-item-subtitle">85% attendance</div>
                                        </div>
                                        <div class="list-item-action">
                                            <button class="btn btn-sm btn-danger physics-button">
                                                <i class="fas fa-user-minus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="list-item">
                                        <div class="list-item-avatar">CR</div>
                                        <div class="list-item-content">
                                            <div class="list-item-title">Carlos Reyes</div>
                                            <div class="list-item-subtitle">78% attendance</div>
                                        </div>
                                        <div class="list-item-action">
                                            <button class="btn btn-sm btn-danger physics-button">
                                                <i class="fas fa-user-minus"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-outline w-full mt-3 physics-button">
                                    <i class="fas fa-plus"></i> Add Student
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="card physics-card section-card mt-4">
                        <div class="section-header card-header">
                            <div class="flex items-center gap-3">
                                <div class="avatar">S2</div>
                                <div>
                                    <div class="font-bold">Science 202</div>
                                    <div class="text-sm text-secondary">30 students • Tue/Thu 10:00-11:30 AM</div>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <button class="btn btn-sm btn-outline physics-button" id="invite-btn-2">
                                    <i class="fas fa-link"></i> Invite
                                </button>
                                <button class="btn btn-sm btn-outline physics-button section-toggle">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                        </div>
                        <div class="section-students">
                            <div class="card-body">
                                <div class="flex justify-between items-center mb-3">
                                    <div class="font-bold">Students (30)</div>
                                    <button class="btn btn-sm btn-outline physics-button">
                                        <i class="fas fa-sort-alpha-down"></i> Sort
                                    </button>
                                </div>
                                <div class="empty-state">
                                    <div class="empty-state-icon">
                                        <i class="fas fa-users-slash"></i>
                                    </div>
                                    <div class="empty-state-title">No students in this section</div>
                                    <div class="empty-state-description">Add students manually or share the invite link</div>
                                    <button class="btn btn-primary mt-3 physics-button">
                                        <i class="fas fa-user-plus"></i> Add Student
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Attendance Page -->
                <div id="attendance-page" class="page hidden">
                    <h2 class="page-title">
                        <i class="fas fa-clipboard-list"></i>
                        Attendance Sessions
                    </h2>

                    <div class="card physics-card attendance-session-card">
                        <div class="card-header">
                            <div class="flex items-center gap-3">
                                <div class="attendance-status">
                                    <div class="attendance-status-icon active"></div>
                                    <span>Active</span>
                                </div>
                                <div>
                                    <div class="font-bold">Math 101 - Morning Session</div>
                                    <div class="text-sm text-secondary">Ends in 15 minutes</div>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-danger physics-button">
                                <i class="fas fa-stop"></i> End Session
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-sm text-secondary">Check-in Window</div>
                                    <div class="font-bold">8:00 AM - 8:30 AM</div>
                                </div>
                                <div>
                                    <div class="text-sm text-secondary">Location Range</div>
                                    <div class="font-bold">100 meters</div>
                                </div>
                                <div>
                                    <div class="text-sm text-secondary">Students</div>
                                    <div class="font-bold">18/25 checked in</div>
                                </div>
                            </div>

                            <div class="attendance-controls">
                                <button class="btn btn-outline physics-button">
                                    <i class="fas fa-cog"></i> Settings
                                </button>
                                <button class="btn btn-primary physics-button">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>

                            <div class="attendance-students">
                                <div class="flex justify-between items-center mb-3">
                                    <div class="font-bold">Student Check-ins</div>
                                    <div class="flex gap-2">
                                        <button class="btn btn-sm btn-outline physics-button">
                                            <i class="fas fa-filter"></i> Filter
                                        </button>
                                        <button class="btn btn-sm btn-outline physics-button">
                                            <i class="fas fa-print"></i> Print
                                        </button>
                                    </div>
                                </div>

                                <div class="list">
                                    <div class="list-item">
                                        <div class="list-item-avatar">MS</div>
                                        <div class="list-item-content">
                                            <div class="list-item-title">Mark Santos</div>
                                            <div class="list-item-subtitle">Checked in at 8:05 AM • 50m from location</div>
                                        </div>
                                        <div class="list-item-action">
                                            <span class="badge badge-success">Present</span>
                                        </div>
                                    </div>
                                    <div class="list-item">
                                        <div class="list-item-avatar">AJ</div>
                                        <div class="list-item-content">
                                            <div class="list-item-title">Anna Javier</div>
                                            <div class="list-item-subtitle">Checked in at 8:25 AM • 80m from location</div>
                                        </div>
                                        <div class="list-item-action">
                                            <span class="badge badge-warning">Late</span>
                                        </div>
                                    </div>
                                    <div class="list-item">
                                        <div class="list-item-avatar">CR</div>
                                        <div class="list-item-content">
                                            <div class="list-item-title">Carlos Reyes</div>
                                            <div class="list-item-subtitle">Not checked in</div>
                                        </div>
                                        <div class="list-item-action">
                                            <span class="badge badge-danger">Absent</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card physics-card mt-4">
                        <div class="card-header">
                            <div class="flex items-center gap-3">
                                <div class="attendance-status">
                                    <div class="attendance-status-icon inactive"></div>
                                    <span>Inactive</span>
                                </div>
                                <div>
                                    <div class="font-bold">Science 202 - Afternoon Session</div>
                                    <div class="text-sm text-secondary">Starts at 1:00 PM</div>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-success physics-button">
                                <i class="fas fa-play"></i> Start Session
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Reports Page -->
                <div id="reports-page" class="page hidden">
                    <h2 class="page-title">
                        <i class="fas fa-chart-bar"></i>
                        Attendance Reports
                    </h2>

                    <div class="card physics-card">
                        <div class="card-header">
                            <div class="card-title">Monthly Summary</div>
                            <div class="flex items-center gap-2">
                                <button class="btn btn-sm btn-outline physics-button">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <div class="font-bold">April 2023</div>
                                <button class="btn btn-sm btn-outline physics-button">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div class="stat physics-card">
                                    <div class="stat-icon stat-icon-primary">
                                        <i class="fas fa-calendar-check"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-title">Total Sessions</div>
                                        <div class="stat-value">24</div>
                                    </div>
                                </div>
                                <div class="stat physics-card">
                                    <div class="stat-icon stat-icon-success">
                                        <i class="fas fa-user-check"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-title">Average Attendance</div>
                                        <div class="stat-value">89%</div>
                                    </div>
                                </div>
                                <div class="stat physics-card">
                                    <div class="stat-icon stat-icon-danger">
                                        <i class="fas fa-user-times"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-title">Total Absences</div>
                                        <div class="stat-value">15</div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-4">
                                <div class="flex justify-between items-center mb-2">
                                    <div class="font-bold">Attendance Trend</div>
                                    <div class="text-sm text-secondary">Math 101</div>
                                </div>
                                <div class="attendance-chart">
                                    <div class="chart-bar" style="height: 80%;">
                                        <div class="chart-bar-label">Mon</div>
                                    </div>
                                    <div class="chart-bar" style="height: 90%;">
                                        <div class="chart-bar-label">Tue</div>
                                    </div>
                                    <div class="chart-bar" style="height: 85%;">
                                        <div class="chart-bar-label">Wed</div>
                                    </div>
                                    <div class="chart-bar" style="height: 95%;">
                                        <div class="chart-bar-label">Thu</div>
                                    </div>
                                    <div class="chart-bar" style="height: 75%;">
                                        <div class="chart-bar-label">Fri</div>
                                    </div>
                                    <div class="chart-bar" style="height: 82%;">
                                        <div class="chart-bar-label">Sat</div>
                                    </div>
                                    <div class="chart-bar" style="height: 88%;">
                                        <div class="chart-bar-label">Sun</div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-4">
                                <div class="font-bold mb-2">Student Performance</div>
                                <div class="list">
                                    <div class="list-item">
                                        <div class="list-item-avatar">MS</div>
                                        <div class="list-item-content">
                                            <div class="list-item-title">Mark Santos</div>
                                            <div class="list-item-subtitle">Present: 22/24 (92%)</div>
                                            <div class="progress">
                                                <div class="progress-bar" style="width: 92%;"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="list-item">
                                        <div class="list-item-avatar">AJ</div>
                                        <div class="list-item-content">
                                            <div class="list-item-title">Anna Javier</div>
                                            <div class="list-item-subtitle">Present: 20/24 (83%)</div>
                                            <div class="progress">
                                                <div class="progress-bar" style="width: 83%;"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="list-item">
                                        <div class="list-item-avatar">CR</div>
                                        <div class="list-item-content">
                                            <div class="list-item-title">Carlos Reyes</div>
                                            <div class="list-item-subtitle">Present: 18/24 (75%)</div>
                                            <div class="progress">
                                                <div class="progress-bar" style="width: 75%;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <div class="font-bold mb-2">Calendar View</div>
                                <table class="calendar w-full">
                                    <thead>
                                        <tr>
                                            <th>Sun</th>
                                            <th>Mon</th>
                                            <th>Tue</th>
                                            <th>Wed</th>
                                            <th>Thu</th>
                                            <th>Fri</th>
                                            <th>Sat</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td>
                                                <div class="calendar-day">1</div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="calendar-day">2</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day present">3</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day present">4</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day present">5</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day present">6</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day present">7</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day">8</div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="calendar-day">9</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day present">10</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day present">11</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day absent">12</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day present">13</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day present">14</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day">15</div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="calendar-day">16</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day present">17</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day present">18</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day present">19</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day present">20</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day present">21</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day">22</div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="calendar-day">23</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day present">24</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day present">25</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day present today">26</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day">27</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day">28</div>
                                            </td>
                                            <td>
                                                <div class="calendar-day">29</div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="calendar-day">30</div>
                                            </td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Page -->
                <div id="settings-page" class="page hidden">
                    <h2 class="page-title">
                        <i class="fas fa-cog"></i>
                        Settings
                    </h2>

                    <div class="card physics-card">
                        <div class="card-header">
                            <div class="card-title">Account Settings</div>
                        </div>
                        <div class="card-body">
                            <div class="settings-item">
                                <div>
                                    <div class="settings-item-label">Dark Mode</div>
                                    <div class="settings-item-description">Switch between light and dark theme</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="dark-mode-toggle">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="settings-item">
                                <div>
                                    <div class="settings-item-label">Notifications</div>
                                    <div class="settings-item-description">Enable or disable notifications</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="notifications-toggle" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="settings-item">
                                <div>
                                    <div class="settings-item-label">Language</div>
                                    <div class="settings-item-description">Change app language</div>
                                </div>
                                <select class="form-control form-select" id="language-select">
                                    <option>English</option>
                                    <option>Filipino</option>
                                    <option>Spanish</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card physics-card mt-4">
                        <div class="card-header">
                            <div class="card-title">Attendance Settings</div>
                        </div>
                        <div class="card-body">
                            <div class="settings-item">
                                <div>
                                    <div class="settings-item-label">Default Check-in Window</div>
                                    <div class="settings-item-description">Set the default duration for check-in sessions</div>
                                </div>
                                <select class="form-control form-select" id="checkin-window-select">
                                    <option>15 minutes</option>
                                    <option>30 minutes</option>
                                    <option selected>45 minutes</option>
                                    <option>60 minutes</option>
                                </select>
                            </div>
                            <div class="settings-item">
                                <div>
                                    <div class="settings-item-label">Default Location Range</div>
                                    <div class="settings-item-description">Set the maximum distance for check-ins</div>
                                </div>
                                <div class="settings-range">
                                    <div class="range-label">
                                        <span>50m</span>
                                        <span id="range-value">100m</span>
                                        <span>500m</span>
                                    </div>
                                    <input type="range" min="50" max="500" value="100" class="range-input" id="location-range">
                                </div>
                            </div>
                            <div class="settings-item">
                                <div>
                                    <div class="settings-item-label">Auto-exclude Weekends</div>
                                    <div class="settings-item-description">Automatically skip attendance on weekends</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="exclude-weekends-toggle" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="card physics-card mt-4">
                        <div class="card-header">
                            <div class="card-title">Danger Zone</div>
                        </div>
                        <div class="card-body">
                            <div class="settings-item">
                                <div>
                                    <div class="settings-item-label">Clear Cache</div>
                                    <div class="settings-item-description">Clear all cached data</div>
                                </div>
                                <button class="btn btn-outline physics-button">Clear</button>
                            </div>
                            <div class="settings-item">
                                <div>
                                    <div class="settings-item-label">Export Data</div>
                                    <div class="settings-item-description">Export all your data as CSV</div>
                                </div>
                                <button class="btn btn-outline physics-button">Export</button>
                            </div>
                            <div class="settings-item">
                                <div>
                                    <div class="settings-item-label">Delete Account</div>
                                    <div class="settings-item-description">Permanently delete your account</div>
                                </div>
                                <button class="btn btn-danger physics-button">Delete</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Student Check-in Page -->
                <div id="checkin-page" class="page hidden">
                    <div class="check-in-container">
                        <h2 class="text-xl font-bold">Math 101 - Morning Session</h2>
                        <p class="text-secondary">Check-in window: 8:00 AM - 8:30 AM</p>
                        
                        <button class="check-in-button pulse ripple" id="check-in-btn">
                            CHECK IN
                        </button>
                        
                        <div class="check-in-details">
                            <div class="check-in-detail">
                                <span>Location Range</span>
                                <span>100 meters</span>
                            </div>
                            <div class="check-in-detail">
                                <span>Current Distance</span>
                                <span id="current-distance">65 meters</span>
                            </div>
                            <div class="check-in-detail">
                                <span>Time Remaining</span>
                                <span id="time-remaining">12 minutes</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Student View Page -->
                <div id="student-view-page" class="page hidden">
                    <div class="student-view-header">
                        <div class="avatar large">M1</div>
                        <div class="student-section-info">
                            <div class="student-section-title">Math 101 - Algebra</div>
                            <div class="student-section-teacher">Teacher: John Doe</div>
                        </div>
                    </div>

                    <div class="card physics-card">
                        <div class="card-header">
                            <div class="card-title">Today's Attendance</div>
                            <div class="text-sm text-secondary">April 26, 2023</div>
                        </div>
                        <div class="card-body">
                            <div class="attendance-grid">
                                <div class="attendance-student present">
                                    <div class="attendance-student-avatar">MS</div>
                                    <div class="attendance-student-name">Mark Santos</div>
                                    <div class="attendance-student-status">
                                        <span class="status-indicator status-present"></span>
                                        <span>Present</span>
                                    </div>
                                </div>
                                <div class="attendance-student present">
                                    <div class="attendance-student-avatar">AJ</div>
                                    <div class="attendance-student-name">Anna Javier</div>
                                    <div class="attendance-student-status">
                                        <span class="status-indicator status-present"></span>
                                        <span>Present</span>
                                    </div>
                                </div>
                                <div class="attendance-student late">
                                    <div class="attendance-student-avatar">CR</div>
                                    <div class="attendance-student-name">Carlos Reyes</div>
                                    <div class="attendance-student-status">
                                        <span class="status-indicator status-late"></span>
                                        <span>Late</span>
                                    </div>
                                </div>
                                <div class="attendance-student absent">
                                    <div class="attendance-student-avatar">LP</div>
                                    <div class="attendance-student-name">Luis Perez</div>
                                    <div class="attendance-student-status">
                                        <span class="status-indicator status-absent"></span>
                                        <span>Absent</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card physics-card mt-4">
                        <div class="card-header">
                            <div class="card-title">Your Attendance History</div>
                        </div>
                        <div class="card-body">
                            <div class="list">
                                <div class="list-item">
                                    <div class="list-item-content">
                                        <div class="list-item-title">April 24, 2023</div>
                                        <div class="list-item-subtitle">Checked in at 8:05 AM • 50m from location</div>
                                    </div>
                                    <div class="list-item-action">
                                        <span class="badge badge-success">Present</span>
                                    </div>
                                </div>
                                <div class="list-item">
                                    <div class="list-item-content">
                                        <div class="list-item-title">April 19, 2023</div>
                                        <div class="list-item-subtitle">Checked in at 8:25 AM • 80m from location</div>
                                    </div>
                                    <div class="list-item-action">
                                        <span class="badge badge-warning">Late</span>
                                    </div>
                                </div>
                                <div class="list-item">
                                    <div class="list-item-content">
                                        <div class="list-item-title">April 17, 2023</div>
                                        <div class="list-item-subtitle">Not checked in</div>
                                    </div>
                                    <div class="list-item-action">
                                        <span class="badge badge-danger">Absent</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Bottom Navigation (Mobile) -->
            <nav class="bottom-nav">
                <a href="#" class="bottom-nav-item active" data-page="dashboard">
                    <div class="bottom-nav-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <div>Home</div>
                </a>
                <a href="#" class="bottom-nav-item" data-page="sections">
                    <div class="bottom-nav-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div>Sections</div>
                </a>
                <a href="#" class="bottom-nav-item" data-page="attendance">
                    <div class="bottom-nav-icon">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <div>Attendance</div>
                </a>
                <a href="#" class="bottom-nav-item" data-page="reports">
                    <div class="bottom-nav-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div>Reports</div>
                </a>
            </nav>

            <!-- Dark Mode Toggle -->
            <div class="dark-mode-toggle" id="floating-theme-toggle">
                <i class="fas fa-moon"></i>
            </div>

            <!-- Floating Action Button -->
            <div class="fab physics-button" id="fab-button">
                <i class="fas fa-plus"></i>
            </div>

            <!-- Add Section Modal -->
            <div class="modal" id="add-section-modal">
                <div class="modal-overlay"></div>
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">Add New Section</div>
                        <button class="modal-close" id="close-add-section-modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="form-label">Section Name</label>
                            <input type="text" class="form-control" id="section-name" placeholder="e.g. Math 101">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Subject</label>
                            <input type="text" class="form-control" id="section-subject" placeholder="e.g. Algebra">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Schedule</label>
                            <div class="radio-group">
                                <label class="radio-item">
                                    <input type="radio" name="schedule" class="radio-input" value="mon-wed-fri" checked>
                                    <span>Mon/Wed/Fri</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="schedule" class="radio-input" value="tue-thu">
                                    <span>Tue/Thu</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="schedule" class="radio-input" value="daily">
                                    <span>Daily</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Time</label>
                            <div class="time-picker">
                                <input type="number" class="form-control time-picker-input" id="section-hour" min="1" max="12" value="8">
                                <span class="time-picker-separator">:</span>
                                <input type="number" class="form-control time-picker-input" id="section-minute" min="0" max="59" value="00">
                                <select class="form-control" id="section-period">
                                    <option>AM</option>
                                    <option>PM</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Default Check-in Window</label>
                            <select class="form-control" id="section-checkin-window">
                                <option value="15">15 minutes</option>
                                <option value="30">30 minutes</option>
                                <option value="45" selected>45 minutes</option>
                                <option value="60">60 minutes</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-outline physics-button" id="cancel-add-section">Cancel</button>
                        <button class="btn btn-primary physics-button" id="save-section">
                            <span id="save-section-text">Save Section</span>
                            <span class="spinner hidden" id="save-section-spinner"></span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Invite Link Modal -->
            <div class="modal" id="invite-modal">
                <div class="modal-overlay"></div>
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">Invite Students</div>
                        <button class="modal-close" id="close-invite-modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="form-label">Invite Link</label>
                            <div class="invite-link">
                                <input type="text" class="invite-link-input" id="invite-link-input" value="https://nearcheck.app/join/abc123" readonly>
                                <button class="invite-link-btn" id="copy-invite-link">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Expiration</label>
                            <select class="form-control" id="invite-expiration">
                                <option value="1">1 day</option>
                                <option value="7" selected>1 week</option>
                                <option value="30">1 month</option>
                                <option value="0">Never</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Role</label>
                            <div class="radio-group">
                                <label class="radio-item">
                                    <input type="radio" name="invite-role" class="radio-input" value="student" checked>
                                    <span>Student</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="invite-role" class="radio-input" value="teacher">
                                    <span>Teacher</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-outline physics-button" id="cancel-invite">Cancel</button>
                        <button class="btn btn-primary physics-button" id="save-invite">
                            <i class="fas fa-share"></i> Share
                        </button>
                    </div>
                </div>
            </div>

            <!-- Session Settings Modal -->
            <div class="modal" id="session-settings-modal">
                <div class="modal-overlay"></div>
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">Attendance Session Settings</div>
                        <button class="modal-close" id="close-session-settings-modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="form-label">Session Name</label>
                            <input type="text" class="form-control" id="session-name" value="Math 101 - Morning Session">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Check-in Window</label>
                            <div class="flex gap-2">
                                <div class="date-picker flex-1">
                                    <input type="time" class="form-control date-picker-input" id="session-start-time" value="08:00">
                                    <div class="date-picker-icon">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                </div>
                                <span class="flex items-center">to</span>
                                <div class="date-picker flex-1">
                                    <input type="time" class="form-control date-picker-input" id="session-end-time" value="08:30">
                                    <div class="date-picker-icon">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Location Range</label>
                            <div class="settings-range">
                                <div class="range-label">
                                    <span>50m</span>
                                    <span id="session-range-value">100m</span>
                                    <span>500m</span>
                                </div>
                                <input type="range" min="50" max="500" value="100" class="range-input" id="session-location-range">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-container">
                                <input type="checkbox" class="checkbox-input" id="allow-manual-checkin" checked>
                                <span>Allow manual check-in</span>
                            </label>
                            <p class="text-xs text-secondary mt-1">Enable this to allow students who forgot their devices to be marked present manually</p>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-container">
                                <input type="checkbox" class="checkbox-input" id="send-notifications" checked>
                                <span>Send notifications</span>
                            </label>
                            <p class="text-xs text-secondary mt-1">Notify students when the session starts</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-outline physics-button" id="cancel-session-settings">Cancel</button>
                        <button class="btn btn-primary physics-button" id="save-session-settings">Save Settings</button>
                    </div>
                </div>
            </div>

            <!-- Location Permission Modal -->
            <div class="modal" id="location-modal">
                <div class="modal-overlay"></div>
                <div class="modal-content animate-scale">
                    <div class="modal-header">
                        <div class="modal-title">Location Access Required</div>
                    </div>
                    <div class="modal-body">
                        <p>NearCheck needs access to your location to verify you're near school premises during check-in. This will not be stored and is only used during active sessions.</p>
                        <div class="flex flex-col gap-2 mt-4">
                            <button class="btn btn-primary physics-button" id="allow-location">Allow Location Access</button>
                            <button class="btn btn-outline physics-button" id="deny-location">Deny</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Check-in Success Modal -->
            <div class="modal" id="checkin-success-modal">
                <div class="modal-overlay"></div>
                <div class="modal-content animate-scale">
                    <div class="modal-body text-center py-8">
                        <div class="text-5xl text-success mb-4">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Check-in Successful!</h3>
                        <p class="text-secondary mb-4">You have been marked present for Math 101</p>
                        <div class="flex justify-center gap-2">
                            <div class="badge badge-success">
                                <i class="fas fa-clock"></i> 8:15 AM
                            </div>
                            <div class="badge badge-success">
                                <i class="fas fa-map-marker-alt"></i> 65m
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Toast Notification -->
            <div class="toast toast-success hidden" id="toast-notification">
                <div class="toast-icon">
                    <i class="fas fa-check"></i>
                </div>
                <div class="toast-message" id="toast-message">Changes saved successfully</div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay hidden" id="loading-overlay">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loading-text">Loading...</div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCVP8zaUj2iDrooLbRQNypHqB8QNTLhGDE",
            authDomain: "attendance-fe1c8.firebaseapp.com",
            projectId: "attendance-fe1c8",
            storageBucket: "attendance-fe1c8.firebasestorage.app",
            messagingSenderId: "903463376704",
            appId: "1:903463376704:web:d004c563d56aa286df8ca5",
            measurementId: "G-YY5GQZPSRK"
        };


        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const messaging = firebase.messaging();
        const functions = firebase.functions();

        // App State
        const state = {
            currentUser: null,
            currentPage: 'dashboard',
            darkMode: false,
            notifications: [],
            sections: [],
            activeSessions: [],
            students: [],
            userRole: null,
            currentSection: null,
            currentSession: null,
            unreadNotifications: 0
        };

        // DOM Elements
        const elements = {
            // Auth elements
            authContainer: document.getElementById('auth-container'),
            loginTab: document.getElementById('login-tab'),
            signupTab: document.getElementById('signup-tab'),
            loginForm: document.getElementById('login-form'),
            signupForm: document.getElementById('signup-form'),
            loginEmail: document.getElementById('login-email'),
            loginPassword: document.getElementById('login-password'),
            loginBtn: document.getElementById('login-btn'),
            loginBtnText: document.getElementById('login-btn-text'),
            loginSpinner: document.getElementById('login-spinner'),
            signupName: document.getElementById('signup-name'),
            signupEmail: document.getElementById('signup-email'),
            signupPassword: document.getElementById('signup-password'),
            signupConfirmPassword: document.getElementById('signup-confirm-password'),
            signupBtn: document.getElementById('signup-btn'),
            signupBtnText: document.getElementById('signup-btn-text'),
            signupSpinner: document.getElementById('signup-spinner'),
            googleAuthBtn: document.getElementById('google-auth-btn'),
            microsoftAuthBtn: document.getElementById('microsoft-auth-btn'),
            forgotPasswordBtn: document.getElementById('forgot-password-btn'),
            termsAgree: document.getElementById('terms-agree'),

            // App elements
            appContainer: document.getElementById('app-container'),
            loadingScreen: document.getElementById('loading-screen'),
            loadingOverlay: document.getElementById('loading-overlay'),
            loadingText: document.getElementById('loading-text'),
            userAvatar: document.getElementById('user-avatar'),
            drawer: document.getElementById('drawer'),
            drawerOverlay: document.getElementById('drawer-overlay'),
            drawerAvatar: document.getElementById('drawer-avatar'),
            drawerUserName: document.getElementById('drawer-user-name'),
            drawerUserEmail: document.getElementById('drawer-user-email'),
            drawerUserRole: document.getElementById('drawer-user-role'),
            pages: document.querySelectorAll('.page'),
            pageLinks: document.querySelectorAll('[data-page]'),
            themeToggle: document.getElementById('theme-toggle'),
            floatingThemeToggle: document.getElementById('floating-theme-toggle'),
            darkModeToggle: document.getElementById('dark-mode-toggle'),
            logoutBtn: document.getElementById('logout-btn'),
            welcomeTime: document.getElementById('welcome-time'),
            activeSectionsCount: document.getElementById('active-sections'),
            todayAttendance: document.getElementById('today-attendance'),
            aiWarnings: document.getElementById('ai-warnings'),

            // Section management
            addSectionBtn: document.getElementById('add-section-btn'),
            addSectionModal: document.getElementById('add-section-modal'),
            closeAddSectionModal: document.getElementById('close-add-section-modal'),
            cancelAddSection: document.getElementById('cancel-add-section'),
            saveSection: document.getElementById('save-section'),
            saveSectionText: document.getElementById('save-section-text'),
            saveSectionSpinner: document.getElementById('save-section-spinner'),
            sectionName: document.getElementById('section-name'),
            sectionSubject: document.getElementById('section-subject'),
            sectionHour: document.getElementById('section-hour'),
            sectionMinute: document.getElementById('section-minute'),
            sectionPeriod: document.getElementById('section-period'),
            sectionCheckinWindow: document.getElementById('section-checkin-window'),
            sectionToggles: document.querySelectorAll('.section-toggle'),

            // Invite modal
            inviteModal: document.getElementById('invite-modal'),
            closeInviteModal: document.getElementById('close-invite-modal'),
            cancelInvite: document.getElementById('cancel-invite'),
            saveInvite: document.getElementById('save-invite'),
            inviteLinkInput: document.getElementById('invite-link-input'),
            copyInviteLink: document.getElementById('copy-invite-link'),
            inviteExpiration: document.getElementById('invite-expiration'),
            inviteBtn1: document.getElementById('invite-btn-1'),
            inviteBtn2: document.getElementById('invite-btn-2'),

            // Session settings
            sessionSettingsModal: document.getElementById('session-settings-modal'),
            closeSessionSettingsModal: document.getElementById('close-session-settings-modal'),
            cancelSessionSettings: document.getElementById('cancel-session-settings'),
            saveSessionSettings: document.getElementById('save-session-settings'),
            sessionName: document.getElementById('session-name'),
            sessionStartTime: document.getElementById('session-start-time'),
            sessionEndTime: document.getElementById('session-end-time'),
            sessionLocationRange: document.getElementById('session-location-range'),
            sessionRangeValue: document.getElementById('session-range-value'),
            allowManualCheckin: document.getElementById('allow-manual-checkin'),
            sendNotifications: document.getElementById('send-notifications'),

            // Check-in flow
            locationModal: document.getElementById('location-modal'),
            allowLocation: document.getElementById('allow-location'),
            denyLocation: document.getElementById('deny-location'),
            checkInBtn: document.getElementById('check-in-btn'),
            checkinSuccessModal: document.getElementById('checkin-success-modal'),
            currentDistance: document.getElementById('current-distance'),
            timeRemaining: document.getElementById('time-remaining'),

            // Notifications
            notificationsBtn: document.getElementById('notifications-btn'),
            notificationDropdown: document.getElementById('notification-dropdown'),
            notificationList: document.getElementById('notification-list'),
            clearNotifications: document.getElementById('clear-notifications'),
            notificationBadge: document.getElementById('notification-badge'),

            // Toast
            toastNotification: document.getElementById('toast-notification'),
            toastMessage: document.getElementById('toast-message'),

            // Range sliders
            locationRange: document.getElementById('location-range'),
            rangeValue: document.getElementById('range-value')
        };

        // Initialize App
        function initApp() {
            // Set up event listeners
            setupEventListeners();

            // Check auth state
            auth.onAuthStateChanged(user => {
                if (user) {
                    // User is signed in
                    state.currentUser = user;
                    loadUserData();
                } else {
                    // No user is signed in
                    showAuthScreen();
                }
            });

            // Check for saved theme preference
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                enableDarkMode();
            }

            // Set welcome message based on time of day
            setWelcomeMessage();
        }

        // Set up event listeners
        function setupEventListeners() {
            // Auth screen events
            elements.loginTab.addEventListener('click', () => switchAuthTab('login'));
            elements.signupTab.addEventListener('click', () => switchAuthTab('signup'));
            elements.loginBtn.addEventListener('click', loginWithEmail);
            elements.signupBtn.addEventListener('click', signupWithEmail);
            elements.googleAuthBtn.addEventListener('click', () => loginWithProvider(new firebase.auth.GoogleAuthProvider()));
            elements.microsoftAuthBtn.addEventListener('click', () => loginWithProvider(new firebase.auth.OAuthProvider('microsoft.com')));
            elements.forgotPasswordBtn.addEventListener('click', showForgotPassword);
            elements.loginPassword.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') loginWithEmail();
            });
            elements.signupConfirmPassword.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') signupWithEmail();
            });

            // App events
            elements.userAvatar.addEventListener('click', toggleDrawer);
            elements.drawerOverlay.addEventListener('click', toggleDrawer);
            elements.logoutBtn.addEventListener('click', logout);
            elements.themeToggle.addEventListener('click', toggleTheme);
            elements.floatingThemeToggle.addEventListener('click', toggleTheme);
            elements.darkModeToggle.addEventListener('click', toggleTheme);

            // Page navigation
            elements.pageLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.getAttribute('data-page');
                    showPage(page);
                    if (page !== 'checkin-page') {
                        toggleDrawer();
                    }
                });
            });

            // Section management
            elements.addSectionBtn.addEventListener('click', () => {
                elements.addSectionModal.classList.add('open');
            });
            elements.closeAddSectionModal.addEventListener('click', () => {
                elements.addSectionModal.classList.remove('open');
            });
            elements.cancelAddSection.addEventListener('click', () => {
                elements.addSectionModal.classList.remove('open');
            });
            elements.saveSection.addEventListener('click', saveSection);

            // Invite modal
            elements.inviteBtn1.addEventListener('click', () => showInviteModal('math101'));
            elements.inviteBtn2.addEventListener('click', () => showInviteModal('science202'));
            elements.closeInviteModal.addEventListener('click', () => {
                elements.inviteModal.classList.remove('open');
            });
            elements.cancelInvite.addEventListener('click', () => {
                elements.inviteModal.classList.remove('open');
            });
            elements.copyInviteLink.addEventListener('click', copyInviteLinkToClipboard);
            elements.saveInvite.addEventListener('click', shareInviteLink);

            // Session settings
            elements.closeSessionSettingsModal.addEventListener('click', () => {
                elements.sessionSettingsModal.classList.remove('open');
            });
            elements.cancelSessionSettings.addEventListener('click', () => {
                elements.sessionSettingsModal.classList.remove('open');
            });
            elements.saveSessionSettings.addEventListener('click', saveSessionSettings);

            // Check-in flow
            elements.allowLocation.addEventListener('click', requestLocationPermission);
            elements.denyLocation.addEventListener('click', () => {
                elements.locationModal.classList.remove('open');
                showToast('Check-in requires location access', 'error');
            });
            elements.checkInBtn.addEventListener('click', () => {
                elements.locationModal.classList.add('open');
            });

            // Notifications
            elements.notificationsBtn.addEventListener('click', toggleNotificationsDropdown);
            elements.clearNotifications.addEventListener('click', clearAllNotifications);

            // Range sliders
            elements.locationRange.addEventListener('input', (e) => {
                elements.rangeValue.textContent = `${e.target.value}m`;
            });
            elements.sessionLocationRange.addEventListener('input', (e) => {
                elements.sessionRangeValue.textContent = `${e.target.value}m`;
            });

            // Section toggles
            elements.sectionToggles.forEach(toggle => {
                toggle.addEventListener('click', (e) => {
                    const header = e.currentTarget.closest('.section-header');
                    const section = header.parentElement;
                    const students = section.querySelector('.section-students');
                    students.classList.toggle('open');
                    
                    const icon = toggle.querySelector('i');
                    if (students.classList.contains('open')) {
                        icon.classList.remove('fa-chevron-down');
                        icon.classList.add('fa-chevron-up');
                    } else {
                        icon.classList.remove('fa-chevron-up');
                        icon.classList.add('fa-chevron-down');
                    }
                });
            });

            // Ripple effect for buttons
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('ripple') || e.target.closest('.ripple')) {
                    const button = e.target.classList.contains('ripple') ? e.target : e.target.closest('.ripple');
                    const rect = button.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    const ripple = document.createElement('span');
                    ripple.className = 'ripple-effect';
                    ripple.style.left = `${x}px`;
                    ripple.style.top = `${y}px`;
                    
                    button.appendChild(ripple);
                    
                    setTimeout(() => {
                        ripple.remove();
                    }, 600);
                }
            });

            // Physics animations
            document.querySelectorAll('.physics-card').forEach(card => {
                card.addEventListener('mousemove', (e) => {
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;
                    const angleX = (y - centerY) / 20;
                    const angleY = (centerX - x) / 20;
                    
                    card.style.transform = `perspective(1000px) rotateX(${angleX}deg) rotateY(${angleY}deg)`;
                });
                
                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0)';
                });
            });
        }

        // Auth functions
        function switchAuthTab(tab) {
            if (tab === 'login') {
                elements.loginTab.classList.add('active');
                elements.signupTab.classList.remove('active');
                elements.loginForm.classList.remove('hidden');
                elements.signupForm.classList.add('hidden');
            } else {
                elements.loginTab.classList.remove('active');
                elements.signupTab.classList.add('active');
                elements.loginForm.classList.add('hidden');
                elements.signupForm.classList.remove('hidden');
            }
        }

        function loginWithEmail() {
            const email = elements.loginEmail.value.trim();
            const password = elements.loginPassword.value.trim();
            
            if (!email || !password) {
                showToast('Please enter both email and password', 'error');
                return;
            }
            
            elements.loginBtnText.textContent = 'Logging in...';
            elements.loginSpinner.classList.remove('hidden');
            elements.loginBtn.disabled = true;
            
            auth.signInWithEmailAndPassword(email, password)
                .then(() => {
                    // Success handled by auth state listener
                })
                .catch(error => {
                    elements.loginBtnText.textContent = 'Login';
                    elements.loginSpinner.classList.add('hidden');
                    elements.loginBtn.disabled = false;
                    
                    let message = 'Login failed. Please try again.';
                    if (error.code === 'auth/user-not-found') {
                        message = 'No user found with this email.';
                    } else if (error.code === 'auth/wrong-password') {
                        message = 'Incorrect password. Please try again.';
                    } else if (error.code === 'auth/too-many-requests') {
                        message = 'Too many failed attempts. Account temporarily locked.';
                    }
                    
                    showToast(message, 'error');
                });
        }

        function signupWithEmail() {
            const name = elements.signupName.value.trim();
            const email = elements.signupEmail.value.trim();
            const password = elements.signupPassword.value.trim();
            const confirmPassword = elements.signupConfirmPassword.value.trim();
            
            if (!name || !email || !password || !confirmPassword) {
                showToast('Please fill in all fields', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showToast('Passwords do not match', 'error');
                return;
            }
            
            if (!elements.termsAgree.checked) {
                showToast('You must agree to the terms of service', 'error');
                return;
            }
            
            elements.signupBtnText.textContent = 'Creating account...';
            elements.signupSpinner.classList.remove('hidden');
            elements.signupBtn.disabled = true;
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Add user to Firestore
                    return db.collection('users').doc(userCredential.user.uid).set({
                        name: name,
                        email: email,
                        role: 'teacher', // Only teachers can sign up directly
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .then(() => {
                    // Success handled by auth state listener
                })
                .catch(error => {
                    elements.signupBtnText.textContent = 'Create Account';
                    elements.signupSpinner.classList.add('hidden');
                    elements.signupBtn.disabled = false;
                    
                    let message = 'Signup failed. Please try again.';
                    if (error.code === 'auth/email-already-in-use') {
                        message = 'Email already in use. Please login instead.';
                    } else if (error.code === 'auth/weak-password') {
                        message = 'Password should be at least 6 characters.';
                    } else if (error.code === 'auth/invalid-email') {
                        message = 'Please enter a valid email address.';
                    }
                    
                    showToast(message, 'error');
                });
        }

        function loginWithProvider(provider) {
            auth.signInWithPopup(provider)
                .then((result) => {
                    // Check if user exists in Firestore
                    return db.collection('users').doc(result.user.uid).get();
                })
                .then((doc) => {
                    if (!doc.exists) {
                        // Add new user to Firestore
                        return db.collection('users').doc(state.currentUser.uid).set({
                            name: state.currentUser.displayName || 'New User',
                            email: state.currentUser.email,
                            role: 'teacher', // Only teachers can sign up directly
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                })
                .catch(error => {
                    console.error('Provider login error:', error);
                    showToast('Login failed. Please try again.', 'error');
                });
        }

        function showForgotPassword() {
            const email = elements.loginEmail.value.trim();
            
            if (!email) {
                showToast('Please enter your email address', 'error');
                return;
            }
            
            auth.sendPasswordResetEmail(email)
                .then(() => {
                    showToast('Password reset email sent. Check your inbox.', 'success');
                })
                .catch(error => {
                    let message = 'Failed to send reset email. Please try again.';
                    if (error.code === 'auth/user-not-found') {
                        message = 'No user found with this email.';
                    }
                    showToast(message, 'error');
                });
        }

        function logout() {
            showLoading('Logging out...');
            auth.signOut()
                .then(() => {
                    hideLoading();
                    showAuthScreen();
                })
                .catch(error => {
                    hideLoading();
                    showToast('Logout failed. Please try again.', 'error');
                });
        }

        // User data functions
        function loadUserData() {
            showLoading('Loading your data...');
            
            // Get user document from Firestore
            db.collection('users').doc(state.currentUser.uid).get()
                .then(doc => {
                    if (doc.exists) {
                        const userData = doc.data();
                        state.userRole = userData.role;
                        
                        // Update UI with user data
                        updateUserProfile(userData);
                        
                        // Load user's sections based on role
                        if (state.userRole === 'teacher') {
                            loadTeacherSections();
                        } else if (state.userRole === 'student') {
                            loadStudentSections();
                        }
                        
                        // Load notifications
                        loadNotifications();
                        
                        // Show main app
                        hideLoading();
                        showMainApp();
                    } else {
                        // User document doesn't exist (shouldn't happen)
                        throw new Error('User data not found');
                    }
                })
                .catch(error => {
                    console.error('Error loading user data:', error);
                    showToast('Error loading your data. Please try again.', 'error');
                    auth.signOut();
                });
        }

        function updateUserProfile(userData) {
            const name = userData.name || 'User';
            const email = userData.email || '';
            const role = userData.role || 'user';
            
            // Update header avatar
            elements.userAvatar.textContent = getInitials(name);
            
            // Update drawer profile
            elements.drawerAvatar.textContent = getInitials(name);
            elements.drawerUserName.textContent = name;
            elements.drawerUserEmail.textContent = email;
            elements.drawerUserRole.textContent = role.charAt(0).toUpperCase() + role.slice(1);
            
            // Update state
            state.userRole = role;
        }

        function getInitials(name) {
            return name.split(' ').map(part => part[0]).join('').toUpperCase();
        }

        // Section functions
        function loadTeacherSections() {
            db.collection('sections')
                .where('teacherId', '==', state.currentUser.uid)
                .orderBy('createdAt', 'desc')
                .onSnapshot(snapshot => {
                    state.sections = [];
                    snapshot.forEach(doc => {
                        state.sections.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    // Update UI
                    updateSectionsUI();
                    
                    // Load active sessions
                    loadActiveSessions();
                }, error => {
                    console.error('Error loading sections:', error);
                    showToast('Error loading sections. Please refresh.', 'error');
                });
        }

        function loadStudentSections() {
            db.collection('sectionMembers')
                .where('studentId', '==', state.currentUser.uid)
                .get()
                .then(memberSnapshot => {
                    const sectionIds = memberSnapshot.docs.map(doc => doc.data().sectionId);
                    
                    if (sectionIds.length === 0) {
                        state.sections = [];
                        updateSectionsUI();
                        return;
                    }
                    
                    db.collection('sections')
                        .where(firebase.firestore.FieldPath.documentId(), 'in', sectionIds)
                        .get()
                        .then(sectionSnapshot => {
                            state.sections = [];
                            sectionSnapshot.forEach(doc => {
                                state.sections.push({
                                    id: doc.id,
                                    ...doc.data()
                                });
                            });
                            
                            // Update UI
                            updateSectionsUI();
                            
                            // Check if we came from an invite link
                            checkInviteLink();
                        });
                })
                .catch(error => {
                    console.error('Error loading student sections:', error);
                    showToast('Error loading your sections. Please refresh.', 'error');
                });
        }

        function updateSectionsUI() {
            // This would be implemented to update the sections page UI
            // with the sections from state.sections
            
            // For demo purposes, we'll just update the count
            elements.activeSectionsCount.textContent = state.sections.length;
        }

        function saveSection() {
            const name = elements.sectionName.value.trim();
            const subject = elements.sectionSubject.value.trim();
            const schedule = document.querySelector('input[name="schedule"]:checked').value;
            const hour = elements.sectionHour.value;
            const minute = elements.sectionMinute.value.padStart(2, '0');
            const period = elements.sectionPeriod.value;
            const checkinWindow = elements.sectionCheckinWindow.value;
            
            if (!name || !subject) {
                showToast('Please enter section name and subject', 'error');
                return;
            }
            
            elements.saveSectionText.textContent = 'Saving...';
            elements.saveSectionSpinner.classList.remove('hidden');
            elements.saveSection.disabled = true;
            
            // Format time
            const timeString = `${hour}:${minute} ${period}`;
            
            // Create section in Firestore
            db.collection('sections').add({
                name: name,
                subject: subject,
                schedule: schedule,
                time: timeString,
                checkinWindow: parseInt(checkinWindow),
                teacherId: state.currentUser.uid,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                active: true
            })
            .then(() => {
                elements.addSectionModal.classList.remove('open');
                showToast('Section created successfully', 'success');
            })
            .catch(error => {
                console.error('Error creating section:', error);
                showToast('Failed to create section. Please try again.', 'error');
            })
            .finally(() => {
                elements.saveSectionText.textContent = 'Save Section';
                elements.saveSectionSpinner.classList.add('hidden');
                elements.saveSection.disabled = false;
            });
        }

        function showInviteModal(sectionId) {
            // Generate a unique invite code
            const inviteCode = generateInviteCode();
            const inviteLink = `https://nearcheck.app/join/${inviteCode}`;
            
            elements.inviteLinkInput.value = inviteLink;
            elements.inviteModal.classList.add('open');
            
            // For demo, we'll just show the modal with a sample link
            // In a real app, we'd save this invite to Firestore
        }

        function generateInviteCode() {
            return Math.random().toString(36).substring(2, 8) + Math.random().toString(36).substring(2, 8);
        }

        function copyInviteLinkToClipboard() {
            elements.inviteLinkInput.select();
            document.execCommand('copy');
            showToast('Invite link copied to clipboard', 'success');
        }

        function shareInviteLink() {
            const link = elements.inviteLinkInput.value;
            const expiration = elements.inviteExpiration.value;
            const role = document.querySelector('input[name="invite-role"]:checked').value;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Join my class on NearCheck',
                    text: `Join my ${role} section on NearCheck using this link:`,
                    url: link
                })
                .then(() => {
                    elements.inviteModal.classList.remove('open');
                })
                .catch(error => {
                    console.log('Error sharing:', error);
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                copyInviteLinkToClipboard();
                elements.inviteModal.classList.remove('open');
            }
            
            // In a real app, we'd save the invite to Firestore with expiration
        }

        function checkInviteLink() {
            // Check if URL has an invite code
            const urlParams = new URLSearchParams(window.location.search);
            const inviteCode = urlParams.get('invite');
            
            if (inviteCode) {
                // In a real app, we'd validate the invite code against Firestore
                // and show appropriate UI to join the section
                
                // For demo, we'll just show a toast
                showToast('You have a pending invite to join a section', 'info');
            }
        }

        // Attendance functions
        function loadActiveSessions() {
            if (state.userRole !== 'teacher') return;
            
            db.collection('sessions')
                .where('sectionId', 'in', state.sections.map(s => s.id))
                .where('endTime', '>', new Date())
                .onSnapshot(snapshot => {
                    state.activeSessions = [];
                    snapshot.forEach(doc => {
                        state.activeSessions.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    // Update UI
                    updateActiveSessionsUI();
                }, error => {
                    console.error('Error loading active sessions:', error);
                    showToast('Error loading active sessions', 'error');
                });
        }

        function updateActiveSessionsUI() {
            // This would update the attendance page with the active sessions
            // For demo, we'll just update the count
            elements.todayAttendance.textContent = state.activeSessions.length > 0 ? 
                `${Math.round((state.activeSessions[0].checkedInStudents / state.activeSessions[0].totalStudents) * 100)}%` : 
                'No active sessions';
        }

        function saveSessionSettings() {
            const name = elements.sessionName.value.trim();
            const startTime = elements.sessionStartTime.value;
            const endTime = elements.sessionEndTime.value;
            const locationRange = elements.sessionLocationRange.value;
            const allowManual = elements.allowManualCheckin.checked;
            const sendNotifs = elements.sendNotifications.checked;
            
            if (!name || !startTime || !endTime) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            // In a real app, we'd update the session in Firestore
            showToast('Session settings saved', 'success');
            elements.sessionSettingsModal.classList.remove('open');
        }

        function requestLocationPermission() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        // Success - simulate check-in
                        elements.locationModal.classList.remove('open');
                        simulateCheckIn(position);
                    },
                    (error) => {
                        elements.locationModal.classList.remove('open');
                        let message = 'Error getting location.';
                        if (error.code === error.PERMISSION_DENIED) {
                            message = 'Location access denied. Check-in requires location.';
                        }
                        showToast(message, 'error');
                    },
                    { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
                );
            } else {
                elements.locationModal.classList.remove('open');
                showToast('Geolocation is not supported by your browser', 'error');
            }
        }

        function simulateCheckIn(position) {
            // Show loading on check-in button
            elements.checkInBtn.innerHTML = '<div class="spinner"></div>';
            elements.checkInBtn.classList.remove('pulse');
            
            // Simulate API call
            setTimeout(() => {
                // Show success
                elements.checkinSuccessModal.classList.add('open');
                elements.checkInBtn.innerHTML = '<i class="fas fa-check"></i> CHECKED IN';
                
                // Create confetti effect
                createConfetti();
                
                // Close success modal after 3 seconds
                setTimeout(() => {
                    elements.checkinSuccessModal.classList.remove('open');
                }, 3000);
            }, 1500);
        }

        // Notification functions
        function loadNotifications() {
            db.collection('notifications')
                .where('userId', '==', state.currentUser.uid)
                .orderBy('createdAt', 'desc')
                .limit(20)
                .onSnapshot(snapshot => {
                    state.notifications = [];
                    state.unreadNotifications = 0;
                    
                    snapshot.forEach(doc => {
                        const notification = {
                            id: doc.id,
                            ...doc.data()
                        };
                        state.notifications.push(notification);
                        
                        if (!notification.read) {
                            state.unreadNotifications++;
                        }
                    });
                    
                    updateNotificationsUI();
                }, error => {
                    console.error('Error loading notifications:', error);
                });
        }

        function updateNotificationsUI() {
            // Update badge
            if (state.unreadNotifications > 0) {
                elements.notificationBadge.textContent = state.unreadNotifications;
                elements.notificationBadge.classList.remove('hidden');
            } else {
                elements.notificationBadge.classList.add('hidden');
            }
            
            // Update dropdown list
            elements.notificationList.innerHTML = '';
            
            state.notifications.forEach(notification => {
                const item = document.createElement('li');
                item.className = `notification-item ${notification.read ? '' : 'unread'}`;
                item.innerHTML = `
                    <div class="notification-content">${notification.message}</div>
                    <div class="notification-time">${formatTime(notification.createdAt?.toDate())}</div>
                `;
                
                item.addEventListener('click', () => {
                    // Mark as read
                    if (!notification.read) {
                        db.collection('notifications').doc(notification.id).update({
                            read: true,
                            readAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                    
                    // Handle notification click
                    handleNotificationClick(notification);
                });
                
                elements.notificationList.appendChild(item);
            });
        }

        function toggleNotificationsDropdown() {
            elements.notificationDropdown.classList.toggle('open');
        }

        function clearAllNotifications() {
            const batch = db.batch();
            
            state.notifications.forEach(notification => {
                if (!notification.read) {
                    const ref = db.collection('notifications').doc(notification.id);
                    batch.update(ref, {
                        read: true,
                        readAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            });
            
            batch.commit()
                .then(() => {
                    showToast('Notifications cleared', 'success');
                })
                .catch(error => {
                    console.error('Error clearing notifications:', error);
                    showToast('Failed to clear notifications', 'error');
                });
        }

        function handleNotificationClick(notification) {
            // Close dropdown
            elements.notificationDropdown.classList.remove('open');
            
            // Handle different notification types
            if (notification.type === 'attendance') {
                showPage('attendance');
            } else if (notification.type === 'section') {
                showPage('sections');
            }
        }

        // UI functions
        function showAuthScreen() {
            elements.loadingScreen.classList.add('hidden');
            elements.appContainer.classList.add('hidden');
            elements.authContainer.classList.remove('hidden');
            
            // Reset forms
            elements.loginEmail.value = '';
            elements.loginPassword.value = '';
            elements.signupName.value = '';
            elements.signupEmail.value = '';
            elements.signupPassword.value = '';
            elements.signupConfirmPassword.value = '';
            elements.termsAgree.checked = false;
            
            // Reset button states
            elements.loginBtnText.textContent = 'Login';
            elements.loginSpinner.classList.add('hidden');
            elements.loginBtn.disabled = false;
            elements.signupBtnText.textContent = 'Create Account';
            elements.signupSpinner.classList.add('hidden');
            elements.signupBtn.disabled = false;
            
            // Show login tab by default
            switchAuthTab('login');
        }

        function showMainApp() {
            elements.loadingScreen.classList.add('hidden');
            elements.authContainer.classList.add('hidden');
            elements.appContainer.classList.remove('hidden');
            
            // Show dashboard by default
            showPage('dashboard');
        }

        function showPage(page) {
            // Hide all pages
            elements.pages.forEach(p => {
                p.classList.add('hidden');
            });

            // Show selected page
            document.getElementById(`${page}-page`).classList.remove('hidden');

            // Update active link in drawer
            elements.pageLinks.forEach(link => {
                if (link.getAttribute('data-page') === page) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });

            // Update active link in bottom nav
            const bottomNavItems = document.querySelectorAll('.bottom-nav-item');
            bottomNavItems.forEach(item => {
                if (item.getAttribute('data-page') === page) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });

            // Update state
            state.currentPage = page;
        }

        function toggleDrawer() {
            elements.drawer.classList.toggle('open');
            elements.drawerOverlay.classList.toggle('open');
        }

        function toggleTheme() {
            if (state.darkMode) {
                disableDarkMode();
            } else {
                enableDarkMode();
            }
        }

        function enableDarkMode() {
            document.documentElement.classList.add('dark');
            state.darkMode = true;
            elements.darkModeToggle.checked = true;
            localStorage.setItem('theme', 'dark');
            
            // Update theme toggle icons
            const themeIcons = document.querySelectorAll('#theme-toggle i, #floating-theme-toggle i');
            themeIcons.forEach(icon => {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            });
        }

        function disableDarkMode() {
            document.documentElement.classList.remove('dark');
            state.darkMode = false;
            elements.darkModeToggle.checked = false;
            localStorage.setItem('theme', 'light');
            
            // Update theme toggle icons
            const themeIcons = document.querySelectorAll('#theme-toggle i, #floating-theme-toggle i');
            themeIcons.forEach(icon => {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            });
        }

        function setWelcomeMessage() {
            const hour = new Date().getHours();
            let message = 'Good ';
            
            if (hour < 12) {
                message += 'Morning';
            } else if (hour < 18) {
                message += 'Afternoon';
            } else {
                message += 'Evening';
            }
            
            elements.welcomeTime.textContent = message;
        }

        function showLoading(message) {
            elements.loadingText.textContent = message || 'Loading...';
            elements.loadingOverlay.classList.remove('hidden');
        }

        function hideLoading() {
            elements.loadingOverlay.classList.add('hidden');
        }

        function showToast(message, type = 'success') {
            // Update toast content
            elements.toastMessage.textContent = message;
            
            // Update toast type
            elements.toastNotification.className = 'toast';
            elements.toastNotification.classList.add(`toast-${type}`);
            
            // Show toast
            elements.toastNotification.classList.remove('hidden');
            elements.toastNotification.classList.add('show');
            
            // Hide after 3 seconds
            setTimeout(() => {
                elements.toastNotification.classList.remove('show');
                setTimeout(() => {
                    elements.toastNotification.classList.add('hidden');
                }, 300);
            }, 3000);
        }

        function formatTime(date) {
            if (!date) return 'Just now';
            
            const now = new Date();
            const diff = now - date;
            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (days > 0) {
                return `${days}d ago`;
            } else if (hours > 0) {
                return `${hours}h ago`;
            } else if (minutes > 0) {
                return `${minutes}m ago`;
            } else {
                return 'Just now';
            }
        }

        function createConfetti() {
            const colors = ['#5e72e4', '#667eea', '#764ba2', '#ff758c', '#ff7eb3', '#ff8a00'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDuration = Math.random() * 2 + 2 + 's';
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = Math.random() * 10 + 5 + 'px';
                document.body.appendChild(confetti);
                
                // Remove confetti after animation
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>